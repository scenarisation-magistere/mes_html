<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlashPrompt IA - Générateur de Flashcards</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        /* Variables et styles de base */
        :root {
            /* Couleurs principales du gradient */
            --gradient-start: #6222cc;
            --gradient-end: #8042e8;
            
            /* Couleur d'accent et ombres */
            --accent-color: #6222cc;
            --shadow-dark: rgba(70, 10, 100, 0.5);
            --shadow-light: rgba(255, 255, 255, 0.3);
            
            /* Couleurs des onglets */
            --tab1-color: #6222cc;
            --tab2-color: #702fd8;
            --tab3-color: #7e3ce4;
            --tab4-color: #8c49f0;
            --tab5-color: #9a56fc;
            --tab6-color: #a864ff;
            
            /* Couleurs des boutons */
            --btn-primary: #6222cc;
            --btn-secondary: #9e9e9e;
            --btn-special: #8042e8;
            --btn-danger: #f44336;
            
            /* Autres variables */
            --text-color: #333333;
            --base-color: #f5f5f5;
            --transition: all 0.3s ease;
        }

        /* Styles globaux */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            background-attachment: fixed;
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Header */
        .header-container {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 20px;
            background-color: white;
            box-shadow: 8px 8px 16px var(--shadow-dark);
        }

        h1 {
            text-align: center;
            color: var(--accent-color);
            margin: 0;
            padding: 0 60px;
        }

        .version-bubble {
            background-color: var(--tab6-color);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
        }

        .signature {
            background-color: var(--tab1-color);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
        }

        /* Nouveau bouton API dans le header */
        .api-connect-btn {
            position: absolute;
            right: 80px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--accent-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s;
        }

        .api-connect-btn:hover {
            transform: translateY(-50%) scale(1.1);
            box-shadow: 3px 3px 8px rgba(0,0,0,0.4);
        }

        .api-connect-btn i {
            font-size: 18px;
        }

        .description {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            padding: 15px;
            border-radius: 20px;
            box-shadow: inset 3px 3px 7px rgba(0,0,0,0.2), inset -3px -3px 7px rgba(255,255,255,0.1);
        }

        /* Structure des onglets */
        .tabs-container {
            display: flex;
            margin-bottom: 20px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 8px 8px 16px var(--shadow-dark);
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-weight: bold;
            box-shadow: inset 0 0 0 rgba(0,0,0,0.1), inset 0 0 0 rgba(255,255,255,0.1);
            color: white;
        }

        .tab.active {
            box-shadow: inset 3px 3px 5px rgba(0,0,0,0.2), inset -1px -1px 3px rgba(255,255,255,0.1);
            background-color: white;
            color: var(--accent-color);
        }

        .tab-1 { background-color: var(--tab1-color); }
        .tab-2 { background-color: var(--tab2-color); }
        .tab-3 { background-color: var(--tab3-color); }
        .tab-4 { background-color: var(--tab4-color); }
        .tab-5 { background-color: var(--tab5-color); }

        .tab-content {
            padding: 20px;
            border-radius: 20px;
            box-shadow: 8px 8px 16px var(--shadow-dark);
            margin-bottom: 20px;
            display: none;
            background-color: white;
        }

        .tab-content.active {
            display: block;
        }

        /* Boutons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            margin-right: 10px;
            margin-bottom: 10px;
            background-color: var(--base-color);
            box-shadow: 5px 5px 10px var(--shadow-dark), -2px -2px 5px var(--shadow-light);
            color: var(--text-color);
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 6px 6px 12px var(--shadow-dark), -2px -2px 5px var(--shadow-light);
        }

        .btn:active {
            box-shadow: inset 3px 3px 5px rgba(0,0,0,0.2), inset -1px -1px 3px rgba(255,255,255,0.1);
            transform: translateY(0);
        }

        .btn-primary {
            background-color: var(--btn-primary);
            color: white;
        }

        .btn-secondary {
            background-color: var(--btn-secondary);
            color: white;
        }

        .btn-special {
            background-color: var(--btn-special);
            color: white;
        }

        .btn-danger {
            background-color: var(--btn-danger);
            color: white;
        }

        .buttons {
            display: flex;
            flex-wrap: wrap;
            margin: 15px 0;
            gap: 10px;
        }

        /* Étapes et paramètres */
        .step-title {
            font-size: 1.5rem;
            color: var(--accent-color);
            margin-bottom: 15px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 16px;
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.05);
        }

        .form-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 16px;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
            padding-right: 40px;
        }

        .form-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 16px;
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.05);
            min-height: 100px;
            resize: vertical;
        }

        /* Grid pour les niveaux scolaires */
        .levels-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .level-column {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 20px;
        }

        .level-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--accent-color);
            text-align: center;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
        }

        .level-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
        }

        .checkbox-container input[type="checkbox"] {
            margin-right: 8px;
        }

        /* Niveaux sélectionnés */
        .selected-levels {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 10px;
            margin-top: 10px;
            text-align: center;
        }

        /* API Config Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalOpen 0.3s ease-out;
        }

        @keyframes modalOpen {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent-color);
        }

        .modal-title {
            color: var(--accent-color);
            font-size: 1.5rem;
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .close-modal:hover {
            color: var(--btn-danger);
        }

        /* API Config dans le modal */
        .api-config-section {
            background-color: var(--base-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .api-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .api-input-group {
            margin-bottom: 10px;
        }

        .api-input-wrapper {
            display: flex;
            align-items: center;
        }

        .api-input-wrapper input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
        }

        .toggle-visibility-btn {
            background: none;
            border: none;
            cursor: pointer;
            margin-left: -30px;
            z-index: 10;
            color: #888;
        }

        .api-format-info {
            display: block;
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        .api-model-select {
            margin-bottom: 15px;
        }

        .api-model-select label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .api-model-select select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 16px;
        }

        .api-status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 8px;
            font-size: 14px;
            display: none;
        }

        .api-status.success {
            background-color: #e8f5e9;
            color: #2e7d32;
            display: block;
        }

        .api-status.error {
            background-color: #ffebee;
            color: #c62828;
            display: block;
        }

        /* Preview du prompt */
        .preview-container {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 20px;
            margin-top: 20px;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .preview-content {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #ddd;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
        }

        /* Paramètres des flashcards */
        .flashcard-params {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .param-card {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 20px;
            box-shadow: 3px 3px 8px rgba(0,0,0,0.1);
        }

        .param-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--accent-color);
        }

        /* Preview des flashcards */
        .flashcard-preview {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .flashcard {
            perspective: 1000px;
            width: 200px;
            height: 150px;
            cursor: pointer;
        }

        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border-radius: 10px;
        }

        .flashcard:hover .flashcard-inner {
            transform: rotateY(180deg);
        }

        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
        }

        .flashcard-front {
            background-color: white;
            color: #333;
        }

        .flashcard-back {
            background-color: var(--accent-color);
            color: white;
            transform: rotateY(180deg);
        }

        /* Catégories */
        .category-container {
            margin-top: 20px;
        }

        .category-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .category-row .remove-btn {
            background-color: var(--btn-danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* Certificat preview */
        .certificate-preview {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border: 10px solid var(--accent-color);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            text-align: center;
            border-radius: 20px;
        }

        .certificate-preview h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }

        .certificate-preview p {
            font-size: 14px;
            margin-bottom: 10px;
        }

        .certificate-preview .score {
            font-size: 20px;
            font-weight: bold;
            color: var(--accent-color);
            margin: 20px 0;
        }

        .certificate-preview .date {
            font-style: italic;
            margin-bottom: 30px;
        }

        .certificate-preview .signatures {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px dashed #ccc;
        }

        .certificate-preview .signature-box {
            text-align: center;
            width: 40%;
        }

        .certificate-preview .signature-line {
            width: 100%;
            height: 2px;
            background-color: #333;
            margin-bottom: 10px;
        }

        /* Info container */
        .info-container {
            background-color: #f0f8ff;
            padding: 20px;
            border-radius: 20px;
            border-left: 5px solid var(--accent-color);
        }

        .info-container h3 {
            color: var(--accent-color);
            margin-bottom: 10px;
        }

        .info-container ol {
            margin-left: 20px;
        }

        .info-container li {
            margin-bottom: 8px;
        }

        /* AI Generator Status */
        .ai-status {
            background-color: #f5f5f5;
            border-radius: 20px;
            padding: 15px;
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ai-status .status-icon {
            color: var(--accent-color);
            font-size: 24px;
        }

        .ai-status-message {
            flex: 1;
        }

        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Styles pour les préréglages */
        .style-presets-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .style-preset {
            cursor: pointer;
            transition: transform 0.2s;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .style-preset:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        
        /* Nouveau style pour la sélection des presets */
        .style-preset.selected {
            box-shadow: 0 0 0 3px var(--accent-color), 0 5px 15px rgba(0,0,0,0.15);
            transform: translateY(-5px);
        }
        
        .style-preset.selected::after {
            content: '✓';
            position: absolute;
            top: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            background-color: var(--accent-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .preset-preview {
            height: 80px;
            border-radius: 10px 10px 0 0;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .preset-options {
            display: flex;
            flex-direction: column;
            gap: 5px;
            width: 90%;
        }
        
        .preset-option {
            height: 8px;
            border-radius: 4px;
        }
        
        .preset-option.selected {
            height: 10px;
        }
        
        .preset-title {
            background-color: white;
            padding: 8px;
            font-size: 14px;
            text-align: center;
            font-weight: bold;
            border-top: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        /* Styles responsifs */
        @media (max-width: 768px) {
            .levels-grid {
                grid-template-columns: 1fr;
            }

            .tabs-container {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                margin-right: 0;
            }

            .header-container {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }

            h1 {
                padding: 0;
                margin: 10px 0;
            }

            .version-bubble, .signature {
                position: static;
                transform: none;
                margin: 5px 0;
            }
            
            .api-connect-btn {
                position: static;
                transform: none;
                margin: 10px auto 0;
            }

            .flashcard-params {
                grid-template-columns: 1fr;
            }
        }

        /* Nouvelle section pour l'intelligence artificielle */
        .ai-generation-container {
            background-color: #f0f0f8;
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid var(--accent-color);
        }

        .ai-generation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
        }

        .ai-generation-title {
            font-weight: bold;
            color: var(--accent-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-generation-content {
            padding: 10px 0;
        }

        .ai-generation-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .ai-config-btn {
            border: none;
            background-color: transparent;
            color: var(--accent-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 15px;
            transition: all 0.2s;
        }

        .ai-config-btn:hover {
            background-color: rgba(98, 34, 204, 0.1);
        }

        .ai-temperature-slider {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-top: 10px;
        }

        .ai-temperature-slider label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
        }

        .ai-temperature-slider input {
            width: 100%;
        }

        /* Notification style */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #4CAF50;
            color: white;
            padding: 16px;
            border-radius: 4px;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .notification.show {
            display: block;
            opacity: 1;
        }

        /* Gestion des exemples générés */
        .examples-container {
            background-color: #f9f9f9;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .example-card {
            background-color: white;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .example-card-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }

        .example-card-title {
            font-weight: bold;
            color: var(--accent-color);
        }

        .example-card-actions {
            display: flex;
            gap: 10px;
        }

        .example-card-action {
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            transition: color 0.2s;
        }

        .example-card-action:hover {
            color: var(--accent-color);
        }

        .example-card-front, .example-card-back {
            padding: 5px;
            margin-bottom: 5px;
        }

        .example-card-front {
            background-color: #f5f5f5;
            border-radius: 5px;
        }

        .example-card-back {
            background-color: #e8e8e8;
            border-radius: 5px;
        }

        /* Spinner pour chargement IA */
        .ai-spinner {
            margin: 0 auto;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(98, 34, 204, 0.2);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: ai-spinner-animation 1s linear infinite;
        }

        @keyframes ai-spinner-animation {
            to { transform: rotate(360deg); }
        }

        .api-connected-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 10px;
            background-color: #e8f5e9;
            color: #2e7d32;
        }

        .api-connected-indicator.disconnected {
            background-color: #ffebee;
            color: #c62828;
        }

        /* Log pour débug */
        .api-debug-log {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            display: none;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header-container">
            <div class="version-bubble">V3.3</div>
            <h1>FlashPrompt IA - Générateur de Flashcards</h1>
            <!-- Nouveau bouton API dans l'en-tête -->
            <div class="api-connect-btn" id="floating-api-btn">
                <i class="fas fa-plug"></i>
            </div>
            <div class="signature">FlashPrompt</div>
        </div>

        <div class="description">
            <p>Créez facilement des prompts optimisés pour générer des applications de révision avec flashcards. Personnalisez le domaine, le niveau, le style et les fonctionnalités, puis utilisez le prompt généré avec votre IA préférée ou directement via notre connexion API.</p>
        </div>

        <div class="tabs-container">
            <div class="tab tab-1 active" data-tab="1">
                Configuration
            </div>
            <div class="tab tab-2" data-tab="2">
                Contenu
            </div>
            <div class="tab tab-3" data-tab="3">
                Apparence
            </div>
            <div class="tab tab-4" data-tab="4">
                Certificat
            </div>
            <div class="tab tab-5" data-tab="5">
                Prompt Final
            </div>
        </div>

        <!-- Tab 1: Configuration -->
        <div id="tab-content-1" class="tab-content active">
            <h2 class="step-title">Étape 1: Configurer l'application</h2>
            
            <div class="form-group">
                <label class="form-label" for="app-title">Titre de l'application:</label>
                <input 
                    type="text" 
                    id="app-title" 
                    class="form-input" 
                    placeholder="Ex: StatsCards - Révision de Statistiques" 
                    value="FlashCards - Révision"
                >
            </div>

            <div class="form-group">
                <label class="form-label" for="app-subtitle">Sous-titre (optionnel):</label>
                <input 
                    type="text" 
                    id="app-subtitle" 
                    class="form-input" 
                    placeholder="Ex: Application de révision interactive"
                >
            </div>

            <div class="form-group">
                <label class="form-label" for="app-author">Signature / Auteur:</label>
                <input 
                    type="text" 
                    id="app-author" 
                    class="form-input" 
                    placeholder="Ex: @votre_nom" 
                    value="@flashprompt"
                >
            </div>
            
            <div class="form-group">
                <label class="form-label" for="domain-select">Domaine de l'application:</label>
                <select 
                    id="domain-select" 
                    class="form-select"
                >
                    <option value="mathematiques" selected>Mathématiques</option>
                    <option value="physique">Sciences Physiques</option>
                    <option value="chimie">Chimie</option>
                    <option value="biologie">Biologie</option>
                    <option value="histoire">Histoire</option>
                    <option value="geographie">Géographie</option>
                    <option value="francais">Français</option>
                    <option value="langues">Langues étrangères</option>
                    <option value="informatique">Informatique</option>
                    <option value="economie">Économie</option>
                    <option value="philosophie">Philosophie</option>
                    <option value="custom">Personnalisé</option>
                </select>
            </div>
            
            <div class="form-group" id="custom-domain-container" style="display: none;">
                <label class="form-label" for="custom-domain">Domaine personnalisé:</label>
                <input 
                    type="text" 
                    id="custom-domain" 
                    class="form-input" 
                    placeholder="Entrez votre domaine personnalisé"
                >
            </div>

            <div class="form-group">
                <label class="form-label">Niveaux scolaires ciblés (sélection multiple):</label>
                
                <div class="levels-grid">
                    <div class="level-column">
                        <div class="level-title">Collège</div>
                        <div class="level-options">
                            <div class="checkbox-container">
                                <input 
                                    type="checkbox" 
                                    id="level-6" 
                                    value="6ème"
                                >
                                <label for="level-6">6ème</label>
                            </div>
                            <div class="checkbox-container">
                                <input 
                                    type="checkbox" 
                                    id="level-5" 
                                    value="5ème"
                                >
                                <label for="level-5">5ème</label>
                            </div>
                            <div class="checkbox-container">
                                <input 
                                    type="checkbox" 
                                    id="level-4" 
                                    value="4ème"
                                >
                                <label for="level-4">4ème</label>
                            </div>
                            <div class="checkbox-container">
                                <input 
                                    type="checkbox" 
                                    id="level-3" 
                                    value="3ème"
                                    checked
                                >
                                <label for="level-3">3ème</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="level-column">
                        <div class="level-title">Lycée Général</div>
                        <div class="level-options">
                            <div class="checkbox-container">
                                <input 
                                    type="checkbox" 
                                    id="level-2" 
                                    value="2nde"
                                >
                                <label for="level-2">2nde</label>
                            </div>
                            <div class="checkbox-container">
                                <input 
                                    type="checkbox" 
                                    id="level-1" 
                                    value="1ère"
                                >
                                <label for="level-1">1ère</label>
                            </div>
                            <div class="checkbox-container">
                                <input 
                                    type="checkbox" 
                                    id="level-t" 
                                    value="Terminale"
                                >
                                <label for="level-t">Terminale</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="level-column">
                        <div class="level-title">Lycée Pro / Supérieur</div>
                        <div class="level-options">
                            <div class="checkbox-container">
                                <input 
                                    type="checkbox" 
                                    id="level-cap" 
                                    value="CAP"
                                >
                                <label for="level-cap">CAP</label>
                            </div>
                            <div class="checkbox-container">
                                <input 
                                    type="checkbox" 
                                    id="level-bac" 
                                    value="Bac Pro"
                                >
                                <label for="level-bac">Bac Pro</label>
                            </div>
                            <div class="checkbox-container">
                                <input 
                                    type="checkbox" 
                                    id="level-sup" 
                                    value="Supérieur"
                                >
                                <label for="level-sup">Supérieur</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="selected-levels" id="selected-levels-display">
                    Niveaux sélectionnés: 3ème
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="flashcards-count">Nombre de flashcards:</label>
                <input 
                    type="number" 
                    id="flashcards-count" 
                    class="form-input" 
                    min="5" 
                    max="50" 
                    value="10"
                >
            </div>

            <div class="buttons">
                <button 
                    class="btn btn-secondary" 
                    id="reset-button"
                >
                    <i class="fas fa-sync-alt"></i> Réinitialiser
                </button>
                <button 
                    class="btn btn-primary" 
                    id="next-tab-1"
                >
                    Suivant <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Tab 2: Contenu -->
        <div id="tab-content-2" class="tab-content">
            <h2 class="step-title">Étape 2: Contenu des flashcards</h2>
            
            <div class="ai-generation-container">
                <div class="ai-generation-header">
                    <div class="ai-generation-title">
                        <i class="fas fa-robot"></i> Génération IA
                        <span id="api-connection-status" class="api-connected-indicator disconnected">
                            <i class="fas fa-circle"></i> API non configurée
                        </span>
                    </div>
                    <button id="configure-ai-btn" class="ai-config-btn">
                        <i class="fas fa-cog"></i> Configurer
                    </button>
                </div>
                <div class="ai-generation-content">
                    <div class="ai-temperature-slider">
                        <label>
                            <span>Créativité (température): <span id="temperature-value">0.7</span></span>
                            <span>Précis</span>
                            <span>Créatif</span>
                        </label>
                        <input type="range" id="ai-temperature" min="0.1" max="1.0" step="0.1" value="0.7">
                    </div>
                    <div class="ai-generation-buttons">
                        <button id="ai-suggest-content-type" class="btn btn-special">
                            <i class="fas fa-lightbulb"></i> Suggérer un type de contenu
                        </button>
                        <button id="ai-generate-theme" class="btn btn-special">
                            <i class="fas fa-magic"></i> Générer un thème
                        </button>
                        <button id="ai-generate-examples" class="btn btn-special">
                            <i class="fas fa-wand-magic-sparkles"></i> Générer des exemples
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="content-type">Type de contenu:</label>
                <div style="display: flex; gap: 10px; align-items: center">
                    <select 
                        id="content-type" 
                        class="form-select" 
                        style="flex-grow: 1"
                    >
                        <option value="question-answer" selected>Questions / Réponses</option>
                        <option value="term-definition">Termes / Définitions</option>
                        <option value="formula-example">Formules / Exemples</option>
                        <option value="translation">Traductions</option>
                        <option value="problem-solution">Problèmes / Solutions</option>
                        <option value="custom">Personnalisé</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="categories-enabled">Utiliser des catégories de cartes:</label>
                <select 
                    id="categories-enabled" 
                    class="form-select"
                >
                    <option value="yes">Oui</option>
                    <option value="no" selected>Non</option>
                </select>
            </div>
            
            <div class="category-container" id="categories-container" style="display: none;">
                <label class="form-label">Définir les catégories:</label>
                <div id="categories-list">
                    <div class="category-row">
                        <input 
                            type="text" 
                            class="form-input category-input" 
                            placeholder="Nom de la catégorie"
                        >
                        <button class="remove-btn category-remove-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <button 
                    class="btn btn-secondary" 
                    id="add-category-btn"
                    style="margin-top: 10px"
                >
                    <i class="fas fa-plus"></i> Ajouter une catégorie
                </button>
            </div>

            <div class="form-group">
                <label class="form-label" for="ai-content-generation">Génération du contenu:</label>
                <select 
                    id="ai-content-generation" 
                    class="form-select"
                >
                    <option value="ai-full">Entièrement généré par IA</option>
                    <option value="ai-assisted">Assistant par IA avec supervision</option>
                    <option value="manual" selected>Manuel (défini dans le prompt)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="content-theme">Thème spécifique ou consignes (optionnel):</label>
                <textarea 
                    id="content-theme" 
                    class="form-textarea" 
                    placeholder="Ex: Concentrez-vous sur les formules de géométrie dans l'espace, avec une attention particulière sur les calculs de volumes et surfaces"
                ></textarea>
            </div>

            <div class="form-group">
                <label class="form-label" for="example-flashcards">Exemples de flashcards:</label>
                <textarea 
                    id="example-flashcards" 
                    class="form-textarea" 
                    placeholder="Ex: Question: Quelle est la formule du volume d'une sphère? Réponse: V = (4/3)πr³"
                ></textarea>
            </div>

            <div id="ai-examples-container" class="examples-container" style="display: none;">
                <h3 style="margin-bottom: 10px; color: var(--accent-color);">Exemples générés par IA</h3>
                <div id="generated-examples">
                    <!-- Les exemples générés apparaîtront ici -->
                </div>
            </div>

            <div class="flashcard-preview">
                <div class="flashcard">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <h3>Question</h3>
                            <p>Quel est le théorème de Pythagore?</p>
                        </div>
                        <div class="flashcard-back">
                            <p>Dans un triangle rectangle, le carré de l'hypoténuse est égal à la somme des carrés des deux autres côtés.</p>
                            <p>a² + b² = c²</p>
                            <div class="evaluation-btns">
                                <button class="correct-btn">Correct</button>
                                <button class="incorrect-btn">Incorrect</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="buttons">
                <button 
                    class="btn btn-secondary" 
                    id="prev-tab-2"
                >
                    <i class="fas fa-arrow-left"></i> Précédent
                </button>
                <button 
                    class="btn btn-primary" 
                    id="next-tab-2"
                >
                    Suivant <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Tab 3: Apparence -->
        <div id="tab-content-3" class="tab-content">
            <h2 class="step-title">Étape 3: Apparence et style</h2>
            
            <div class="form-group">
                <label class="form-label">Styles prédéfinis:</label>
                <div class="style-presets-container">
                    <div class="style-preset" data-style="modern" data-color="blue" data-animation="slide" data-interface="tabs">
                        <div class="preset-preview" style="background: linear-gradient(135deg, #2255cc22, #2255cc11); border-color: #2255cc;">
                            <div class="preset-options">
                                <span class="preset-option" style="background-color: #f5f5f5; border-left: 3px solid #2255cc;"></span>
                                <span class="preset-option" style="background-color: #f5f5f5;"></span>
                                <span class="preset-option" style="background-color: #f5f5f5;"></span>
                                <span class="preset-option selected" style="background-color: #e6f0ff; border-left: 3px solid #2255cc;"></span>
                            </div>
                        </div>
                        <div class="preset-title">Professionnel <span class="color-dot" style="background-color: #2255cc;"></span></div>
                    </div>
                    
                    <div class="style-preset" data-style="playful" data-color="orange" data-animation="flip-horizontal" data-interface="cards">
                        <div class="preset-preview" style="background: #fff9e6; border: 3px dashed #d14b2c;">
                            <div class="preset-options">
                                <span class="preset-option" style="background-color: #f5f5f5; border-radius: 15px;"></span>
                                <span class="preset-option selected" style="background-color: #ffebdc; border-radius: 15px; border: 2px solid #d14b2c;"></span>
                                <span class="preset-option" style="background-color: #f5f5f5; border-radius: 15px;"></span>
                                <span class="preset-option" style="background-color: #f5f5f5; border-radius: 15px;"></span>
                            </div>
                        </div>
                        <div class="preset-title">Ludique <span class="color-dot" style="background-color: #d14b2c;"></span></div>
                    </div>
                    
                    <div class="style-preset" data-style="minimal" data-color="green" data-animation="fade" data-interface="single-page">
                        <div class="preset-preview" style="background-color: #fafafa; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                            <div class="preset-options">
                                <span class="preset-option" style="background-color: #f5f5f5; border: 1px solid #eee;"></span>
                                <span class="preset-option" style="background-color: #f5f5f5; border: 1px solid #eee;"></span>
                                <span class="preset-option selected" style="background-color: #e8f5e9; border: 1px solid #22cc55;"></span>
                                <span class="preset-option" style="background-color: #f5f5f5; border: 1px solid #eee;"></span>
                            </div>
                        </div>
                        <div class="preset-title">Minimaliste <span class="color-dot" style="background-color: #22cc55;"></span></div>
                    </div>
                    
                    <div class="style-preset" data-style="classic" data-color="red" data-animation="flip-horizontal" data-interface="wizard">
                        <div class="preset-preview" style="background-color: #f9f9f9; border: 1px solid #ddd;">
                            <div class="preset-options">
                                <span class="preset-option selected" style="background-color: #ffebee; border: 1px solid #cc2222;"></span>
                                <span class="preset-option" style="background-color: #f5f5f5; border: 1px solid #ddd;"></span>
                                <span class="preset-option" style="background-color: #f5f5f5; border: 1px solid #ddd;"></span>
                                <span class="preset-option" style="background-color: #f5f5f5; border: 1px solid #ddd;"></span>
                            </div>
                        </div>
                        <div class="preset-title">Classique <span class="color-dot" style="background-color: #cc2222;"></span></div>
                    </div>
                    
                    <div class="style-preset" data-style="gradient" data-color="purple" data-animation="slide" data-interface="tabs">
                        <div class="preset-preview" style="background: linear-gradient(135deg, #6222cc22, #6222cc11);">
                            <div class="preset-options">
                                <span class="preset-option" style="background-color: #f5f5f5;"></span>
                                <span class="preset-option" style="background-color: #f5f5f5;"></span>
                                <span class="preset-option" style="background-color: #f5f5f5;"></span>
                                <span class="preset-option selected" style="background-color: #f0e6ff; border-left: 3px solid #6222cc;"></span>
                            </div>
                        </div>
                        <div class="preset-title">Sophistiqué <span class="color-dot" style="background-color: #6222cc;"></span></div>
                    </div>
                    
                    <div class="style-preset" data-style="modern" data-color="teal" data-animation="flip-horizontal" data-interface="cards">
                        <div class="preset-preview" style="background-color: #ffffff; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);">
                            <div class="preset-options">
                                <span class="preset-option" style="background-color: #f5f5f5;"></span>
                                <span class="preset-option selected" style="background-color: #e0f2f1; border-left: 3px solid #009688;"></span>
                                <span class="preset-option" style="background-color: #f5f5f5;"></span>
                                <span class="preset-option" style="background-color: #f5f5f5;"></span>
                            </div>
                        </div>
                        <div class="preset-title">Moderne <span class="color-dot" style="background-color: #009688;"></span></div>
                    </div>
                </div>
            </div>            
            
            <div class="buttons" style="margin-bottom: 20px">
                <button 
                    class="btn btn-primary" 
                    id="recommend-style-btn"
                >
                    <i class="fas fa-magic"></i> Recommandation IA de style
                </button>
                <button 
                    class="btn btn-special" 
                    id="generate-palette-btn"
                >
                    <i class="fas fa-palette"></i> Générer palette de couleurs
                </button>
            </div>
            
            <div class="flashcard-params">
                <div class="param-card">
                    <div class="param-title">Style des flashcards</div>
                    <div class="form-group">
                        <label class="form-label" for="card-style">Thème visuel:</label>
                        <div style="display: flex; gap: 10px; align-items: center">
                            <select 
                                id="card-style" 
                                class="form-select" 
                                style="flex-grow: 1"
                            >
                                <option value="classic">Classique</option>
                                <option value="modern" selected>Moderne</option>
                                <option value="playful">Ludique</option>
                                <option value="minimal">Minimaliste</option>
                                <option value="gradient">Dégradé</option>
                            </select>
                            <button 
                                class="btn btn-special" 
                                id="suggest-style-btn"
                                style="padding: 5px; min-width: 36px"
                            >
                                <i class="fas fa-robot"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="param-card">
                    <div class="param-title">Animation de retournement</div>
                    <div class="form-group">
                        <label class="form-label" for="flip-animation">Type d'animation:</label>
                        <div style="display: flex; gap: 10px; align-items: center">
                            <select 
                                id="flip-animation" 
                                class="form-select" 
                                style="flex-grow: 1"
                            >
                                <option value="flip-horizontal" selected>Retournement horizontal</option>
                                <option value="flip-vertical">Retournement vertical</option>
                                <option value="fade">Fondu</option>
                                <option value="slide">Glissement</option>
                            </select>
                            <button 
                                class="btn btn-special" 
                                id="suggest-animation-btn"
                                style="padding: 5px; min-width: 36px"
                            >
                                <i class="fas fa-robot"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="param-card">
                    <div class="param-title">Couleur principale</div>
                    <div class="form-group">
                        <label class="form-label" for="primary-color">Couleur:</label>
                        <div style="display: flex; gap: 10px; align-items: center">
                            <select 
                                id="primary-color" 
                                class="form-select" 
                                style="flex-grow: 1"
                            >
                                <option value="purple" selected>Violet</option>
                                <option value="blue">Bleu</option>
                                <option value="red">Rouge</option>
                                <option value="green">Vert</option>
                                <option value="orange">Orange</option>
                                <option value="teal">Turquoise</option>
                            </select>
                            <button 
                                class="btn btn-special" 
                                id="suggest-color-btn"
                                style="padding: 5px; min-width: 36px"
                            >
                                <i class="fas fa-robot"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="param-card">
                    <div class="param-title">Interface</div>
                    <div class="form-group">
                        <label class="form-label" for="interface-style">Style d'interface:</label>
                        <div style="display: flex; gap: 10px; align-items: center">
                            <select 
                                id="interface-style" 
                                class="form-select" 
                                style="flex-grow: 1"
                            >
                                <option value="tabs" selected>Onglets</option>
                                <option value="cards">Cartes</option>
                                <option value="wizard">Assistant étape par étape</option>
                                <option value="single-page">Page unique</option>
                            </select>
                            <button 
                                class="btn btn-special" 
                                id="suggest-interface-btn"
                                style="padding: 5px; min-width: 36px"
                            >
                                <i class="fas fa-robot"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="custom-styles">Styles personnalisés (CSS - optionnel):</label>
                <textarea 
                    id="custom-styles" 
                    class="form-textarea" 
                    placeholder="/* Ajoutez vos styles CSS personnalisés ici */"
                ></textarea>
            </div>

            <div class="form-group">
                <label class="form-label" for="progress-tracking">Type de suivi de progression:</label>
                <select 
                    id="progress-tracking" 
                    class="form-select"
                >
                    <option value="score">Score simple</option>
                    <option value="percentage" selected>Pourcentage</option>
                    <option value="badges">Badges</option>
                    <option value="levels">Niveaux</option>
                </select>
            </div>

            <div class="buttons">
                <button 
                    class="btn btn-secondary" 
                    id="prev-tab-3"
                >
                    <i class="fas fa-arrow-left"></i> Précédent
                </button>
                <button 
                    class="btn btn-primary" 
                    id="next-tab-3"
                >
                    Suivant <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Tab 4: Certificat -->
        <div id="tab-content-4" class="tab-content">
            <h2 class="step-title">Étape 4: Configuration du certificat</h2>
            
            <div class="buttons" style="margin-bottom: 20px">
                <button 
                    class="btn btn-primary" 
                    id="generate-certificate-template"
                >
                    <i class="fas fa-certificate"></i> Générer un template de certificat
                </button>
                <button 
                    class="btn btn-special" 
                    id="generate-certificate-text"
                >
                    <i class="fas fa-file-alt"></i> Générer le texte du certificat
                </button>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="certificate-enabled">Activer le certificat de fin:</label>
                <select 
                    id="certificate-enabled" 
                    class="form-select"
                >
                    <option value="yes" selected>Oui</option>
                    <option value="no">Non</option>
                </select>
            </div>
            
            <div id="certificate-options">
                <div class="form-group">
                    <label class="form-label" for="certificate-title">Titre du certificat:</label>
                    <div style="display: flex; gap: 10px; align-items: center">
                        <input 
                            type="text" 
                            id="certificate-title" 
                            class="form-input" 
                            placeholder="Ex: Certificat de Réussite" 
                            value="Certificat de Réussite"
                            style="flex-grow: 1"
                        >
                        <button 
                            class="btn btn-special" 
                            id="suggest-certificate-title"
                            style="padding: 5px; min-width: 36px"
                        >
                            <i class="fas fa-robot"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="certificate-style">Style du certificat:</label>
                    <div style="display: flex; gap: 10px; align-items: center">
                        <select 
                            id="certificate-style" 
                            class="form-select" 
                            style="flex-grow: 1"
                        >
                            <option value="classic">Classique</option>
                            <option value="modern" selected>Moderne</option>
                            <option value="elegant">Élégant</option>
                            <option value="playful">Ludique</option>
                        </select>
                        <button 
                            class="btn btn-special" 
                            id="suggest-certificate-style"
                            style="padding: 5px; min-width: 36px"
                        >
                            <i class="fas fa-robot"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="certificate-info">Informations requises pour le certificat:</label>
                    <select 
                        id="certificate-info" 
                        class="form-select"
                    >
                        <option value="name-only">Nom seulement</option>
                        <option value="name-class" selected>Nom et classe</option>
                        <option value="full">Informations complètes</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="certificate-export">Options d'exportation:</label>
                    <select 
                        id="certificate-export" 
                        class="form-select"
                    >
                        <option value="print">Impression seulement</option>
                        <option value="print-pdf" selected>Impression et PDF</option>
                        <option value="print-pdf-image">Impression, PDF et Image</option>
                    </select>
                </div>
                
                <!-- Ajout du taux de réussite requis pour débloquer le certificat -->
                <div class="form-group">
                    <label class="form-label" for="certificate-threshold">Taux de réussite requis pour débloquer le certificat:</label>
                    <select 
                        id="certificate-threshold" 
                        class="form-select"
                    >
                        <option value="0">Pas de seuil minimum</option>
                        <option value="50">50%</option>
                        <option value="60">60%</option>
                        <option value="70" selected>70%</option>
                        <option value="80">80%</option>
                        <option value="90">90%</option>
                        <option value="100">100%</option>
                    </select>
                </div>
                
                <div class="certificate-preview" id="certificate-preview">
                    <h2>Certificat de Réussite</h2>
                    <p>Ce certificat atteste que</p>
                    <p><strong>Nom de l'étudiant</strong></p>
                    <p><strong>Classe: 3ème</strong></p>
                    <p>a complété avec succès le cours de</p>
                    <p><strong>Mathématiques - FlashCards - Révision</strong></p>
                    
                    <div class="score">
                        Score: 8/10
                    </div>
                    
                    <div class="date">Date: <span id="certificate-date">19/05/2025</span></div>
                    
                    <div class="signatures">
                        <div class="signature-box">
                            <div class="signature-line"></div>
                            <p>Professeur</p>
                            <p>@flashprompt</p>
                        </div>
                        
                        <div class="signature-box">
                            <div class="signature-line"></div>
                            <p>Étudiant</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="buttons">
                <button 
                    class="btn btn-secondary" 
                    id="prev-tab-4"
                >
                    <i class="fas fa-arrow-left"></i> Précédent
                </button>
                <button 
                    class="btn btn-primary" 
                    id="next-tab-4"
                >
                    Suivant <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Tab 5: Prompt Final (remplace l'ancien onglet API & IA + Prompt) -->
        <div id="tab-content-5" class="tab-content">
            <h2 class="step-title">Étape 5: Génération et utilisation du prompt</h2>
            
            <div class="buttons" style="margin-bottom: 20px">
                <button 
                    class="btn btn-primary" 
                    id="generate-prompt-btn"
                >
                    <i class="fas fa-wand-magic-sparkles"></i> Générer le prompt
                </button>
                <button 
                    class="btn btn-special" 
                    id="copy-prompt-btn"
                >
                    <i class="fas fa-copy"></i> Copier le prompt
                </button>
                <button 
                    class="btn btn-secondary" 
                    id="download-prompt-btn"
                >
                    <i class="fas fa-download"></i> Télécharger le prompt
                </button>
            </div>

            <div class="form-group">
                <label class="form-label" for="prompt-template">Optimiser le prompt pour:</label>
                <select 
                    id="prompt-template" 
                    class="form-select"
                >
                    <option value="accuracy" selected>Précision (priorité au contenu éducatif)</option>
                    <option value="design">Design (priorité à l'apparence)</option>
                    <option value="features">Fonctionnalités (priorité aux fonctions avancées)</option>
                    <option value="balanced">Équilibré</option>
                    <option value="technical">Détails techniques (code HTML/CSS/JS)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="include-code">Inclure le code technique:</label>
                <select 
                    id="include-code" 
                    class="form-select"
                >
                    <option value="yes" selected>Oui, inclure le code HTML/CSS/JS</option>
                    <option value="no">Non, seulement les instructions générales</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="additional-instructions">Instructions supplémentaires (optionnel):</label>
                <textarea 
                    id="additional-instructions" 
                    class="form-textarea" 
                    placeholder="Ex: Ajouter une fonctionnalité de recherche de flashcards par mot-clé"
                ></textarea>
            </div>
            
            <div class="form-group">
                <div class="preview-container">
                    <div class="preview-header">
                        <h3>Prompt généré</h3>
                        <div>
                            <button 
                                class="btn btn-special" 
                                id="toggle-technical-btn" 
                                title="Afficher/masquer les sections techniques"
                            >
                                <i class="fas fa-code"></i> Afficher sections techniques
                            </button>
                        </div>
                    </div>
                    <div class="preview-content" id="prompt-preview">
                        Le prompt sera généré ici...
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <div class="info-container">
                    <h3>Comment utiliser ce prompt?</h3>
                    <ol>
                        <li>Copiez le prompt généré en utilisant le bouton "Copier le prompt"</li>
                        <li>Rendez-vous sur l'interface de votre IA préférée (Claude, ChatGPT, etc.)</li>
                        <li>Collez le prompt dans la zone de texte</li>
                        <li>Envoyez le message et attendez que l'IA génère votre application de flashcards</li>
                        <li>Copiez le code généré dans un fichier HTML et ouvrez-le dans votre navigateur</li>
                    </ol>
                </div>
            </div>

            <div class="buttons">
                <button 
                    class="btn btn-secondary" 
                    id="prev-tab-5"
                >
                    <i class="fas fa-arrow-left"></i> Précédent
                </button>
                <button 
                    class="btn btn-primary" 
                    id="open-claude-btn"
                >
                    <i class="fas fa-robot"></i> Ouvrir Claude
                </button>
                <button 
                    class="btn btn-secondary" 
                    id="open-chatgpt-btn"
                >
                    <i class="fas fa-comment-dots"></i> Ouvrir ChatGPT
                </button>
                <button 
                    class="btn btn-special" 
                    id="open-mistral-btn"
                >
                    <i class="fas fa-cloud"></i> Ouvrir MistralAI
                </button>
                <button 
                    class="btn btn-secondary" 
                    id="open-gemini-btn"
                >
                    <i class="fas fa-globe"></i> Ouvrir Gemini
                </button>
                <button 
                    class="btn btn-special" 
                    id="use-connected-api-btn"
                    style="display: none;"
                >
                    <i class="fas fa-bolt"></i> Utiliser l'API connectée
                </button>
            </div>
        </div>

        <!-- Modal pour la configuration API (remplace l'onglet) -->
        <div id="api-config-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title"><i class="fas fa-cog"></i> Configuration des API d'Intelligence Artificielle</h2>
                    <button class="close-modal">&times;</button>
                </div>
                
                <p style="margin-bottom: 20px;">Configurez vos clés API pour générer du contenu directement depuis l'application.</p>
                
                <div class="form-group">
                    <label class="form-label" for="ai-provider">Fournisseur d'IA à utiliser:</label>
                    <select 
                        id="ai-provider" 
                        class="form-select"
                    >
                        <option value="anthropic">Anthropic Claude</option>
                        <option value="openai">OpenAI ChatGPT</option>
                        <option value="mistral" selected>Mistral AI</option>
                        <option value="gemini">Google Gemini</option>
                    </select>
                </div>
                
                <!-- Section de configuration Claude -->
                <div class="api-config-section" id="anthropic-config" style="display:none;">
                    <div class="api-header">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/86/Anthropic_logo.svg/1200px-Anthropic_logo.svg.png" alt="Anthropic Logo" width="30" height="30" style="margin-right: 10px">
                        <h4>Anthropic Claude</h4>
                    </div>
                    <div class="api-input-group">
                        <label for="claude-api-key">Clé API:</label>
                        <div class="api-input-wrapper">
                            <input 
                                type="password" 
                                id="claude-api-key" 
                                placeholder="Collez votre clé API Claude ici..." 
                            >
                            <button 
                                class="toggle-visibility-btn" 
                                data-target="claude-api-key"
                            >
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <span class="api-format-info">
                            Format: sk-ant-apiXXX-XXX...
                        </span>
                    </div>
                    <div class="api-model-select">
                        <label for="claude-model">Modèle:</label>
                        <select id="claude-model">
                            <option value="claude-3-7-sonnet-20250219" selected>Claude 3.7 Sonnet (dernière version)</option>
                            <option value="claude-3-5-sonnet-20240620">Claude 3.5 Sonnet</option>
                            <option value="claude-3-opus-20240229">Claude 3 Opus</option>
                            <option value="claude-3-haiku-20240307">Claude 3 Haiku</option>
                        </select>
                    </div>
                    <button 
                        class="btn test-api-btn" 
                        data-service="anthropic"
                    >
                        Tester la connexion
                    </button>
                    <div id="anthropic-api-status" class="api-status"></div>
                </div>
                
                <!-- Section de configuration OpenAI -->
                <div class="api-config-section" id="openai-config" style="display:none;">
                    <div class="api-header">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4d/OpenAI_Logo.svg/1024px-OpenAI_Logo.svg.png" alt="OpenAI Logo" width="30" height="30" style="margin-right: 10px">
                        <h4>OpenAI</h4>
                    </div>
                    <div class="api-input-group">
                        <label for="openai-api-key">Clé API:</label>
                        <div class="api-input-wrapper">
                            <input 
                                type="password" 
                                id="openai-api-key" 
                                placeholder="Collez votre clé API OpenAI ici..." 
                            >
                            <button 
                                class="toggle-visibility-btn" 
                                data-target="openai-api-key"
                            >
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <span class="api-format-info">
                            Format: sk-xxxxxxxxxxxxx...
                        </span>
                    </div>
                    <div class="api-model-select">
                        <label for="openai-model">Modèle:</label>
                        <select id="openai-model">
                            <option value="gpt-4o" selected>GPT-4o</option>
                            <option value="gpt-4-turbo">GPT-4 Turbo</option>
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                        </select>
                    </div>
                    <button 
                        class="btn test-api-btn" 
                        data-service="openai"
                    >
                        Tester la connexion
                    </button>
                    <div id="openai-api-status" class="api-status"></div>
                </div>
                
                <!-- Section de configuration Mistral -->
                <div class="api-config-section" id="mistral-config">
                    <div class="api-header">
                        <img src="https://avatars.githubusercontent.com/u/139895814" alt="Mistral Logo" width="30" height="30" style="margin-right: 10px">
                        <h4>Mistral AI</h4>
                    </div>
                    <div class="api-input-group">
                        <label for="mistral-api-key">Clé API:</label>
                        <div class="api-input-wrapper">
                            <input 
                                type="password" 
                                id="mistral-api-key" 
                                placeholder="Collez votre clé API Mistral ici..." 
                            >
                            <button 
                                class="toggle-visibility-btn" 
                                data-target="mistral-api-key"
                            >
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <span class="api-format-info">
                            Format: clé de Mistral qui commence par ag:
                        </span>
                    </div>
                    <div class="api-model-select">
                        <label for="mistral-model">Modèle:</label>
                        <select id="mistral-model">
                            <option value="mistral-large-latest" selected>Mistral Large</option>
                            <option value="mistral-medium-latest">Mistral Medium</option>
                            <option value="mistral-small-latest">Mistral Small</option>
                            <option value="open-mistral-7b">Open Mistral 7B</option>
                        </select>
                    </div>
                    <button 
                        class="btn test-api-btn" 
                        data-service="mistral"
                    >
                        Tester la connexion
                    </button>
                    <div id="mistral-api-status" class="api-status"></div>
                    <div id="mistral-debug-log" class="api-debug-log"></div>
                </div>
                
                <!-- Section de configuration Gemini -->
                <div class="api-config-section" id="gemini-config" style="display:none;">
                    <div class="api-header">
                        <img src="https://storage.googleapis.com/gweb-uniblog-publish-prod/images/gemini_advanced_logo.max-1000x1000.png" alt="Gemini Logo" width="30" height="30" style="margin-right: 10px">
                        <h4>Google Gemini</h4>
                    </div>
                    <div class="api-input-group">
                        <label for="gemini-api-key">Clé API:</label>
                        <div class="api-input-wrapper">
                            <input 
                                type="password" 
                                id="gemini-api-key" 
                                placeholder="Collez votre clé API Gemini ici..." 
                            >
                            <button 
                                class="toggle-visibility-btn" 
                                data-target="gemini-api-key"
                            >
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <span class="api-format-info">
                            Format: clé de la console Google AI
                        </span>
                    </div>
                    <div class="api-model-select">
                        <label for="gemini-model">Modèle:</label>
                        <select id="gemini-model">
                            <option value="gemini-1.5-pro" selected>Gemini 1.5 Pro</option>
                            <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                        </select>
                    </div>
                    <button 
                        class="btn test-api-btn" 
                        data-service="gemini"
                    >
                        Tester la connexion
                    </button>
                    <div id="gemini-api-status" class="api-status"></div>
                </div>
                
                <div class="buttons" style="margin-top: 20px;">
                    <button class="btn btn-primary" id="save-api-settings">
                        <i class="fas fa-save"></i> Sauvegarder la configuration
                    </button>
                    <button class="btn btn-secondary close-modal-btn">
                        <i class="fas fa-times"></i> Fermer
                    </button>
                </div>
            </div>
        </div>

        <div class="notification" id="notification">Opération réussie!</div>
    </div>

    <script>
        // ====================================
        // VARIABLES D'ÉTAT GLOBALES
        // ====================================
        let appState = {
            activeTab: 1,
            appTitle: "FlashCards - Révision",
            appSubtitle: "",
            appAuthor: "@flashprompt",
            domain: "mathematiques",
            customDomain: "",
            flashcardsCount: 10,
            selectedLevels: ["3ème"],
            contentType: "question-answer",
            categoriesEnabled: "no",
            categories: [""],
            aiContentGeneration: "manual",
            contentTheme: "",
            exampleFlashcards: "",
            generatedExamples: [],
            cardStyle: "modern",
            flipAnimation: "flip-horizontal",
            primaryColor: "purple",
            interfaceStyle: "tabs",
            customStyles: "",
            progressTracking: "percentage",
            certificateEnabled: "yes",
            certificateTitle: "Certificat de Réussite",
            certificateStyle: "modern",
            certificateInfo: "name-class",
            certificateExport: "print-pdf",
            certificateThreshold: "70",
            promptTemplate: "accuracy",
            includeCode: "yes",
            additionalInstructions: "",
            showTechnicalSections: true,
            promptResult: "",
            // Configuration API
            apiState: {
                defaultAIService: 'mistral',
                temperature: 0.7,
                apiConfig: {
                    anthropic: {
                        key: '',
                        model: 'claude-3-7-sonnet-20250219'
                    },
                    openai: {
                        key: '',
                        model: 'gpt-4o'
                    },
                    mistral: {
                        key: '',
                        model: 'mistral-large-latest'
                    },
                    gemini: {
                        key: '',
                        model: 'gemini-1.5-pro'
                    }
                }
            },
            // Pour garder trace du style sélectionné
            selectedStylePreset: null
        };

        // ====================================
        // MISTRAL API CONNECTOR 
        // ====================================
        
        /**
         * Configuration de l'API Mistral
         * @type {Object}
         */
        const mistralConfig = {
            key: '', // Votre clé API Mistral
            model: 'mistral-large-latest', // Modèle par défaut
            endpoint: 'https://api.mistral.ai/v1/chat/completions'
        };

        /**
         * Modèles disponibles de Mistral AI
         * @type {Object}
         */
        const MISTRAL_MODELS = {
            LARGE: 'mistral-large-latest',
            MEDIUM: 'mistral-medium-latest',
            SMALL: 'mistral-small-latest'
        };

        /**
         * Appelle l'API Mistral avec un prompt donné
         * @param {string} prompt - Le texte de la requête
         * @param {number} temperature - Contrôle la créativité (0.0 à 1.0)
         * @param {number} maxTokens - Nombre maximum de tokens à générer
         * @returns {Promise<string>} - Texte de la réponse
         */
        async function callMistralAPI(prompt, temperature = 0.7, maxTokens = 2000) {
            // Vérifier si la clé API est configurée
            if (!mistralConfig.key) {
                throw new Error("Clé API Mistral non configurée");
            }
            
            // Préparer les en-têtes et le corps de la requête
            const headers = {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${mistralConfig.key}`
            };
            
            const body = {
                model: mistralConfig.model,
                messages: [{ role: "user", content: prompt }],
                max_tokens: maxTokens,
                temperature: temperature
            };
            
            // Effectuer la requête
            try {
                const response = await fetch(mistralConfig.endpoint, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(body)
                });
                
                // Gérer les erreurs HTTP
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `Erreur API (${response.status})`);
                }
                
                // Traiter la réponse
                const data = await response.json();
                return data.choices?.[0]?.message?.content || "";
                
            } catch (error) {
                console.error("Erreur lors de l'appel à l'API Mistral:", error);
                throw error;
            }
        }

        /**
         * Fonction plus avancée pour envoyer une conversation complète à l'API Mistral
         * @param {Array} messages - Tableau de messages au format [{role: "user"|"assistant", content: "message"}]
         * @param {Object} options - Options supplémentaires (temperature, max_tokens, etc.)
         * @returns {Promise<Object>} - Réponse complète de l'API
         */
        async function mistralChatCompletion(messages, options = {}) {
            if (!mistralConfig.key) {
                throw new Error("Clé API Mistral non configurée");
            }
            
            const headers = {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${mistralConfig.key}`
            };
            
            const body = {
                model: options.model || mistralConfig.model,
                messages: messages,
                max_tokens: options.max_tokens || 2000,
                temperature: options.temperature || 0.7,
                top_p: options.top_p || 1,
                stream: options.stream || false
            };
            
            try {
                const response = await fetch(mistralConfig.endpoint, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(body)
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `Erreur API (${response.status})`);
                }
                
                return await response.json();
            } catch (error) {
                console.error("Erreur lors de l'appel à Mistral Chat API:", error);
                throw error;
            }
        }

        /**
         * Teste la connexion à l'API Mistral
         * @returns {Promise<boolean>} - true si la connexion est réussie, sinon une erreur est levée
         */
        async function testMistralConnection() {
            try {
                const result = await callMistralAPI("Réponds simplement 'Test réussi!'", 0.7, 20);
                console.log("Test de connexion Mistral réussi:", result);
                return true;
            } catch (error) {
                console.error("Échec du test de connexion Mistral:", error);
                throw error;
            }
        }

        /**
         * Configure l'API Mistral avec les paramètres fournis
         * @param {string} apiKey - Clé API Mistral
         * @param {string} model - Modèle à utiliser (optionnel)
         * @returns {void}
         */
        function configureMistralAPI(apiKey, model = null) {
            mistralConfig.key = apiKey;
            if (model) {
                mistralConfig.model = model;
            }
        }

        /**
         * Sauvegarde la configuration Mistral dans le localStorage
         * @returns {void}
         */
        function saveMistralConfig() {
            localStorage.setItem('mistral_api_config', JSON.stringify({
                key: mistralConfig.key,
                model: mistralConfig.model
            }));
        }

        /**
         * Charge la configuration Mistral depuis le localStorage
         * @returns {boolean} - true si la configuration a été chargée avec succès
         */
        function loadMistralConfig() {
            const savedConfig = localStorage.getItem('mistral_api_config');
            if (savedConfig) {
                try {
                    const config = JSON.parse(savedConfig);
                    mistralConfig.key = config.key || mistralConfig.key;
                    mistralConfig.model = config.model || mistralConfig.model;
                    return true;
                } catch (error) {
                    console.error("Erreur lors du chargement de la configuration Mistral:", error);
                    return false;
                }
            }
            return false;
        }

        // ====================================
        // MAPPAGES DE VALEURS
        // ====================================
        const domainMap = {
            'mathematiques': 'Mathématiques',
            'physique': 'Sciences Physiques',
            'chimie': 'Chimie',
            'biologie': 'Biologie',
            'histoire': 'Histoire',
            'geographie': 'Géographie',
            'francais': 'Français',
            'langues': 'Langues étrangères',
            'informatique': 'Informatique',
            'economie': 'Économie',
            'philosophie': 'Philosophie',
            'custom': 'Personnalisé'
        };
        
        const styleMap = {
            'classic': 'Classique',
            'modern': 'Moderne',
            'playful': 'Ludique',
            'minimal': 'Minimaliste',
            'gradient': 'Dégradé'
        };
        
        const animationMap = {
            'flip-horizontal': 'horizontal',
            'flip-vertical': 'vertical',
            'fade': 'fondu',
            'slide': 'glissement'
        };
        
        const colorMap = {
            'purple': 'Violet',
            'blue': 'Bleu',
            'red': 'Rouge',
            'green': 'Vert',
            'orange': 'Orange',
            'teal': 'Turquoise'
        };
        
        const interfaceMap = {
            'tabs': 'onglets',
            'cards': 'cartes',
            'wizard': 'assistant étape par étape',
            'single-page': 'page unique'
        };
        
        const certificateStyleMap = {
            'classic': 'Classique',
            'modern': 'Moderne',
            'elegant': 'Élégant',
            'playful': 'Ludique'
        };
        
        const certificateInfoMap = {
            'name-only': 'Nom seulement',
            'name-class': 'Nom et classe',
            'full': 'Informations complètes'
        };
        
        const certificateExportMap = {
            'print': 'Impression seulement',
            'print-pdf': 'Impression et PDF',
            'print-pdf-image': 'Impression, PDF et Image'
        };
        
        const contentTypeMap = {
            'question-answer': 'Questions/Réponses',
            'term-definition': 'Termes/Définitions',
            'formula-example': 'Formules/Exemples',
            'translation': 'Traductions',
            'problem-solution': 'Problèmes/Solutions',
            'custom': 'Personnalisé'
        };
        
        const progressTrackingMap = {
            'score': 'score simple',
            'percentage': 'pourcentage',
            'badges': 'badges',
            'levels': 'niveaux'
        };

        // Mappage des services d'API
        const apiServiceMap = {
            'anthropic': 'Claude',
            'openai': 'ChatGPT',
            'mistral': 'Mistral AI',
            'gemini': 'Gemini'
        };

        // ====================================
        // FONCTIONS UTILITAIRES
        // ====================================
        
        // Fonction pour afficher une notification
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Fonction pour changer d'onglet
        function changeTab(tabNumber) {
            // Masquer tous les onglets
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Désactiver tous les boutons d'onglets
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Activer l'onglet sélectionné
            document.getElementById(`tab-content-${tabNumber}`).classList.add('active');
            document.querySelector(`.tab-${tabNumber}`).classList.add('active');
            
            appState.activeTab = tabNumber;
        }

        // Fonction pour mettre à jour l'affichage des niveaux sélectionnés
        function updateSelectedLevelsDisplay() {
            const display = document.getElementById('selected-levels-display');
            display.textContent = appState.selectedLevels.length > 0 
                ? 'Niveaux sélectionnés: ' + appState.selectedLevels.join(', ') 
                : 'Aucun niveau sélectionné';
        }

        // Fonction pour gérer les changements de niveaux scolaires
        function handleLevelChange(value, checked) {
            if (checked) {
                if (!appState.selectedLevels.includes(value)) {
                    appState.selectedLevels.push(value);
                }
            } else {
                appState.selectedLevels = appState.selectedLevels.filter(level => level !== value);
            }
            
            updateSelectedLevelsDisplay();
        }

        // Fonction pour échapper le HTML pour l'affichage
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // ====================================
        // FONCTIONS DE GESTION DES CATÉGORIES
        // ====================================
        
        // Fonction pour ajouter une catégorie
        function addCategory() {
            appState.categories.push('');
            renderCategories();
        }

        // Fonction pour supprimer une catégorie
        function removeCategory(index) {
            appState.categories.splice(index, 1);
            renderCategories();
        }

        // Fonction pour mettre à jour une catégorie
        function updateCategory(index, value) {
            appState.categories[index] = value;
        }

        // Fonction pour rendre la liste des catégories
        function renderCategories() {
            const container = document.getElementById('categories-list');
            container.innerHTML = '';
            
            appState.categories.forEach((category, index) => {
                const categoryRow = document.createElement('div');
                categoryRow.className = 'category-row';
                
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'form-input category-input';
                input.placeholder = 'Nom de la catégorie';
                input.value = category;
                input.dataset.index = index;
                input.addEventListener('input', (e) => {
                    updateCategory(index, e.target.value);
                });
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                removeBtn.addEventListener('click', () => {
                    removeCategory(index);
                });
                
                categoryRow.appendChild(input);
                categoryRow.appendChild(removeBtn);
                container.appendChild(categoryRow);
            });
        }

        // ====================================
        // FONCTIONS DE GÉNÉRATION DE CODE
        // ====================================
        
        // Fonction pour échapper correctement les balises HTML
        function escapeHtmlTags(html) {
            return html
                .replace(/<\/style>/g, "\\u003C/style>")
                .replace(/<\/head>/g, "\\u003C/head>")
                .replace(/<body>/g, "\\u003Cbody>")
                .replace(/<\/body>/g, "\\u003C/body>")
                .replace(/<\/script>/g, "\\u003C/script>")
                .replace(/<\/html>/g, "\\u003C/html>");
        }

        // Fonction pour générer le code HTML de base avec échappement des balises
        function getHtmlBaseCode() {
            return `<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${appState.appTitle}</title>
    <style>
        /* CSS sera inséré ici */
    \u003C/style>
\u003C/head>
\u003Cbody>
    <header>
        <p class="signature-left">${appState.appAuthor}</p>
        <h1 class="app-title">${appState.appTitle}</h1>
        <p class="app-version">V1.0</p>
    </header>
    
    <!-- Structure des onglets et contenus ici -->
    
    <footer>
        <p>© ${new Date().getFullYear()} ${appState.appTitle} - Application de révision</p>
    </footer>
    
    <script>
        // JavaScript sera inséré ici
    \u003C/script>
\u003C/body>
\u003C/html>`;
        }

        // Fonction pour obtenir le code CSS des flashcards
        function getFlashcardCssCode() {
            // Déterminer les couleurs en fonction de primaryColor
            let primaryColorHex;
            switch(appState.primaryColor) {
                case 'purple': primaryColorHex = '#6222cc'; break;
                case 'blue': primaryColorHex = '#2255cc'; break;
                case 'red': primaryColorHex = '#cc2222'; break;
                case 'green': primaryColorHex = '#22cc55'; break;
                case 'orange': primaryColorHex = '#ff8800'; break;
                case 'teal': primaryColorHex = '#009688'; break;
                default: primaryColorHex = '#6222cc';
            }

            // Déterminer le style de la carte
            let cardStyle = '';
            switch(appState.cardStyle) {
                case 'classic':
                    cardStyle = `
        border: 1px solid #ddd;
        background-color: #f9f9f9;`;
                    break;
                case 'modern':
                    cardStyle = `
        border: none;
        background-color: #ffffff;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);`;
                    break;
                case 'playful':
                    cardStyle = `
        border: 3px dashed ${primaryColorHex};
        background-color: #fff9e6;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);`;
                    break;
                case 'minimal':
                    cardStyle = `
        border: none;
        background-color: #fafafa;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);`;
                    break;
                case 'gradient':
                    cardStyle = `
        border: none;
        background: linear-gradient(135deg, ${primaryColorHex}22, ${primaryColorHex}11);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);`;
                    break;
            }

            // Déterminer l'animation
            let flipAnimation = '';
            switch(appState.flipAnimation) {
                case 'flip-horizontal':
                    flipAnimation = 'transform: rotateY(180deg);';
                    break;
                case 'flip-vertical':
                    flipAnimation = 'transform: rotateX(180deg);';
                    break;
                case 'fade':
                    flipAnimation = 'opacity: 0;';
                    break;
                case 'slide':
                    flipAnimation = 'transform: translateX(100%);';
                    break;
            }

            return `/* Styles pour les flashcards */
:root {
    --primary-color: ${primaryColorHex};
    --primary-light: ${primaryColorHex}22;
    --primary-dark: ${primaryColorHex.replace('cc', '99')};
}

.flashcards-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}
.flashcard {
    perspective: 1000px;
    height: 200px;
    cursor: pointer;
}
.flashcard-inner {
    position: relative;
    width: 100%;
    height: 100%;
    text-align: center;
    transition: transform 0.6s;
    transform-style: preserve-3d;
    ${cardStyle}
    border-radius: 6px;
}
.flashcard.flipped .flashcard-inner {
    ${flipAnimation}
}
.flashcard-front, .flashcard-back {
    position: absolute;
    width: 100%;
    height: 100%;
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 15px;
    border-radius: 6px;
}
.flashcard-front p, .flashcard-back p {
    display: -webkit-box;
    -webkit-line-clamp: 5;
    -webkit-box-orient: vertical;
    overflow: hidden;
    line-height: 1.5;
    max-height: 7.5em; /* Fallback pour navigateurs ne supportant pas line-clamp */
}
.flashcard-front {
    background-color: var(--primary-light);
    color: #333;
}
.flashcard-back {
    background-color: var(--primary-color);
    color: white;
    transform: rotateY(180deg);
}
.evaluation-btns {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
}
.correct-btn, .incorrect-btn {
    padding: 5px 10px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
}
.correct-btn {
    background-color: #81c784;
    color: white;
}
.incorrect-btn {
    background-color: #e57373;
    color: white;
}
.correct-btn:hover, .incorrect-btn:hover {
    filter: brightness(1.05);
}

/* IMPORTANT: Les boutons d'évaluation n'apparaissent qu'au verso */
.flashcard-front .evaluation-btns {
    display: none;
}`;
        }

        // Fonction pour obtenir le code JavaScript des flashcards
        function getFlashcardJsCode() {
            return `// Gestion des flashcards
function initializeFlashcards() {
    const flashcards = document.querySelectorAll('.flashcard');
    let correctAnswers = 0;
    let totalAnswered = 0;
    
    flashcards.forEach(card => {
        // Ajouter la fonction de retournement
        card.addEventListener('click', function() {
            this.classList.toggle('flipped');
        });
        
        // Ajouter les écouteurs pour les boutons d'évaluation
        const correctBtn = card.querySelector('.correct-btn');
        const incorrectBtn = card.querySelector('.incorrect-btn');
        
        correctBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            if (!card.dataset.evaluated) {
                correctAnswers++;
                totalAnswered++;
                card.dataset.evaluated = "true";
                updateScore();
                card.classList.add('evaluated-correct');
            }
        });
        
        incorrectBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            if (!card.dataset.evaluated) {
                totalAnswered++;
                card.dataset.evaluated = "true";
                updateScore();
                card.classList.add('evaluated-incorrect');
            }
        });
    });
    
    function updateScore() {
        const scoreDisplay = document.getElementById('score-display');
        const percentage = totalAnswered > 0 ? Math.round((correctAnswers / totalAnswered) * 100) : 0;
        scoreDisplay.textContent = \`Score: \${correctAnswers}/\${totalAnswered} (\${percentage}%)\`;
        
        // Mettre à jour le score pour le certificat si activé
        if (document.getElementById('certificate-score')) {
            document.getElementById('certificate-score').textContent = \`Score: \${correctAnswers}/\${totalAnswered} (\${percentage}%)\`;
        }
        
        // Vérifier si le seuil de déblocage du certificat est atteint
        const certificateBtn = document.getElementById('certificate-btn');
        if (certificateBtn) {
            const requiredPercentage = ${appState.certificateThreshold};
            if (percentage >= requiredPercentage) {
                certificateBtn.disabled = false;
                certificateBtn.title = "Vous avez débloqué le certificat !";
            } else {
                certificateBtn.disabled = true;
                certificateBtn.title = \`Atteignez un score de \${requiredPercentage}% pour débloquer le certificat\`;
            }
        }
    }
}

// Initialisation
document.addEventListener('DOMContentLoaded', function() {
    initializeFlashcards();
    
    // Gestion des onglets si nécessaire
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');
            
            tabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            this.classList.add('active');
            document.getElementById(\`tab-\${tabId}\`).classList.add('active');
        });
    });
    
    // Filtrage par catégorie si activé
    const categorySelect = document.getElementById('category-filter');
    if (categorySelect) {
        categorySelect.addEventListener('change', function() {
            const category = this.value;
            const flashcards = document.querySelectorAll('.flashcard');
            
            flashcards.forEach(card => {
                if (category === 'all' || card.dataset.category === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    }
});`;
        }

        // Fonction pour obtenir le code du certificat
        function getCertificateCode() {
            return `// Fonction pour générer le certificat
function generateCertificate() {
    const certificat = document.getElementById('certificat');
    const studentForm = document.getElementById('student-form');
    
    // Récupérer les informations de l'étudiant
    const lastname = document.getElementById('student-lastname').value;
    const firstname = document.getElementById('student-firstname').value;
    const studentClass = document.getElementById('student-class').value;
    
    if (!lastname || !firstname) {
        alert('Veuillez saisir au moins votre nom et prénom.');
        return;
    }
    
    // Mettre à jour les informations sur le certificat
    document.getElementById('student-name').textContent = \`\${firstname} \${lastname}\`;
    document.getElementById('student-class-display').textContent = studentClass ? \`Classe: \${studentClass}\` : '';
    
    // Mettre à jour la date et le score
    const now = new Date();
    const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
    document.getElementById('certificate-date').textContent = \`Date: \${now.toLocaleDateString('fr-FR', options)}\`;
    
    // Afficher le certificat et cacher le formulaire
    studentForm.style.display = 'none';
    certificat.style.display = 'block';
}

// Imprimer le certificat
function printCertificate() {
    window.print();
}

// Enregistrer en PDF
function savePdf() {
    alert('Pour enregistrer en PDF, utilisez l\\'option "Imprimer" puis sélectionnez "Enregistrer au format PDF".');
    window.print();
}

// Écouteurs d'événements pour le certificat
document.addEventListener('DOMContentLoaded', function() {
    const generateBtn = document.getElementById('generate-certificate');
    const printBtn = document.getElementById('printCertificate');
    const savePdfBtn = document.getElementById('savePdfCertificate');
    
    if (generateBtn) {
        generateBtn.addEventListener('click', generateCertificate);
    }
    
    if (printBtn) {
        printBtn.addEventListener('click', printCertificate);
    }
    
    if (savePdfBtn) {
        savePdfBtn.addEventListener('click', savePdf);
    }
    
    // Initialiser le bouton de déblocage du certificat
    const certificateBtn = document.getElementById('certificate-btn');
    if (certificateBtn) {
        // Par défaut, le bouton est désactivé jusqu'à ce que le seuil soit atteint
        certificateBtn.disabled = true;
        certificateBtn.title = "Atteignez un score de ${appState.certificateThreshold}% pour débloquer le certificat";
    }
});`;
        }

        // ====================================
        // FONCTIONS IA ET API
        // ====================================
        
        // Fonction pour vérifier si au moins une API est configurée
        function isAnyAPIConfigured() {
            return appState.apiState.apiConfig.anthropic.key || 
                   appState.apiState.apiConfig.openai.key || 
                   appState.apiState.apiConfig.mistral.key ||
                   appState.apiState.apiConfig.gemini.key;
        }

        // Fonction pour mettre à jour l'indicateur de connexion API
        function updateApiConnectionStatus() {
            const statusIndicator = document.getElementById('api-connection-status');
            const useApiButton = document.getElementById('use-connected-api-btn');
            
            if (isAnyAPIConfigured()) {
                statusIndicator.classList.remove('disconnected');
                statusIndicator.innerHTML = `<i class="fas fa-circle"></i> API ${apiServiceMap[appState.apiState.defaultAIService]} connectée`;
                useApiButton.style.display = 'inline-flex';
            } else {
                statusIndicator.classList.add('disconnected');
                statusIndicator.innerHTML = `<i class="fas fa-circle"></i> API non configurée`;
                useApiButton.style.display = 'none';
            }
        }

        // Contourner CORS pour les appels API
        async function corsProxyFetch(url, options) {
            // Liste des proxies CORS disponibles
            const corsProxies = [
                'https://corsproxy.io/?',
                'https://api.allorigins.win/raw?url=',
                'https://cors-anywhere.herokuapp.com/'
            ];
            
            // Essayer avec chaque proxy jusqu'à ce que ça fonctionne
            for (const proxy of corsProxies) {
                try {
                    const response = await fetch(proxy + url, options);
                    return response;
                } catch (error) {
                    console.log(`Erreur avec le proxy ${proxy}:`, error);
                    // Continuer avec le prochain proxy
                }
            }
            
            // Si tous les proxies échouent, tenter une dernière fois sans proxy
            try {
                return await fetch(url, options);
            } catch (error) {
                throw new Error(`Tous les proxies CORS ont échoué. Erreur: ${error.message}`);
            }
        }

        // Fonction pour tester la connexion à une API
        async function testApiConnection(service) {
            const apiConfig = appState.apiState.apiConfig[service];
            const statusElement = document.getElementById(`${service}-api-status`);
            const debugLogElement = document.getElementById(`${service}-debug-log`);
            
            if (debugLogElement) {
                debugLogElement.style.display = 'block';
                debugLogElement.textContent = '';
            }
            
            function logDebug(message) {
                if (debugLogElement) {
                    debugLogElement.textContent += message + '\n';
                }
                console.log(message);
            }
            
            if (!apiConfig || !apiConfig.key) {
                logDebug("Erreur : Veuillez entrer une clé API.");
                statusElement.textContent = "Erreur : Veuillez entrer une clé API.";
                statusElement.className = "api-status error";
                return false;
            }
            
            logDebug(`Test de la connexion ${service}...`);
            statusElement.textContent = "Test en cours...";
            statusElement.className = "api-status";
            statusElement.style.display = 'block';
            
            try {
                let result = false;
                
                // Test selon le service
                switch(service) {
                    case 'anthropic':
                        // Simulation pour Anthropic
                        if (!apiConfig.key.startsWith('sk-ant')) {
                            throw new Error("Format de clé API Claude invalide, devrait commencer par 'sk-ant'");
                        }
                        // Simulation de succès
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        result = true;
                        break;
                        
                    case 'openai':
                        // Simulation pour OpenAI
                        if (!apiConfig.key.startsWith('sk-')) {
                            throw new Error("Format de clé API OpenAI invalide, devrait commencer par 'sk-'");
                        }
                        // Simulation de succès
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        result = true;
                        break;
                        
                    case 'mistral':
                        // Utiliser la vraie connexion Mistral
                        try {
                            // Configurer Mistral API
                            configureMistralAPI(apiConfig.key, apiConfig.model);
                            
                            // Tester la connexion
                            result = await testMistralConnection();
                        } catch (error) {
                            throw error;
                        }
                        break;
                        
                    case 'gemini':
                        // Simulation pour Gemini
                        // Aucune validation spécifique du format de clé
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        result = true;
                        break;
                        
                    default:
                        throw new Error(`Service non supporté: ${service}`);
                }
                
                if (result) {
                    // Sauvegarde de la clé dans l'état et définition du service par défaut
                    appState.apiState.apiConfig[service].key = apiConfig.key;
                    appState.apiState.apiConfig[service].model = apiConfig.model;
                    appState.apiState.defaultAIService = service;
                    
                    // Pour Mistral, sauvegarder aussi dans la configuration spécifique
                    if (service === 'mistral') {
                        saveMistralConfig();
                    }
                    
                    logDebug("Test de connexion réussi");
                    statusElement.textContent = "Connexion réussie !";
                    statusElement.className = "api-status success";
                    
                    // Mettre à jour l'indicateur de connexion API
                    updateApiConnectionStatus();
                    
                    return true;
                } else {
                    throw new Error("Erreur inconnue lors du test de connexion");
                }
                
            } catch (error) {
                logDebug(`Erreur lors du test: ${error.message}`);
                statusElement.textContent = "Erreur : " + error.message;
                statusElement.className = "api-status error";
                return false;
            }
        }

        // Fonction pour faire un appel API
        async function callAIAPI(prompt, temperature = 0.7, maxTokens = 2000) {
            // Déterminer quel service utiliser
            let service = appState.apiState.defaultAIService;
            let apiConfig = appState.apiState.apiConfig[service];
            
            // Si le service par défaut n'est pas configuré, chercher un service configuré
            if (!apiConfig || !apiConfig.key) {
                if (appState.apiState.apiConfig.anthropic.key) {
                    service = 'anthropic';
                    apiConfig = appState.apiState.apiConfig.anthropic;
                } else if (appState.apiState.apiConfig.openai.key) {
                    service = 'openai';
                    apiConfig = appState.apiState.apiConfig.openai;
                } else if (appState.apiState.apiConfig.mistral.key) {
                    service = 'mistral';
                    apiConfig = appState.apiState.apiConfig.mistral;
                } else if (appState.apiState.apiConfig.gemini.key) {
                    service = 'gemini';
                    apiConfig = appState.apiState.apiConfig.gemini;
                } else {
                    throw new Error("Aucune API n'est configurée");
                }
            }
            
            showNotification(`Génération IA en cours avec ${apiServiceMap[service]}...`);
            
            // Préparer les paramètres de la requête
            try {
                // Si le service est Mistral, utiliser la fonction spécifique à Mistral
                if (service === 'mistral') {
                    // S'assurer que la configuration est à jour
                    configureMistralAPI(apiConfig.key, apiConfig.model);
                    
                    // Appeler l'API Mistral avec le module intégré
                    return await callMistralAPI(prompt, temperature, maxTokens);
                }
                
                // Pour les autres services, générateur de réponses fictives basées sur les demandes
                // Cela sera remplacé par de véritables appels API dans une version complète
                console.log(`Simulation d'appel API ${service} pour ${prompt.substring(0, 30)}...`);
                
                // Simuler un délai pour rendre l'appel plus réaliste
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Générer des réponses personnalisées selon le type de requête
                if (prompt.includes("Suggère un type de contenu")) {
                    // Suggestion de type de contenu
                    switch(appState.domain) {
                        case 'mathematiques': 
                            return 'formula-example';
                        case 'langues': 
                            return 'translation';
                        case 'informatique': 
                            return 'term-definition';
                        default:
                            return 'question-answer';
                    }
                } 
                else if (prompt.includes("thème spécifique")) {
                    // Génération de thème
                    switch(appState.domain) {
                        case 'mathematiques':
                            return "Concentrez-vous sur les théorèmes fondamentaux de la géométrie euclidienne, avec une attention particulière aux propriétés des triangles et des cercles. Incluez des applications concrètes pour aider à visualiser ces concepts abstraits.";
                        case 'physique':
                            return "Abordez les principes de la dynamique newtonienne en vous concentrant sur les applications pratiques des lois de Newton. Illustrez chaque concept avec des exemples de la vie quotidienne pour faciliter la compréhension.";
                        case 'histoire':
                            return "Explorez les événements majeurs de la Révolution française (1789-1799) en vous concentrant sur les causes, les figures importantes et les conséquences à long terme pour la France et l'Europe.";
                        default:
                            return `Créez un ensemble de flashcards couvrant les concepts fondamentaux de ${domainMap[appState.domain]} adaptés au niveau ${appState.selectedLevels.join(', ')}. Assurez-vous d'inclure des exemples pratiques et des applications concrètes pour faciliter l'apprentissage.`;
                    }
                }
                else if (prompt.includes("exemples de flashcards")) {
                    // Génération d'exemples
                    let examples = '';
                    
                    if (appState.contentType === 'question-answer') {
                        if (appState.domain === 'mathematiques') {
                            examples = "Question: Qu'est-ce que le théorème de Pythagore?\nRéponse: Dans un triangle rectangle, le carré de l'hypoténuse est égal à la somme des carrés des deux autres côtés (a² + b² = c²).\n\nQuestion: Comment calcule-t-on l'aire d'un cercle?\nRéponse: L'aire d'un cercle se calcule avec la formule A = πr² où r est le rayon du cercle.\n\nQuestion: Quelle est la formule du binôme de Newton?\nRéponse: La formule du binôme de Newton est (a + b)^n = ∑(k=0 à n) C(n,k) a^(n-k) b^k où C(n,k) est le coefficient binomial.";
                        } else if (appState.domain === 'histoire') {
                            examples = "Question: Quand a eu lieu la Révolution française?\nRéponse: La Révolution française a débuté en 1789 avec la prise de la Bastille le 14 juillet.\n\nQuestion: Qui était Napoléon Bonaparte?\nRéponse: Napoléon Bonaparte était un général et homme d'État français qui est devenu empereur des Français de 1804 à 1814, puis brièvement en 1815.\n\nQuestion: Qu'est-ce que le Traité de Versailles?\nRéponse: Le Traité de Versailles est le traité de paix signé le 28 juin 1919 à la fin de la Première Guerre mondiale. Il imposait à l'Allemagne de lourdes sanctions et réparations.";
                        } else if (appState.domain === 'physique') {
                            examples = "Question: Qu'est-ce que la loi de Newton?\nRéponse: La deuxième loi de Newton établit que la force exercée sur un objet est égale au produit de sa masse par son accélération (F = m×a).\n\nQuestion: Qu'est-ce que l'énergie cinétique?\nRéponse: L'énergie cinétique est l'énergie que possède un corps du fait de son mouvement. Elle est égale à Ec = ½mv² où m est la masse et v la vitesse.\n\nQuestion: Qu'est-ce que la loi d'Ohm?\nRéponse: La loi d'Ohm établit que l'intensité du courant électrique qui traverse un conducteur est proportionnelle à la tension à ses bornes (U = R×I).";
                        } else {
                            examples = "Question: Quelle est la principale caractéristique du domaine étudié?\nRéponse: [Une réponse adaptée au domaine sélectionné]\n\nQuestion: Quel est le concept fondamental à retenir?\nRéponse: [Explication du concept fondamental]\n\nQuestion: Comment appliquer ce concept dans un contexte pratique?\nRéponse: [Application pratique du concept]";
                        }
                    } else if (appState.contentType === 'term-definition') {
                        examples = "Terme: Photosynthèse\nDéfinition: Processus biochimique par lequel les plantes utilisent la lumière du soleil pour synthétiser des nutriments à partir de dioxyde de carbone et d'eau.\n\nTerme: Algorithme\nDéfinition: Suite finie et non ambiguë d'opérations ou d'instructions permettant de résoudre un problème.\n\nTerme: Écosystème\nDéfinition: Ensemble formé par une communauté d'êtres vivants en interaction avec son environnement.";
                    } else if (appState.contentType === 'formula-example') {
                        examples = "Formule: E = mc²\nExemple: Cette formule d'Einstein établit l'équivalence entre la masse et l'énergie. Une petite masse peut être convertie en une énorme quantité d'énergie.\n\nFormule: F = ma\nExemple: La deuxième loi de Newton indique que la force est égale à la masse multipliée par l'accélération. Elle permet de calculer la force nécessaire pour déplacer un objet.\n\nFormule: PV = nRT\nExemple: L'équation des gaz parfaits relie la pression, le volume, la quantité de matière et la température d'un gaz. Elle est utilisée pour prédire le comportement des gaz dans différentes conditions.";
                    } else if (appState.contentType === 'translation') {
                        examples = "Français: Bonjour, comment allez-vous?\nAnglais: Hello, how are you?\n\nFrançais: Je voudrais réserver une table pour deux personnes.\nAnglais: I would like to book a table for two people.\n\nFrançais: Pouvez-vous m'indiquer le chemin vers la gare?\nAnglais: Can you tell me the way to the train station?";
                    }
                    
                    return examples;
                } 
                else {
                    // Réponse par défaut
                    return "Réponse générée par l'IA";
                }
            } catch (error) {
                console.error("Erreur lors de l'appel à l'API:", error);
                throw error;
            }
        }

        // Fonction pour mettre à jour la prévisualisation du certificat
        function updateCertificatePreview() {
            const preview = document.getElementById('certificate-preview');
            const titleElem = preview.querySelector('h2');
            
            // Mettre à jour le titre
            titleElem.textContent = appState.certificateTitle;
            
            // Mettre à jour le contenu en fonction du domaine
            const domainText = appState.domain === 'custom' ? appState.customDomain : domainMap[appState.domain];
            preview.querySelectorAll('p')[4].innerHTML = `<strong>${domainText} - ${appState.appTitle}</strong>`;
            
            // Mettre à jour les informations en fonction de l'option sélectionnée
            const classInfo = preview.querySelectorAll('p')[3];
            if (appState.certificateInfo === 'name-only') {
                classInfo.style.display = 'none';
            } else {
                classInfo.style.display = 'block';
            }
            
            // Mettre à jour la signature
            const signatureBox = preview.querySelectorAll('.signature-box')[0];
            signatureBox.querySelectorAll('p')[1].textContent = appState.appAuthor;
        }

        // Fonction pour ajouter un exemple généré
        function addGeneratedExample(front, back) {
            const container = document.getElementById('generated-examples');
            const exampleIndex = appState.generatedExamples.length;
            
            // Ajouter à l'état
            appState.generatedExamples.push({ front, back });
            
            // Créer l'élément visuel
            const exampleCard = document.createElement('div');
            exampleCard.className = 'example-card';
            exampleCard.innerHTML = `
                <div class="example-card-header">
                    <div class="example-card-title">Exemple ${exampleIndex + 1}</div>
                    <div class="example-card-actions">
                        <button class="example-card-action add-to-examples" data-index="${exampleIndex}">
                            <i class="fas fa-plus"></i> Ajouter
                        </button>
                        <button class="example-card-action remove-example" data-index="${exampleIndex}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="example-card-front">${escapeHtml(front)}</div>
                <div class="example-card-back">${escapeHtml(back)}</div>
            `;
            
            container.appendChild(exampleCard);
            
            // Ajouter les événements
            exampleCard.querySelector('.add-to-examples').addEventListener('click', function() {
                const index = parseInt(this.dataset.index);
                const example = appState.generatedExamples[index];
                const currentExamples = document.getElementById('example-flashcards').value;
                
                const formattedExample = `${front}\n${back}\n\n`;
                document.getElementById('example-flashcards').value = currentExamples + formattedExample;
                appState.exampleFlashcards = document.getElementById('example-flashcards').value;
                
                showNotification('Exemple ajouté aux flashcards !');
            });
            
            exampleCard.querySelector('.remove-example').addEventListener('click', function() {
                const index = parseInt(this.dataset.index);
                appState.generatedExamples.splice(index, 1);
                exampleCard.remove();
                showNotification('Exemple supprimé !');
            });
            
            // Afficher le conteneur si c'est le premier exemple
            if (appState.generatedExamples.length === 1) {
                document.getElementById('ai-examples-container').style.display = 'block';
            }
        }

        // ====================================
        // FONCTION AMÉLIORÉE POUR LES OPÉRATIONS IA
        // ====================================
        
        // Fonction pour gérer les opérations IA
        async function enhancedAiOperation(type, successMessage = "Opération IA réussie !") {
            // Pour les styles, pas besoin de vérifier API
            if (type !== 'style-recommendation' && type !== 'certificate-template' && !isAnyAPIConfigured()) {
                showNotification("API non configurée. Configurez d'abord une API.");
                return;
            }
            
            try {
                // Afficher une notification de démarrage
                showNotification("Génération IA en cours...");
                
                // Appliquer les effets réels en fonction du type d'opération
                switch(type) {
                    case 'suggest-content-type':
                        // Suggérer un type de contenu basé sur le domaine via l'API
                        const suggestedType = await callAIAPI(
                            "Suggère un type de contenu optimal pour des flashcards en " + 
                            domainMap[appState.domain] + " niveau " + appState.selectedLevels.join(', ')
                        );
                        
                        document.getElementById('content-type').value = suggestedType;
                        appState.contentType = suggestedType;
                        showNotification("Type de contenu suggéré : " + contentTypeMap[suggestedType]);
                        break;
                        
                    case 'generate-theme':
                        // Générer un thème via l'API
                        const theme = await callAIAPI(
                            "Génère un thème spécifique détaillé pour des flashcards en " + 
                            domainMap[appState.domain] + " niveau " + appState.selectedLevels.join(', '), 
                            appState.apiState.temperature
                        );
                        
                        document.getElementById('content-theme').value = theme;
                        appState.contentTheme = theme;
                        showNotification("Thème généré avec succès !");
                        break;
                        
                    case 'generate-examples':
                        // Générer des exemples de flashcards via l'API
                        const contentTypeLabel = contentTypeMap[appState.contentType];
                        
                        const examples = await callAIAPI(
                            `Génère 3 exemples de flashcards de type ${contentTypeLabel} en ${domainMap[appState.domain]} pour le niveau ${appState.selectedLevels.join(', ')}. ${appState.contentTheme ? 'Thème: ' + appState.contentTheme : ''}`, 
                            appState.apiState.temperature
                        );
                        
                        // Analyser les exemples générés
                        const lines = examples.split('\n\n');
                        lines.forEach(line => {
                            if (line.trim()) {
                                let front, back;
                                
                                if (appState.contentType === 'question-answer') {
                                    [front, back] = line.split('\n');
                                } else if (appState.contentType === 'term-definition') {
                                    [front, back] = line.split('\n');
                                } else if (appState.contentType === 'formula-example') {
                                    [front, back] = line.split('\n');
                                } else if (appState.contentType === 'translation') {
                                    [front, back] = line.split('\n');
                                } else if (appState.contentType === 'problem-solution') {
                                    [front, back] = line.split('\n');
                                } else {
                                    // Format par défaut
                                    const parts = line.split('\n');
                                    front = parts[0] || 'Front';
                                    back = parts.slice(1).join('\n') || 'Back';
                                }
                                
                                if (front && back) {
                                    addGeneratedExample(front, back);
                                }
                            }
                        });
                        
                        showNotification("Exemples générés avec succès !");
                        break;
                        
                    case 'style-recommendation':
                        // Suggérer un style adapté au domaine
                        let style, color, animation, interface;
                        
                        // Styles suggérés par domaine
                        switch(appState.domain) {
                            case 'mathematiques':
                            case 'physique':
                            case 'chimie':
                                style = 'modern';
                                color = 'blue';
                                animation = 'flip-horizontal';
                                interface = 'tabs';
                                break;
                            case 'histoire':
                            case 'geographie':
                                style = 'classic';
                                color = 'teal';
                                animation = 'flip-horizontal';
                                interface = 'cards';
                                break;
                            case 'informatique':
                                style = 'minimal';
                                color = 'purple';
                                animation = 'slide';
                                interface = 'single-page';
                                break;
                            case 'langues':
                            case 'francais':
                                style = 'gradient';
                                color = 'green';
                                animation = 'flip-vertical';
                                interface = 'wizard';
                                break;
                            default:
                                style = 'playful';
                                color = 'orange';
                                animation = 'flip-horizontal';
                                interface = 'tabs';
                        }
                        
                        // Mettre à jour les sélecteurs
                        document.getElementById('card-style').value = style;
                        document.getElementById('primary-color').value = color;
                        document.getElementById('flip-animation').value = animation;
                        document.getElementById('interface-style').value = interface;
                        
                        // Mettre à jour l'état
                        appState.cardStyle = style;
                        appState.primaryColor = color;
                        appState.flipAnimation = animation;
                        appState.interfaceStyle = interface;
                        
                        // Mettre à jour le style sélectionné dans les presets
                        updateSelectedStylePreset(`${style}-${color}-${animation}-${interface}`);
                        
                        showNotification(successMessage);
                        break;
                        
                    case 'certificate-template':
                        // Générer un template de certificat adapté
                        let certTitle, certStyle;
                        
                        // Adapter en fonction du domaine
                        switch(appState.domain) {
                            case 'mathematiques':
                            case 'physique':
                            case 'chimie':
                            case 'informatique':
                                certTitle = "Certificat d'Excellence Scientifique";
                                certStyle = "modern";
                                break;
                            case 'histoire':
                            case 'geographie':
                                certTitle = "Attestation de Maîtrise Historique";
                                certStyle = "classic";
                                break;
                            case 'langues':
                                certTitle = "Certification Linguistique";
                                certStyle = "elegant";
                                break;
                            default:
                                certTitle = "Diplôme de Réussite";
                                certStyle = "playful";
                        }
                        
                        // Mettre à jour les champs
                        document.getElementById('certificate-title').value = certTitle;
                        document.getElementById('certificate-style').value = certStyle;
                        
                        // Mettre à jour l'état
                        appState.certificateTitle = certTitle;
                        appState.certificateStyle = certStyle;
                        
                        // Mettre à jour la prévisualisation
                        updateCertificatePreview();
                        
                        showNotification(successMessage);
                        break;
                        
                    case 'certificate-text':
                        // Générer du texte pour le certificat
                        const certTexts = [
                            "Ce certificat atteste que l'élève a démontré une maîtrise exceptionnelle des compétences requises.",
                            "Nous certifions que l'apprenant a complété avec succès l'ensemble des exercices proposés.",
                            "Ce document valide l'acquisition des connaissances et compétences évaluées."
                        ];
                        const randomText = certTexts[Math.floor(Math.random() * certTexts.length)];
                        const certPreview = document.getElementById('certificate-preview');
                        certPreview.querySelectorAll('p')[1].textContent = randomText;
                        
                        showNotification(successMessage);
                        break;
                }
            } catch (error) {
                console.error("Erreur lors de l'opération IA:", error);
                showNotification("Erreur: " + error.message);
            }
        }

        // ====================================
        // FONCTION POUR LA SÉLECTION VISUELLE DES PRESETS DE STYLE
        // ====================================
        
        // Fonction pour mettre à jour visuellement le style sélectionné
        function updateSelectedStylePreset(styleKey) {
            const presets = document.querySelectorAll('.style-preset');
            
            // Retirer la classe selected de tous les presets
            presets.forEach(preset => {
                preset.classList.remove('selected');
            });
            
            // Trouver le preset qui correspond aux valeurs et l'activer
            presets.forEach(preset => {
                const presetStyle = preset.getAttribute('data-style');
                const presetColor = preset.getAttribute('data-color');
                const presetAnimation = preset.getAttribute('data-animation');
                const presetInterface = preset.getAttribute('data-interface');
                
                const presetKey = `${presetStyle}-${presetColor}-${presetAnimation}-${presetInterface}`;
                
                if (styleKey === presetKey) {
                    preset.classList.add('selected');
                    appState.selectedStylePreset = presetKey;
                }
            });
        }

        // ====================================
        // GÉNÉRATION DU PROMPT
        // ====================================
        
        // Fonction pour générer le prompt
        function generatePrompt() {
            // Récupération des valeurs de base
            const levelText = appState.selectedLevels.join(", ");
            const domainText = appState.domain === 'custom' ? appState.customDomain : domainMap[appState.domain];
            
            // SECTION 1: INTRODUCTION ET CADRAGE GÉNÉRAL
            let introSection = `# APPLICATION DE RÉVISION AVEC FLASHCARDS
## CADRE GÉNÉRAL
- Domaine: ${domainText}
- Niveau scolaire: ${levelText}
- Public cible: Étudiants de niveau ${levelText}

`;

            // SECTION 2: IDENTITÉ DE L'APPLICATION
            let identitySection = `## IDENTITÉ DE L'APPLICATION
- Titre principal: ${appState.appTitle}${appState.appSubtitle ? '\n- Sous-titre: ' + appState.appSubtitle : ''}
- Signature/Auteur: ${appState.appAuthor}
- Version: 1.0

`;

            // SECTION 3: CONTENU PÉDAGOGIQUE
            let contentSection = `## CONTENU PÉDAGOGIQUE
- Format: ${contentTypeMap[appState.contentType]}
- Nombre de flashcards: ${appState.flashcardsCount}`;

            if (appState.categoriesEnabled === 'yes' && appState.categories.filter(c => c.trim()).length > 0) {
                contentSection += `\n- Organisation par catégories: OUI
  * Catégories à implémenter: ${appState.categories.filter(c => c.trim()).join(", ")}`;
            } else {
                contentSection += `\n- Organisation par catégories: NON`;
            }

            if (appState.contentTheme) {
                contentSection += `\n- Thème spécifique/Consignes: ${appState.contentTheme}`;
            }

            if (appState.aiContentGeneration !== 'manual') {
                contentSection += `\n- Génération de contenu: ${appState.aiContentGeneration === 'ai-full' ? 'entièrement automatisée' : 'assistée par IA avec supervision'}`;
            }

            contentSection += `\n\n`;

            // SECTION 4: INTERFACE UTILISATEUR
            let interfaceSection = `## INTERFACE UTILISATEUR
- Style d'interface: Interface à ${interfaceMap[appState.interfaceStyle]}
- Thème visuel: ${styleMap[appState.cardStyle]}
- Palette de couleurs: 
  * Couleur principale: ${colorMap[appState.primaryColor]}
  * Dérivés et accents générés à partir de cette couleur principale
- Animation et transitions: 
  * Retournement des cartes: Animation ${animationMap[appState.flipAnimation]}
  * Transitions entre les sections: Fluides et cohérentes
- Responsivité: OBLIGATOIRE - L'application doit s'adapter à tous les appareils (desktop, tablette, mobile)
- Accessibilité: Mettre en œuvre les standards d'accessibilité (ARIA, contrastes suffisants, navigation au clavier)

`;

            // SECTION 5: INTERACTIVITÉ ET FONCTIONNALITÉS
            let functionalitySection = `## INTERACTIVITÉ ET FONCTIONNALITÉS
- Système de suivi de progression: ${progressTrackingMap[appState.progressTracking]}
- Navigation dans les flashcards: Intuitive et fluide
- Évaluation des réponses: 
  * IMPORTANT: Les boutons "correct" et "incorrect" doivent apparaître UNIQUEMENT au verso des cartes (avec la réponse), jamais au recto
  * Calcul automatique du score en fonction des réponses de l'utilisateur
- Feedback visuel: Indicateurs clairs pour les réponses correctes et incorrectes`;

            if (appState.customStyles) {
                functionalitySection += `\n- Styles CSS personnalisés: INCLUS`;
            }

            functionalitySection += `\n\n`;

            // SECTION 6: CERTIFICATION (si activée)
            let certificationSection = "";
            if (appState.certificateEnabled === 'yes') {
                const thresholdText = appState.certificateThreshold === '0' ? 
                    "sans seuil minimum requis" : 
                    `débloqué à partir de ${appState.certificateThreshold}% de réussite`;
                    
                certificationSection = `## SYSTÈME DE CERTIFICATION
- Certificat de réussite: ACTIVÉ
- Paramètres du certificat:
  * Titre: ${appState.certificateTitle}
  * Style visuel: ${certificateStyleMap[appState.certificateStyle]}
  * Informations incluses: ${certificateInfoMap[appState.certificateInfo]}
  * Options d'exportation: ${certificateExportMap[appState.certificateExport]}
  * Conditions de déblocage: ${thresholdText}
  * Date automatique: Inclure la date du jour de génération du certificat

`;
            }

            // SECTION 7: EXEMPLES DE CONTENU (si fournis)
            let examplesSection = "";
            if (appState.exampleFlashcards) {
                examplesSection = `## EXEMPLES DE CONTENU
Les exemples suivants illustrent le format et le niveau de difficulté attendus:

${appState.exampleFlashcards}

`;
            }

            // SECTION 8: OPTIMISATION ET SPÉCIFICATIONS TECHNIQUES
            let optimizationSection = `## OPTIMISATION ET SPÉCIFICATIONS TECHNIQUES`;
            
            // Ajouter des infos sur la priorité d'optimisation
            const optimizationNames = {
                'accuracy': 'Précision du contenu éducatif',
                'design': 'Qualité de l\'apparence visuelle',
                'features': 'Richesse des fonctionnalités avancées',
                'balanced': 'Équilibre général entre toutes les dimensions',
                'technical': 'Excellence technique du code produit'
            };
            optimizationSection += `\n- Priorité d'optimisation: ${optimizationNames[appState.promptTemplate]}`;
            
            optimizationSection += `\n- Structure du code: HTML5 sémantique, CSS3 moderne, JavaScript ES6+
- Performance: Optimisation pour le chargement rapide et l'interaction fluide
- Persistance des données: Utilisation du localStorage pour sauvegarder la progression
- Compatibilité navigateur: Chrome, Firefox, Safari, Edge (dernières versions)
- Documentation: Inclure des commentaires clairs pour faciliter la maintenance

`;

            // SECTION 9: INSTRUCTIONS SUPPLÉMENTAIRES (si fournies)
            let additionalInstructionsSection = "";
            if (appState.additionalInstructions) {
                additionalInstructionsSection = `## INSTRUCTIONS SUPPLÉMENTAIRES
${appState.additionalInstructions}

`;
            }

            // SECTION 10: CONSIGNES DE LIVRAISON
            let deliverySection = `## CONSIGNES DE LIVRAISON
- Format: Fichier HTML unique intégrant CSS et JavaScript
- Organisation du code: Structure claire avec séparation des préoccupations
- Qualité du code: Code propre, commenté et sans erreurs
- Test: Application entièrement fonctionnelle sans dépendances externes
- Notification finale: Indiquer clairement comment utiliser l'application
- IMPORTANT !!! DSIPOSITION DES FLASCARDS EN GRILLE POUR PLUS D OPTIMISATION DE L ECRAN

## MODE PLEIN ÉCRAN PRIORITAIRE

INSTRUCTION CRITIQUE À PRIORITÉ ABSOLUE: L'application DOIT disposer obligatoirement d'un mode plein écran. 
Ajouter une icône simple et élégante en position absolue dans le coin supérieur droit de l'interface permettant de basculer entre le mode plein écran et normal. Cette fonctionnalité est OBLIGATOIRE et doit être implémentée sans option ni réglage supplémentaire. Utiliser l'API Fullscreen pour une compatibilité maximale avec tous les navigateurs.

`;

            // Assemblage du prompt complet
            let completePrompt = introSection + 
                               identitySection + 
                               contentSection + 
                               interfaceSection + 
                               functionalitySection + 
                               certificationSection + 
                               examplesSection + 
                               optimizationSection + 
                               additionalInstructionsSection + 
                               deliverySection;

            // Ajout des sections techniques si demandé
            if (appState.includeCode === 'yes' && appState.showTechnicalSections) {
                const htmlBaseCode = getHtmlBaseCode();
                const flashcardCssCode = getFlashcardCssCode();
                const flashcardJsCode = getFlashcardJsCode();
                const certificateCode = getCertificateCode();
                
                completePrompt += `## CODE DE RÉFÉRENCE
Ces extraits de code sont fournis comme référence et doivent être adaptés selon les spécifications ci-dessus.

### HTML de base
\`\`\`html
${htmlBaseCode}
\`\`\`

### CSS pour les flashcards
\`\`\`css
${flashcardCssCode}
\`\`\`

### JavaScript pour l'interaction
\`\`\`javascript
${flashcardJsCode}
\`\`\`

${appState.certificateEnabled === 'yes' ? `### Code pour le certificat
\`\`\`javascript
${certificateCode}
\`\`\`` : ''}

NOTE: L'application doit être entièrement fonctionnelle dans un seul fichier HTML avec un code propre, structuré et commenté.`;
            }

            // Mettre à jour l'état et la prévisualisation
            appState.promptResult = completePrompt;
            document.getElementById('prompt-preview').textContent = completePrompt;
            
            return completePrompt;
        }

        // Fonction pour télécharger le prompt
        function downloadPrompt() {
            const promptText = generatePrompt();
            const element = document.createElement("a");
            const file = new Blob([promptText], {type: 'text/plain'});
            element.href = URL.createObjectURL(file);
            element.download = "flashcards-prompt.txt";
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        // Fonction pour copier le prompt dans le presse-papiers
        function copyPrompt() {
            const promptText = generatePrompt();
            navigator.clipboard.writeText(promptText)
                .then(() => {
                    showNotification('Le prompt a été copié dans le presse-papiers !');
                })
                .catch(err => {
                    console.error('Erreur lors de la copie :', err);
                    alert('Erreur lors de la copie du prompt. Veuillez essayer de le sélectionner manuellement.');
                });
        }

        // Fonction pour ouvrir un site web et coller le prompt
        function openAiProvider(url) {
            // Générer et copier le prompt dans le presse-papiers
            const promptText = generatePrompt();
            navigator.clipboard.writeText(promptText)
                .then(() => {
                    showNotification('Le prompt a été copié ! Ouverture de ' + url);
                    
                    // Ouvrir le site dans un nouvel onglet
                    window.open(url, '_blank');
                })
                .catch(err => {
                    console.error('Erreur lors de la copie :', err);
                    alert('Erreur lors de la copie du prompt, mais le site sera ouvert quand même.');
                    window.open(url, '_blank');
                });
        }

        // ====================================
        // GESTION DU MODAL API
        // ====================================
        
        // Ouvrir le modal
        function openModal(id) {
            document.getElementById(id).style.display = 'block';
        }
        
        // Fermer le modal
        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }
        
        // Mettre à jour l'interface API en fonction du fournisseur sélectionné
        function updateApiInterface() {
            const apiProvider = document.getElementById('ai-provider').value;
            
            // Masquer toutes les sections de configuration
            document.querySelectorAll('.api-config-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Afficher la section correspondante
            document.getElementById(`${apiProvider}-config`).style.display = 'block';
        }

        // Sauvegarder les configurations API dans le localStorage
        function saveApiConfigurations() {
            // Mettre à jour l'état avec les valeurs des champs
            appState.apiState.apiConfig.anthropic.key = document.getElementById('claude-api-key').value;
            appState.apiState.apiConfig.anthropic.model = document.getElementById('claude-model').value;
            
            appState.apiState.apiConfig.openai.key = document.getElementById('openai-api-key').value;
            appState.apiState.apiConfig.openai.model = document.getElementById('openai-model').value;
            
            appState.apiState.apiConfig.mistral.key = document.getElementById('mistral-api-key').value;
            appState.apiState.apiConfig.mistral.model = document.getElementById('mistral-model').value;
            
            appState.apiState.apiConfig.gemini.key = document.getElementById('gemini-api-key').value;
            appState.apiState.apiConfig.gemini.model = document.getElementById('gemini-model').value;
            
            // Sauvegarder dans localStorage
            localStorage.setItem('flashprompt_api_config', JSON.stringify(appState.apiState.apiConfig));
            
            // Pour Mistral, sauvegarder aussi dans la configuration spécifique
            if (appState.apiState.defaultAIService === 'mistral') {
                configureMistralAPI(appState.apiState.apiConfig.mistral.key, appState.apiState.apiConfig.mistral.model);
                saveMistralConfig();
            }
            
            // Mettre à jour le service par défaut
            appState.apiState.defaultAIService = document.getElementById('ai-provider').value;
            
            // Mettre à jour l'indicateur de connexion API
            updateApiConnectionStatus();
            
            // Afficher une confirmation
            showNotification('Configurations API sauvegardées avec succès!');
            
            // Fermer le modal
            closeModal('api-config-modal');
        }

        // Charger les configurations API depuis le localStorage
        function loadApiConfigurations() {
            const savedConfig = localStorage.getItem('flashprompt_api_config');
            if (savedConfig) {
                try {
                    const config = JSON.parse(savedConfig);
                    appState.apiState.apiConfig = {...appState.apiState.apiConfig, ...config};
                    
                    // Mettre à jour les champs du formulaire
                    if (config.anthropic) {
                        document.getElementById('claude-api-key').value = config.anthropic.key || '';
                        const claudeModelSelect = document.getElementById('claude-model');
                        if (claudeModelSelect && config.anthropic.model) {
                            claudeModelSelect.value = config.anthropic.model;
                        }
                    }
                    
                    if (config.openai) {
                        document.getElementById('openai-api-key').value = config.openai.key || '';
                        const openaiModelSelect = document.getElementById('openai-model');
                        if (openaiModelSelect && config.openai.model) {
                            openaiModelSelect.value = config.openai.model;
                        }
                    }
                    
                    if (config.mistral) {
                        document.getElementById('mistral-api-key').value = config.mistral.key || '';
                        const mistralModelSelect = document.getElementById('mistral-model');
                        if (mistralModelSelect && config.mistral.model) {
                            mistralModelSelect.value = config.mistral.model;
                        }
                        
                        // Mettre à jour aussi la configuration Mistral spécifique
                        configureMistralAPI(config.mistral.key, config.mistral.model);
                    }
                    
                    if (config.gemini) {
                        document.getElementById('gemini-api-key').value = config.gemini.key || '';
                        const geminiModelSelect = document.getElementById('gemini-model');
                        if (geminiModelSelect && config.gemini.model) {
                            geminiModelSelect.value = config.gemini.model;
                        }
                    }
                    
                    // Mettre à jour l'indicateur de connexion API
                    updateApiConnectionStatus();
                } catch (error) {
                    console.error('Erreur lors du chargement des configurations API:', error);
                }
            }
            
            // Charger aussi la configuration Mistral spécifique
            loadMistralConfig();
        }

        // ====================================
        // INITIALISATION DE L'APPLICATION
        // ====================================
        
        function initApp() {
            // Gestionnaire pour les onglets
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabNumber = this.getAttribute('data-tab');
                    changeTab(parseInt(tabNumber));
                });
            });
            
            // Initialiser les écouteurs pour les boutons de navigation entre onglets
            document.getElementById('next-tab-1').addEventListener('click', () => changeTab(2));
            document.getElementById('prev-tab-2').addEventListener('click', () => changeTab(1));
            document.getElementById('next-tab-2').addEventListener('click', () => changeTab(3));
            document.getElementById('prev-tab-3').addEventListener('click', () => changeTab(2));
            document.getElementById('next-tab-3').addEventListener('click', () => changeTab(4));
            document.getElementById('prev-tab-4').addEventListener('click', () => changeTab(3));
            document.getElementById('next-tab-4').addEventListener('click', () => changeTab(5));
            document.getElementById('prev-tab-5').addEventListener('click', () => changeTab(4));
            
            // Écouteurs pour les champs de l'onglet 1 (Configuration)
            document.getElementById('app-title').addEventListener('input', (e) => {
                appState.appTitle = e.target.value;
            });
            
            document.getElementById('app-subtitle').addEventListener('input', (e) => {
                appState.appSubtitle = e.target.value;
            });
            
            document.getElementById('app-author').addEventListener('input', (e) => {
                appState.appAuthor = e.target.value;
            });
            
            document.getElementById('domain-select').addEventListener('change', (e) => {
                appState.domain = e.target.value;
                
                // Afficher ou masquer le champ de domaine personnalisé
                const customDomainContainer = document.getElementById('custom-domain-container');
                if (e.target.value === 'custom') {
                    customDomainContainer.style.display = 'block';
                } else {
                    customDomainContainer.style.display = 'none';
                }
                
                // Mettre à jour le certificat preview
                updateCertificatePreview();
            });
            
            document.getElementById('custom-domain').addEventListener('input', (e) => {
                appState.customDomain = e.target.value;
                
                // Mettre à jour le certificat preview si nécessaire
                if (appState.domain === 'custom') {
                    updateCertificatePreview();
                }
            });
            
            document.getElementById('flashcards-count').addEventListener('input', (e) => {
                appState.flashcardsCount = e.target.value;
            });
            
            // Écouteurs pour les cases à cocher des niveaux
            document.querySelectorAll('input[type="checkbox"][id^="level-"]').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    handleLevelChange(e.target.value, e.target.checked);
                });
            });
            
            // Écouteur pour le bouton de réinitialisation
            document.getElementById('reset-button').addEventListener('click', () => {
                if (window.confirm('Êtes-vous sûr de vouloir réinitialiser tous les paramètres ?')) {
                    window.location.reload();
                }
            });
            
            // Écouteurs pour les champs de l'onglet 2 (Contenu)
            document.getElementById('content-type').addEventListener('change', (e) => {
                appState.contentType = e.target.value;
            });
            
            document.getElementById('categories-enabled').addEventListener('change', (e) => {
                appState.categoriesEnabled = e.target.value;
                
                // Afficher ou masquer le conteneur des catégories
                const categoriesContainer = document.getElementById('categories-container');
                if (e.target.value === 'yes') {
                    categoriesContainer.style.display = 'block';
                } else {
                    categoriesContainer.style.display = 'none';
                }
            });
            
            document.getElementById('add-category-btn').addEventListener('click', addCategory);
            
            document.getElementById('ai-content-generation').addEventListener('change', (e) => {
                appState.aiContentGeneration = e.target.value;
            });
            
            document.getElementById('content-theme').addEventListener('input', (e) => {
                appState.contentTheme = e.target.value;
            });
            
            document.getElementById('example-flashcards').addEventListener('input', (e) => {
                appState.exampleFlashcards = e.target.value;
            });
            
            // Écouteurs pour les champs de l'onglet 3 (Apparence)
            document.getElementById('card-style').addEventListener('change', (e) => {
                appState.cardStyle = e.target.value;
            });
            
            document.getElementById('flip-animation').addEventListener('change', (e) => {
                appState.flipAnimation = e.target.value;
            });
            
            document.getElementById('primary-color').addEventListener('change', (e) => {
                appState.primaryColor = e.target.value;
            });
            
            document.getElementById('interface-style').addEventListener('change', (e) => {
                appState.interfaceStyle = e.target.value;
            });
            
            document.getElementById('custom-styles').addEventListener('input', (e) => {
                appState.customStyles = e.target.value;
            });
            
            document.getElementById('progress-tracking').addEventListener('change', (e) => {
                appState.progressTracking = e.target.value;
            });
            
            // Écouteurs pour les champs de l'onglet 4 (Certificat)
            document.getElementById('certificate-enabled').addEventListener('change', (e) => {
                appState.certificateEnabled = e.target.value;
                
                // Afficher ou masquer les options du certificat
                const certificateOptions = document.getElementById('certificate-options');
                if (e.target.value === 'yes') {
                    certificateOptions.style.display = 'block';
                } else {
                    certificateOptions.style.display = 'none';
                }
            });
            
            document.getElementById('certificate-title').addEventListener('input', (e) => {
                appState.certificateTitle = e.target.value;
                updateCertificatePreview();
            });
            
            document.getElementById('certificate-style').addEventListener('change', (e) => {
                appState.certificateStyle = e.target.value;
            });
            
            document.getElementById('certificate-info').addEventListener('change', (e) => {
                appState.certificateInfo = e.target.value;
                updateCertificatePreview();
            });
            
            document.getElementById('certificate-export').addEventListener('change', (e) => {
                appState.certificateExport = e.target.value;
            });
            
            // Écouteur pour le seuil de déblocage du certificat
            document.getElementById('certificate-threshold').addEventListener('change', (e) => {
                appState.certificateThreshold = e.target.value;
            });
            
            // Écouteurs pour les champs de l'onglet 5 (Prompt Final)
            document.getElementById('prompt-template').addEventListener('change', (e) => {
                appState.promptTemplate = e.target.value;
            });
            
            document.getElementById('include-code').addEventListener('change', (e) => {
                appState.includeCode = e.target.value;
            });
            
            document.getElementById('additional-instructions').addEventListener('input', (e) => {
                appState.additionalInstructions = e.target.value;
            });
            
            // Écouteurs pour les boutons de l'onglet 5 (Prompt Final)
            document.getElementById('generate-prompt-btn').addEventListener('click', generatePrompt);
            
            document.getElementById('copy-prompt-btn').addEventListener('click', copyPrompt);
            
            document.getElementById('download-prompt-btn').addEventListener('click', downloadPrompt);
            
            document.getElementById('toggle-technical-btn').addEventListener('click', () => {
                appState.showTechnicalSections = !appState.showTechnicalSections;
                
                const toggleBtn = document.getElementById('toggle-technical-btn');
                toggleBtn.innerHTML = appState.showTechnicalSections 
                    ? '<i class="fas fa-code"></i> Masquer sections techniques'
                    : '<i class="fas fa-code"></i> Afficher sections techniques';
                
                // Régénérer le prompt pour refléter le changement
                generatePrompt();
            });
            
            // Écouteurs pour les boutons d'IA dans l'onglet 5
            document.getElementById('open-claude-btn').addEventListener('click', () => {
                openAiProvider('https://claude.ai');
            });
            
            document.getElementById('open-chatgpt-btn').addEventListener('click', () => {
                openAiProvider('https://chat.openai.com');
            });
            
            document.getElementById('open-mistral-btn').addEventListener('click', () => {
                openAiProvider('https://console.mistral.ai/chat/');
            });
            
            document.getElementById('open-gemini-btn').addEventListener('click', () => {
                openAiProvider('https://gemini.google.com/app');
            });
            
            // Écouteur pour le bouton d'utilisation de l'API connectée
            document.getElementById('use-connected-api-btn').addEventListener('click', async () => {
                if (!isAnyAPIConfigured()) {
                    showNotification("Aucune API n'est configurée. Veuillez configurer une API d'abord.");
                    return;
                }
                
                try {
                    showNotification("Envoi du prompt à l'API...");
                    
                    // Générer le prompt
                    const promptText = generatePrompt();
                    
                    // Appeler l'API IA
                    const response = await callAIAPI(promptText, 0.7, 4000);
                    
                    // Créer un fichier texte temporaire pour afficher la réponse
                    const blob = new Blob([response], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    
                    // Ouvrir la réponse dans un nouvel onglet
                    window.open(url, '_blank');
                    
                    showNotification("Réponse de l'IA générée avec succès !");
                } catch (error) {
                    console.error("Erreur lors de l'utilisation de l'API:", error);
                    showNotification("Erreur: " + error.message);
                }
            });
            
            // Écouteurs pour les styles presets
            document.querySelectorAll('.style-preset').forEach(preset => {
                preset.addEventListener('click', () => {
                    // Récupérer les attributs
                    const style = preset.getAttribute('data-style');
                    const color = preset.getAttribute('data-color');
                    const animation = preset.getAttribute('data-animation');
                    const interface = preset.getAttribute('data-interface');
                    
                    // Mettre à jour les sélecteurs
                    document.getElementById('card-style').value = style;
                    document.getElementById('primary-color').value = color;
                    document.getElementById('flip-animation').value = animation;
                    document.getElementById('interface-style').value = interface;
                    
                    // Mettre à jour l'état
                    appState.cardStyle = style;
                    appState.primaryColor = color;
                    appState.flipAnimation = animation;
                    appState.interfaceStyle = interface;
                    
                    // Mettre à jour visuellement le style sélectionné
                    updateSelectedStylePreset(`${style}-${color}-${animation}-${interface}`);
                    
                    showNotification('Style appliqué !');
                });
            });
            
            // Écouteurs pour les boutons IA de l'étape 2
            document.getElementById('ai-suggest-content-type').addEventListener('click', () => {
                enhancedAiOperation('suggest-content-type');
            });
            
            document.getElementById('ai-generate-theme').addEventListener('click', () => {
                enhancedAiOperation('generate-theme');
            });
            
            document.getElementById('ai-generate-examples').addEventListener('click', () => {
                enhancedAiOperation('generate-examples');
            });
            
            // Écouteur pour le curseur de température
            document.getElementById('ai-temperature').addEventListener('input', function() {
                const value = parseFloat(this.value).toFixed(1);
                document.getElementById('temperature-value').textContent = value;
                appState.apiState.temperature = parseFloat(value);
            });
            
            // Événements pour le bouton de configuration d'IA
            document.getElementById('configure-ai-btn').addEventListener('click', () => {
                openModal('api-config-modal');
            });
            
            // Écouteurs pour le bouton flottant API
            document.getElementById('floating-api-btn').addEventListener('click', () => {
                openModal('api-config-modal');
            });
            
            // Événements pour le modal API
            document.querySelector('.close-modal').addEventListener('click', () => {
                closeModal('api-config-modal');
            });
            
            document.querySelector('.close-modal-btn').addEventListener('click', () => {
                closeModal('api-config-modal');
            });
            
            document.getElementById('ai-provider').addEventListener('change', updateApiInterface);
            
            document.getElementById('save-api-settings').addEventListener('click', saveApiConfigurations);
            
            // Gérer la visibilité des clés API
            document.querySelectorAll('.toggle-visibility-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const inputId = this.getAttribute('data-target');
                    const input = document.getElementById(inputId);
                    
                    if (input.type === 'password') {
                        input.type = 'text';
                        this.innerHTML = '<i class="fas fa-eye-slash"></i>';
                    } else {
                        input.type = 'password';
                        this.innerHTML = '<i class="fas fa-eye"></i>';
                    }
                });
            });
            
            // Écouteurs pour les boutons de test API
            document.querySelectorAll('.test-api-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const service = this.getAttribute('data-service');
                    testApiConnection(service);
                });
            });
            
            // Écouteurs pour les boutons IA de l'étape 3
            document.getElementById('recommend-style-btn').addEventListener('click', () => {
                enhancedAiOperation('style-recommendation', 'Recommandation IA de style appliquée !');
            });
            
            document.getElementById('generate-palette-btn').addEventListener('click', () => {
                enhancedAiOperation('style-recommendation', 'Palette de couleurs générée et appliquée !');
            });
            
            document.getElementById('suggest-style-btn').addEventListener('click', () => {
                const styles = ['classic', 'modern', 'playful', 'minimal', 'gradient'];
                const randomStyle = styles[Math.floor(Math.random() * styles.length)];
                document.getElementById('card-style').value = randomStyle;
                appState.cardStyle = randomStyle;
                showNotification("Style suggéré : " + styleMap[randomStyle] + " !");
            });
            
            document.getElementById('suggest-animation-btn').addEventListener('click', () => {
                const animations = ['flip-horizontal', 'flip-vertical', 'fade', 'slide'];
                const randomAnimation = animations[Math.floor(Math.random() * animations.length)];
                document.getElementById('flip-animation').value = randomAnimation;
                appState.flipAnimation = randomAnimation;
                showNotification("Animation suggérée : " + animationMap[randomAnimation] + " !");
            });
            
            document.getElementById('suggest-color-btn').addEventListener('click', () => {
                const colors = ['purple', 'blue', 'red', 'green', 'orange', 'teal'];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                document.getElementById('primary-color').value = randomColor;
                appState.primaryColor = randomColor;
                showNotification("Couleur suggérée : " + colorMap[randomColor] + " !");
            });
            
            document.getElementById('suggest-interface-btn').addEventListener('click', () => {
                const interfaces = ['tabs', 'cards', 'wizard', 'single-page'];
                const randomInterface = interfaces[Math.floor(Math.random() * interfaces.length)];
                document.getElementById('interface-style').value = randomInterface;
                appState.interfaceStyle = randomInterface;
                showNotification("Interface suggérée : " + interfaceMap[randomInterface] + " !");
            });
            
            // Écouteurs pour les boutons IA de l'étape 4
            document.getElementById('generate-certificate-template').addEventListener('click', () => {
                enhancedAiOperation('certificate-template', 'Template de certificat généré !');
            });
            
            document.getElementById('generate-certificate-text').addEventListener('click', () => {
                enhancedAiOperation('certificate-text', 'Texte du certificat généré !');
            });
            
            document.getElementById('suggest-certificate-title').addEventListener('click', () => {
                const titles = [
                    "Certificat d'Excellence",
                    "Attestation de Réussite",
                    "Diplôme de Compétence",
                    "Certificat de Maîtrise"
                ];
                const randomTitle = titles[Math.floor(Math.random() * titles.length)];
                document.getElementById('certificate-title').value = randomTitle;
                appState.certificateTitle = randomTitle;
                updateCertificatePreview();
                showNotification("Titre de certificat suggéré !");
            });
            
            document.getElementById('suggest-certificate-style').addEventListener('click', () => {
                const styles = ['classic', 'modern', 'elegant', 'playful'];
                const randomStyle = styles[Math.floor(Math.random() * styles.length)];
                document.getElementById('certificate-style').value = randomStyle;
                appState.certificateStyle = randomStyle;
                showNotification("Style de certificat suggéré : " + certificateStyleMap[randomStyle] + " !");
            });
            
            // Prévention de la fermeture du modal en cliquant à l'extérieur
            const modal = document.getElementById('api-config-modal');
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal('api-config-modal');
                }
            });
            
            // Initialiser le rendu des catégories
            renderCategories();
            
            // Initialiser la prévisualisation du certificat
            updateCertificatePreview();
            
            // Mettre la date actuelle dans le certificat
            const now = new Date();
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            document.getElementById('certificate-date').textContent = now.toLocaleDateString('fr-FR', options);
            
            // Charger les configurations API
            loadApiConfigurations();
            
            // Mettre à jour l'interface API
            updateApiInterface();
            
            // Mettre à jour l'indicateur de connexion API
            updateApiConnectionStatus();
        }

        // Initialiser l'application au chargement
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
