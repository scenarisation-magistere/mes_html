<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template Python SCORM</title>
    <!-- Skulpt pour l'ex√©cution Python -->
    <script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt-stdlib.js"></script>
    <!-- CodeMirror pour l'√©diteur de code -->
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.2/lib/codemirror.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.2/mode/python/python.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.2/lib/codemirror.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-align: center;
        }
        
        .description {
            color: #666;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .formula {
            text-align: center;
            background: #f0f0f0;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 1.3em;
            font-weight: bold;
            color: #444;
        }
        
        .score-board {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            font-weight: bold;
            z-index: 100;
            display: flex;
            align-items: center;
        }
        
        .score {
            color: #667eea;
            font-size: 1.2em;
            margin-right: 15px;
        }
        
        .fullscreen-btn {
            background: none;
            border: none;
            color: #667eea;
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            transition: all 0.2s;
        }
        
        .fullscreen-btn:hover {
            background: #f0f0f0;
            transform: scale(1.1);
        }
        
        .challenges {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .challenge-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .challenge-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .challenge-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
        
        .challenge-text {
            background: #f7f7f7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            font-size: 1.1em;
            color: #333;
        }
        
        .expected-output {
            background: #f0f0f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            font-family: 'Menlo', Monaco, 'Courier New', monospace;
        }
        
        .editor-container {
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .CodeMirror {
            height: 150px;
            font-family: 'Menlo', Monaco, 'Courier New', monospace;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .output {
            background: #1e1e1e;
            color: white;
            padding: 15px;
            border-radius: 8px;
            height: 100px;
            overflow-y: auto;
            font-family: 'Menlo', monospace;
            margin-top: 15px;
            line-height: 1.5;
            white-space: pre-wrap;
            font-size: 0.9em;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .run-btn {
            background: #667eea;
            color: white;
            flex: 2;
        }
        
        .run-btn:hover {
            background: #5a67d8;
        }
        
        .clear-btn {
            background: #e9ecef;
            color: #333;
            flex: 1;
        }
        
        .clear-btn:hover {
            background: #dde2e6;
        }
        
        .hint-btn {
            background: #ffc107;
            color: #333;
            flex: 1;
        }
        
        .hint-btn:hover {
            background: #e0a800;
        }
        
        .hint {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9em;
            display: none;
        }
        
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .result.show {
            opacity: 1;
        }
        
        .result.correct {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .result.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .badges {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }
        
        .badge {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .badge.unlocked {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }
        
        .finish-btn {
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 30px auto 0;
            padding: 15px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .finish-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .finish-btn:disabled {
            background: #8fcb99;
            opacity: 0.7;
            cursor: default;
            transform: none;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            overflow: auto;
        }
        
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            animation: modalFade 0.3s ease;
        }
        
        @keyframes modalFade {
            from {transform: translateY(-50px); opacity: 0;}
            to {transform: translateY(0); opacity: 1;}
        }
        
        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .final-score {
            font-size: 1.5em;
            margin: 20px 0;
            text-align: center;
        }

        #scorm-debug {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 9999;
            font-size: 12px;
            font-family: monospace;
            display: none;
        }
        
        @media (max-width: 768px) {
            .challenges {
                grid-template-columns: 1fr;
            }
            
            .score-board {
                position: static;
                margin-bottom: 20px;
                text-align: center;
            }
        }
        
        /* Styles pour le mode plein √©cran */
        .fullscreen-container {
            width: 100%;
            height: 100vh;
            overflow-y: auto;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="score-board">
        Score: <span class="score" id="score">0</span> / <span id="totalChallenges">6</span>
        <button id="fullscreenBtn" class="fullscreen-btn" title="Mode plein √©cran">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1h-4zM10 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 16 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5zM.5 10a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 0 14.5v-4a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v4a1.5 1.5 0 0 1-1.5 1.5h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5z"/>
            </svg>
        </button>
    </div>
    
    <div class="container">
        <header>
            <h1>Mini D√©fis Python pour D√©butants</h1>
            <p class="description">Compl√©tez ces petits d√©fis pour tester vos connaissances en Python! √âcrivez votre code dans l'√©diteur et ex√©cutez-le pour v√©rifier votre solution.</p>
            
            <div class="badges">
                <div class="badge" id="badge1" title="D√©butant">üî∞</div>
                <div class="badge" id="badge2" title="Apprenti">ü•â</div>
                <div class="badge" id="badge3" title="Confirm√©">ü•à</div>
                <div class="badge" id="badge4" title="Expert">ü•á</div>
            </div>
        </header>
        
        <div class="challenges">
            <!-- Exercice 1: Print -->
            <div class="challenge-card" data-challenge="1">
                <div class="challenge-header">
                    <span>D√©fi #1: Affichage simple</span>
                </div>
                
                <div class="challenge-text">
                    √âcrivez un programme qui affiche le texte "Hello, Python!" √† l'√©cran.
                </div>
                
                <div class="expected-output">
                    <p><strong>Sortie attendue:</strong></p>
                    <pre>Hello, Python!</pre>
                </div>
                
                <div class="editor-container">
                    <textarea class="code-editor" id="editor1">
# √âcrivez votre code ici
</textarea>
                </div>
                
                <div class="output" id="output1">
                    <!-- La sortie du code appara√Ætra ici -->
                </div>
                
                <div class="buttons">
                    <button class="btn run-btn" data-challenge="1">Ex√©cuter</button>
                    <button class="btn clear-btn" data-challenge="1">Effacer</button>
                    <button class="btn hint-btn" data-challenge="1">Indice</button>
                </div>
                
                <div class="hint" id="hint1">
                    üí° Utilisez la fonction <code>print()</code> pour afficher du texte √† l'√©cran.
                </div>
                
                <div class="result" id="result1"></div>
            </div>
            
            <!-- Exercice 2: Variables -->
            <div class="challenge-card" data-challenge="2">
                <div class="challenge-header">
                    <span>D√©fi #2: Variables</span>
                </div>
                
                <div class="challenge-text">
                    Cr√©ez une variable <code>x</code> avec la valeur 42 et affichez-la.
                </div>
                
                <div class="expected-output">
                    <p><strong>Sortie attendue:</strong></p>
                    <pre>42</pre>
                </div>
                
                <div class="editor-container">
                    <textarea class="code-editor" id="editor2">
# √âcrivez votre code ici
</textarea>
                </div>
                
                <div class="output" id="output2">
                    <!-- La sortie du code appara√Ætra ici -->
                </div>
                
                <div class="buttons">
                    <button class="btn run-btn" data-challenge="2">Ex√©cuter</button>
                    <button class="btn clear-btn" data-challenge="2">Effacer</button>
                    <button class="btn hint-btn" data-challenge="2">Indice</button>
                </div>
                
                <div class="hint" id="hint2">
                    üí° Cr√©ez une variable avec <code>x = 42</code> puis utilisez <code>print(x)</code> pour l'afficher.
                </div>
                
                <div class="result" id="result2"></div>
            </div>
            
            <!-- Exercice 3: Input -->
            <div class="challenge-card" data-challenge="3">
                <div class="challenge-header">
                    <span>D√©fi #3: Entr√©e utilisateur</span>
                </div>
                
                <div class="challenge-text">
                    Demandez un nom √† l'utilisateur et affichez "Bonjour, [nom]!"
                    <br><br>
                    <strong>Note:</strong> L'entr√©e sera simul√©e avec la valeur "Alice".
                </div>
                
                <div class="expected-output">
                    <p><strong>Sortie attendue:</strong></p>
                    <pre>Bonjour, Alice!</pre>
                </div>
                
                <div class="editor-container">
                    <textarea class="code-editor" id="editor3">
# √âcrivez votre code ici
</textarea>
                </div>
                
                <div class="output" id="output3">
                    <!-- La sortie du code appara√Ætra ici -->
                </div>
                
                <div class="buttons">
                    <button class="btn run-btn" data-challenge="3">Ex√©cuter</button>
                    <button class="btn clear-btn" data-challenge="3">Effacer</button>
                    <button class="btn hint-btn" data-challenge="3">Indice</button>
                </div>
                
                <div class="hint" id="hint3">
                    üí° Utilisez <code>nom = input("Entrez votre nom: ")</code> pour demander le nom et <code>print("Bonjour, " + nom + "!")</code> pour l'afficher.
                </div>
                
                <div class="result" id="result3"></div>
            </div>
            
            <!-- Exercice 4: Conditions -->
            <div class="challenge-card" data-challenge="4">
                <div class="challenge-header">
                    <span>D√©fi #4: Conditions</span>
                </div>
                
                <div class="challenge-text">
                    √âcrivez un programme qui affiche "Positif" si un nombre est sup√©rieur √† 0.
                    <br><br>
                    <strong>Note:</strong> Utilisez la variable <code>nombre = 10</code>.
                </div>
                
                <div class="expected-output">
                    <p><strong>Sortie attendue:</strong></p>
                    <pre>Positif</pre>
                </div>
                
                <div class="editor-container">
                    <textarea class="code-editor" id="editor4">
# √âcrivez votre code ici
</textarea>
                </div>
                
                <div class="output" id="output4">
                    <!-- La sortie du code appara√Ætra ici -->
                </div>
                
                <div class="buttons">
                    <button class="btn run-btn" data-challenge="4">Ex√©cuter</button>
                    <button class="btn clear-btn" data-challenge="4">Effacer</button>
                    <button class="btn hint-btn" data-challenge="4">Indice</button>
                </div>
                
                <div class="hint" id="hint4">
                    üí° Utilisez <code>if</code> pour cr√©er une condition. Par exemple: <code>if nombre > 0:</code> puis indentez la ligne suivante avec 4 espaces.
                </div>
                
                <div class="result" id="result4"></div>
            </div>
            
            <!-- Exercice 5: Boucles -->
            <div class="challenge-card" data-challenge="5">
                <div class="challenge-header">
                    <span>D√©fi #5: Boucles</span>
                </div>
                
                <div class="challenge-text">
                    Utilisez une boucle pour afficher les nombres de 1 √† 3.
                </div>
                
                <div class="expected-output">
                    <p><strong>Sortie attendue:</strong></p>
                    <pre>1
2
3</pre>
                </div>
                
                <div class="editor-container">
                    <textarea class="code-editor" id="editor5">
# √âcrivez votre code ici
</textarea>
                </div>
                
                <div class="output" id="output5">
                    <!-- La sortie du code appara√Ætra ici -->
                </div>
                
                <div class="buttons">
                    <button class="btn run-btn" data-challenge="5">Ex√©cuter</button>
                    <button class="btn clear-btn" data-challenge="5">Effacer</button>
                    <button class="btn hint-btn" data-challenge="5">Indice</button>
                </div>
                
                <div class="hint" id="hint5">
                    üí° Vous pouvez utiliser <code>for i in range(1, 4):</code> pour cr√©er une boucle qui va de 1 √† 3, puis afficher chaque nombre avec <code>print(i)</code>.
                </div>
                
                <div class="result" id="result5"></div>
            </div>
            
            <!-- Exercice 6: Listes -->
            <div class="challenge-card" data-challenge="6">
                <div class="challenge-header">
                    <span>D√©fi #6: Listes</span>
                </div>
                
                <div class="challenge-text">
                    Cr√©ez une liste de fruits ["pomme", "orange", "banane"] et affichez chaque √©l√©ment.
                </div>
                
                <div class="expected-output">
                    <p><strong>Sortie attendue:</strong></p>
                    <pre>pomme
orange
banane</pre>
                </div>
                
                <div class="editor-container">
                    <textarea class="code-editor" id="editor6">
# √âcrivez votre code ici
</textarea>
                </div>
                
                <div class="output" id="output6">
                    <!-- La sortie du code appara√Ætra ici -->
                </div>
                
                <div class="buttons">
                    <button class="btn run-btn" data-challenge="6">Ex√©cuter</button>
                    <button class="btn clear-btn" data-challenge="6">Effacer</button>
                    <button class="btn hint-btn" data-challenge="6">Indice</button>
                </div>
                
                <div class="hint" id="hint6">
                    üí° Cr√©ez une liste avec <code>fruits = ["pomme", "orange", "banane"]</code> puis utilisez <code>for fruit in fruits:</code> pour parcourir chaque √©l√©ment.
                </div>
                
                <div class="result" id="result6"></div>
            </div>
        </div>
        
        <button id="finishBtn" class="finish-btn" disabled>Terminer les d√©fis</button>
    </div>
    
    <!-- Fen√™tre modale pour les r√©sultats finaux -->
    <div id="resultsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>F√©licitations!</h2>
            <p>Vous avez termin√© les d√©fis Python!</p>
            <div class="final-score">
                Score final: <span id="finalScore">0</span>/<span id="finalTotal">6</span>
            </div>
            <p id="achievementText">Continuez √† pratiquer pour am√©liorer vos comp√©tences en Python!</p>
        </div>
    </div>
    
    <div id="scorm-debug">
        <h3>SCORM Debug</h3>
        <div id="scorm-log"></div>
        <button id="toggleDebugBtn">Masquer</button>
        <button id="testSCORMBtn">Tester SCORM</button>
    </div>

    <script>
        // Variables globales
        let score = 0;
        let answered = new Set();
        const totalChallenges = 6;
        const editors = [];
        let testCompleted = false;
        let startTime = Date.now();
        
        // Badges et leurs seuils
        const badges = [
            { id: 'badge1', name: 'D√©butant', threshold: 1 },
            { id: 'badge2', name: 'Apprenti', threshold: 3 },
            { id: 'badge3', name: 'Confirm√©', threshold: 5 },
            { id: 'badge4', name: 'Expert', threshold: 6 }
        ];
        
        // Solutions attendues pour chaque d√©fi
        const expectedOutputs = {
            1: "Hello, Python!",
            2: "42",
            3: "Bonjour, Alice!",
            4: "Positif",
            5: "1\n2\n3",
            6: "pomme\norange\nbanane"
        };
        
        // Variables globales pour SCORM
        let API = null;
        let API_1484_11 = null;
        const scormVersion = "2004";
        let initialized = false;
        let terminated = false;
        let lastError = "";
        let suspendData = "";
        let entryStatus = "ab-initio";
        let sessionStartTime = Date.now();
        let totalTime = 0;
        let lastTimeUpdate = sessionStartTime;
        let timeInterval = null;
        
        // Stockage des r√©ponses de l'utilisateur
        let userAnswers = Array(totalChallenges).fill(null);
        
        // Initialisation de Skulpt
        function initSkulpt() {
            Sk.configure({
                output: function(text) {
                    // Cette fonction est remplac√©e lors de l'ex√©cution du code
                    return text;
                },
                read: function(x) {
                    if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
                        throw "File not found: '" + x + "'";
                    return Sk.builtinFiles["files"][x];
                },
                __future__: Sk.python3,
                retainingOutput: false 
            });
        }
        
        // Fonction pour ex√©cuter le code Python
        function runPython(challengeId) {
            const editor = editors[challengeId - 1];
            const outputElement = document.getElementById(`output${challengeId}`);
            
            // Vider la sortie pr√©c√©dente
            outputElement.innerHTML = '';
            
            // R√©cup√©rer le code
            let code = editor.getValue();
            
            // Pour le d√©fi 3, simulation d'input
            if (challengeId === 3 && code.includes('input(')) {
                // Injection pour simuler l'input sans modifier le code utilisateur
                Sk.builtinFiles = Sk.builtinFiles || { files: {} };
                Sk.builtinFiles.files['src/lib/inputhook.py'] = 'def get_input(prompt=""): return "Alice"';
                code = 'from inputhook import get_input\ndef input(prompt=""): return get_input(prompt)\n' + code;
            }
            
            // Pour le d√©fi 4, injecter le nombre 10 si non pr√©sent
            if (challengeId === 4 && !code.includes('nombre = 10')) {
                code = 'nombre = 10\n' + code;
            }
            
            // Configurer la sortie
            Sk.configure({
                output: function(text) {
                    // G√©rer les retours √† la ligne
                    if (text === '\n') {
                        outputElement.innerHTML += '<br>';
                    } else if (text.includes('\n')) {
                        const lines = text.split('\n');
                        for (let i = 0; i < lines.length; i++) {
                            if (i > 0) outputElement.innerHTML += '<br>';
                            if (lines[i]) outputElement.innerHTML += lines[i];
                        }
                    } else {
                        outputElement.innerHTML += text;
                    }
                    return text;
                },
                inputfun: function(prompt) {
                    // Simulation d'input avec "Alice"
                    return Promise.resolve("Alice");
                }
            });
            
            try {
                // Ex√©cuter le code Python
                Sk.misceval.asyncToPromise(function() {
                    return Sk.importMainWithBody("<stdin>", false, code, true);
                }).then(function() {
                    // V√©rifier si la sortie correspond √† celle attendue
                    checkOutput(challengeId);
                }, function(err) {
                    // Afficher l'erreur
                    outputElement.innerHTML += `<span style="color: red;">${err.toString()}</span>`;
                });
            } catch (e) {
                outputElement.innerHTML += `<span style="color: red;">${e.toString()}</span>`;
            }
        }
        
        // Fonction pour v√©rifier si la sortie correspond √† celle attendue
        function checkOutput(challengeId) {
            const outputElement = document.getElementById(`output${challengeId}`);
            const resultElement = document.getElementById(`result${challengeId}`);
            
            // Nouvelle m√©thode pour convertir le HTML en texte avec sauts de ligne
            const getTextWithLineBreaks = (element) => {
                // Cr√©er une copie du contenu pour ne pas modifier l'original
                const clone = element.cloneNode(true);
                
                // Remplacer tous les <br> par des sauts de ligne
                const brElements = clone.querySelectorAll('br');
                for (const br of brElements) {
                    br.replaceWith('\n');
                }
                
                // R√©cup√©rer le texte
                return clone.textContent || clone.innerText;
            };
            
            // R√©cup√©rer le contenu textuel avec sauts de ligne pr√©serv√©s
            let outputText = getTextWithLineBreaks(outputElement);
            
            // Normaliser la sortie
            const normalizeOutput = (text) => {
                return text
                    .replace(/\r\n/g, '\n')     // Normaliser les retours √† la ligne Windows
                    .replace(/\r/g, '\n')       // Normaliser les retours √† la ligne Mac
                    .replace(/^\s+|\s+$/g, '')  // Supprimer les espaces au d√©but et √† la fin
                    .split('\n')                // Diviser en lignes
                    .map(line => line.trim())   // Supprimer les espaces pour chaque ligne
                    .join('\n');                // Rejoindre avec des sauts de ligne
            };
            
            const output = normalizeOutput(outputText);
            const expected = normalizeOutput(expectedOutputs[challengeId]);
            
            // Debug - afficher les valeurs pour le d√©veloppement
            console.log(`Challenge ${challengeId}:`);
            console.log(`Output: "${output}"`);
            console.log(`Expected: "${expected}"`);
            
            // V√©rifier si la sortie correspond
            let isCorrect = output === expected;
            
            // V√©rification plus souple pour les nombres
            if (!isCorrect) {
                const outputLines = output.split('\n');
                const expectedLines = expected.split('\n');
                
                console.log(`Output lines: ${outputLines.length}, Expected lines: ${expectedLines.length}`);
                
                if (outputLines.length === expectedLines.length) {
                    isCorrect = true; // Pr√©sumer correct jusqu'√† preuve du contraire
                    
                    for (let i = 0; i < outputLines.length; i++) {
                        let outputLine = outputLines[i].trim();
                        let expectedLine = expectedLines[i].trim();
                        
                        console.log(`Line ${i+1}: "${outputLine}" vs "${expectedLine}"`);
                        
                        // Si les deux peuvent √™tre convertis en nombres, comparer les valeurs num√©riques
                        const outputNum = parseFloat(outputLine);
                        const expectedNum = parseFloat(expectedLine);
                        
                        if (!isNaN(outputNum) && !isNaN(expectedNum)) {
                            // Comparer avec une petite tol√©rance pour les nombres flottants
                            if (Math.abs(outputNum - expectedNum) > 0.0001) {
                                isCorrect = false;
                                break;
                            }
                        } else if (outputLine !== expectedLine) {
                            isCorrect = false;
                            break;
                        }
                    }
                }
            }
            
            if (isCorrect) {
                resultElement.textContent = "‚úÖ Correct ! D√©fi r√©ussi !";
                resultElement.className = "result correct show";
                
                // Masquer l'indice
                document.getElementById(`hint${challengeId}`).style.display = "none";
                
                // Mettre √† jour le score si le d√©fi n'a pas encore √©t√© r√©ussi
                if (!answered.has(challengeId)) {
                    answered.add(challengeId);
                    score++;
                    document.getElementById('score').textContent = score;
                    
                    // Sauvegarder la r√©ponse
                    userAnswers[challengeId - 1] = editors[challengeId - 1].getValue();
                    
                    // SCORM: Enregistrer l'interaction
                    recordInteraction(challengeId - 1, isCorrect);
                    
                    // SCORM: Sauvegarder le score
                    saveScore(score);
                    
                    // SCORM: Sauvegarder l'√©tat
                    saveState();
                    
                    // Mettre √† jour les badges
                    updateBadges();
                    
                    // Mettre √† jour le bouton de fin
                    updateFinishButton();
                }
            } else {
                resultElement.textContent = "‚ùå Incorrect. V√©rifiez votre code et r√©essayez.";
                resultElement.className = "result incorrect show";
            }
        }
        
        // Fonction pour mettre √† jour les badges
        function updateBadges() {
            badges.forEach(badge => {
                const badgeElement = document.getElementById(badge.id);
                if (score >= badge.threshold) {
                    badgeElement.classList.add('unlocked');
                } else {
                    badgeElement.classList.remove('unlocked');
                }
            });
        }
        
        // Fonction pour mettre √† jour le bouton de fin
        function updateFinishButton() {
            const finishBtn = document.getElementById('finishBtn');
            if (answered.size >= 1) {
                finishBtn.disabled = false;
            }
            if (answered.size === totalChallenges) {
                finishBtn.style.background = "#28a745";
                finishBtn.textContent = "Terminer tous les d√©fis";
            }
        }
        
        // Fonction pour effacer le code
        function clearCode(challengeId) {
            editors[challengeId - 1].setValue("# √âcrivez votre code ici");
            document.getElementById(`output${challengeId}`).innerHTML = '';
            document.getElementById(`result${challengeId}`).className = "result";
        }
        
        // Fonction pour afficher/masquer les indices
        function toggleHint(challengeId) {
            const hintElement = document.getElementById(`hint${challengeId}`);
            if (hintElement.style.display === "block") {
                hintElement.style.display = "none";
            } else {
                hintElement.style.display = "block";
            }
        }
        
        // Fonction pour afficher les r√©sultats finaux
        function showFinalResults() {
            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalTotal').textContent = totalChallenges;
            
            // D√©finir le message selon le score
            let achievementText = "";
            if (score === totalChallenges) {
                achievementText = "Parfait! Vous ma√Ætrisez les bases de Python! üéâ";
            } else if (score >= totalChallenges * 0.75) {
                achievementText = "Tr√®s bien! Vous avez une bonne compr√©hension de Python! üëç";
            } else if (score >= totalChallenges * 0.5) {
                achievementText = "Bien! Continuez √† pratiquer pour am√©liorer vos comp√©tences! üí™";
            } else {
                achievementText = "Continuez √† apprendre et pratiquer Python! üìö";
            }
            
            document.getElementById('achievementText').textContent = achievementText;
            
            // Afficher la fen√™tre modale
            document.getElementById('resultsModal').style.display = "block";
            
            // Marquer le test comme termin√©
            testCompleted = true;
            
            // SCORM: Marquer comme termin√©
            setValue("cmi.completion_status", "completed");
            setValue("cmi.success_status", (score / totalChallenges >= 0.7) ? "passed" : "failed");
            setValue("cmi.exit", "normal");
            
            // SCORM: Mettre √† jour le temps de session
            updateSessionTime();
            
            // SCORM: Sauvegarder l'√©tat final
            saveState();
            
            // SCORM: Effectuer un commit final
            commitSCORM();
        }
        
        // ========== FONCTIONS SCORM ==========
        
        // D√©tection de l'API SCORM
        function findAPI(win) {
            // Recherche SCORM 2004 API
            if (win.API_1484_11) return win.API_1484_11;
            
            // Recherche dans les frames
            let findAPITries = 0;
            while (win.parent && win.parent != win && findAPITries < 10) {
                findAPITries++;
                win = win.parent;
                if (win.API_1484_11) return win.API_1484_11;
            }
            
            // Si on n'a pas trouv√©, essayer avec les frames
            let frames = win.frames;
            for (let i = 0; i < frames.length; i++) {
                let api = findAPI(frames[i]);
                if (api) return api;
            }
            
            return null;
        }
        
        // Gestion des erreurs
        function getLastError() {
            if (API_1484_11) {
                let errorCode = API_1484_11.GetLastError();
                let errorString = API_1484_11.GetErrorString(errorCode);
                let errorDescription = API_1484_11.GetDiagnostic(errorCode);
                
                let errorInfo = "Code: " + errorCode + "\nDescription: " + errorString + "\nDiagnostic: " + errorDescription;
                console.error("SCORM Error: " + errorInfo);
                
                lastError = errorInfo;
                return errorCode;
            }
            return 0;
        }
        
        // Initialisation SCORM
        function initSCORM() {
            if (initialized) return true;
            
            // Trouver l'API SCORM 2004
            API_1484_11 = findAPI(window);
            
            if (!API_1484_11) {
                console.error("SCORM API non trouv√©e");
                return false;
            }
            
            // Initialiser la communication
            let result = API_1484_11.Initialize("");
            
            if (result === "true" || result === true) {
                console.log("SCORM API initialis√©e avec succ√®s");
                initialized = true;
                
                // R√©cup√©rer l'√©tat pr√©c√©dent si disponible
                entryStatus = getValue("cmi.entry");
                suspendData = getValue("cmi.suspend_data");
                
                // R√©cup√©rer les donn√©es sauvegard√©es si elles existent
                if (suspendData) {
                    try {
                        restoreState(suspendData);
                    } catch (e) {
                        console.error("Erreur lors de la restauration des donn√©es:", e);
                    }
                }
                
                return true;
            } else {
                console.error("√âchec de l'initialisation SCORM");
                getLastError();
                return false;
            }
        }
        
        // D√©finir une valeur SCORM
        function setValue(element, value) {
            if (!initialized || !API_1484_11) {
                console.error("SCORM API non initialis√©e");
                return false;
            }
            
            let result = API_1484_11.SetValue(element, value);
            
            if (result === "false" || result === false) {
                console.error(`Erreur lors de la d√©finition de ${element} = ${value}`);
                getLastError();
                return false;
            }
            
            return true;
        }
        
        // Obtenir une valeur SCORM
        function getValue(element) {
            if (!initialized || !API_1484_11) {
                console.error("SCORM API non initialis√©e");
                return "";
            }
            
            let value = API_1484_11.GetValue(element);
            
            if (API_1484_11.GetLastError() !== "0") {
                console.error(`Erreur lors de la r√©cup√©ration de ${element}`);
                getLastError();
                return "";
            }
            
            return value;
        }
        
        // Sauvegarder les changements SCORM
        function commitSCORM() {
            if (!initialized || !API_1484_11) {
                console.error("SCORM API non initialis√©e");
                return false;
            }
            
            let result = API_1484_11.Commit("");
            
            if (result === "false" || result === false) {
                console.error("Erreur lors du commit SCORM");
                getLastError();
                return false;
            }
            
            return true;
        }
        
        // Terminer la session SCORM
        function terminateSCORM() {
            if (!initialized || !API_1484_11 || terminated) {
                return false;
            }
            
            // Arr√™ter le suivi du temps
            stopTimeTracking();
            
            // Mettre √† jour le temps de session final
            updateSessionTime();
            
            // Commit final avant de terminer
            commitSCORM();
            
            // Terminer la session
            let result = API_1484_11.Terminate("");
            
            if (result === "true" || result === true) {
                console.log("Session SCORM termin√©e avec succ√®s");
                terminated = true;
                return true;
            } else {
                console.error("Erreur lors de la terminaison de la session SCORM");
                getLastError();
                return false;
            }
        }
        
        // Sauvegarde de l'√©tat
        function saveState() {
            // Cr√©er un objet avec toutes les donn√©es √† sauvegarder
            const stateData = {
                userAnswers: userAnswers,
                score: score,
                answered: Array.from(answered),
                testCompleted: testCompleted
            };
            
            // Convertir en JSON
            suspendData = JSON.stringify(stateData);
            
            // Sauvegarder dans SCORM
            setValue("cmi.suspend_data", suspendData);
            
            // Sauvegarder le score actuel
            saveScore(score);
            
            // Sauvegarder l'√©tat de progression
            saveProgress();
            
            // Commit imm√©diat pour assurer la persistance des donn√©es
            commitSCORM();
            
            console.log("√âtat sauvegard√© avec succ√®s");
        }
        
        // Restauration de l'√©tat
        function restoreState(jsonString) {
            if (!jsonString) return;
            
            try {
                const data = JSON.parse(jsonString);
                
                // Restaurer les donn√©es
                userAnswers = data.userAnswers || Array(totalChallenges).fill(null);
                score = data.score || 0;
                answered = new Set(data.answered || []);
                testCompleted = data.testCompleted || false;
                
                // Mettre √† jour l'interface
                document.getElementById('score').textContent = score;
                
                // Mettre √† jour les badges
                updateBadges();
                
                // Mettre √† jour chaque d√©fi
                for (let i = 0; i < userAnswers.length; i++) {
                    if (userAnswers[i] !== null) {
                        const challengeNum = i + 1;
                        
                        // Mettre √† jour l'√©diteur une fois qu'il est initialis√©
                        setTimeout(() => {
                            // Afficher le code sauvegard√©
                            if (editors[i]) {
                                editors[i].setValue(userAnswers[i]);
                                
                                // Ex√©cuter le code pour voir le r√©sultat
                                runPython(challengeNum);
                            }
                        }, 500);
                    }
                }
                
                // Mettre √† jour le bouton de fin
                updateFinishButton();
                
                // Si le test est d√©j√† termin√©, afficher les r√©sultats
                if (testCompleted) {
                    showFinalResults();
                }
                
                console.log("√âtat restaur√© avec succ√®s");
            } catch (e) {
                console.error("Erreur lors de la restauration de l'√©tat:", e);
            }
        }
        
        // Sauvegarde du score
        function saveScore(currentScore) {
            // Normaliser le score sur 100
            const normalizedScore = Math.min(Math.max((currentScore / totalChallenges) * 100, 0), 100);
            
            // Sauvegarder dans SCORM 2004
            setValue("cmi.score.raw", normalizedScore);
            setValue("cmi.score.min", "0");
            setValue("cmi.score.max", "100");
            setValue("cmi.score.scaled", normalizedScore / 100);
            
            // D√©terminer si le test est r√©ussi (seuil de r√©ussite √† 70%)
            if (testCompleted) {
                const passed = normalizedScore >= 70;
                setValue("cmi.success_status", passed ? "passed" : "failed");
            }
            
            console.log(`Score sauvegard√©: ${normalizedScore}/100 (${currentScore}/${totalChallenges})`);
            
            // Commit imm√©diat pour assurer la persistance du score
            commitSCORM();
        }
        
        // Suivi de la progression
        function saveProgress() {
            // Calculer le pourcentage de compl√©tion
            const progress = answered.size / totalChallenges;
            
            // D√©terminer l'√©tat de compl√©tion
            let completionStatus = "incomplete";
            
            if (testCompleted) {
                completionStatus = "completed";
            } else if (progress > 0) {
                completionStatus = "incomplete";
            } else {
                completionStatus = "not attempted";
            }
            
            // Sauvegarder dans SCORM
            setValue("cmi.completion_status", completionStatus);
            setValue("cmi.progress_measure", progress.toFixed(2));
            
            console.log(`Progression sauvegard√©e: ${(progress * 100).toFixed(0)}%, √©tat: ${completionStatus}`);
        }
        
        // Enregistrement des interactions
        function recordInteraction(challengeIndex, isCorrect) {
            if (!initialized) return;
            
            // G√©n√©rer un ID unique pour l'interaction
            const interactionId = `challenge${challengeIndex}`;
            
            // Type d'interaction (fill-in pour du code)
            const interactionType = "fill-in";
            
            // Description du d√©fi
            const description = `D√©fi #${challengeIndex + 1}`;
            
            // R√©ponse de l'utilisateur (code)
            const learnerAnswer = userAnswers[challengeIndex];
            
            // R√©sultat
            const result = isCorrect ? "correct" : "incorrect";
            
            // Horodatage
            const timestamp = new Date().toISOString();
            
            // Poids du d√©fi (1 point par d√©fi)
            const weighting = "1";
            
            // Dur√©e (non impl√©ment√©e ici)
            const latency = "PT0H0M0S";
            
            // Nombre total d'interactions jusqu'√† pr√©sent
            const n = parseInt(getValue("cmi.interactions._count"), 10) || 0;
            
            // Enregistrer l'interaction
            setValue(`cmi.interactions.${n}.id`, interactionId);
            setValue(`cmi.interactions.${n}.type`, interactionType);
            setValue(`cmi.interactions.${n}.description`, description);
            setValue(`cmi.interactions.${n}.learner_response`, learnerAnswer.substring(0, 250)); // Limiter √† 250 caract√®res
            setValue(`cmi.interactions.${n}.result`, result);
            setValue(`cmi.interactions.${n}.timestamp`, timestamp);
            setValue(`cmi.interactions.${n}.weighting`, weighting);
            setValue(`cmi.interactions.${n}.latency`, latency);
            
            console.log(`Interaction enregistr√©e: D√©fi ${challengeIndex + 1}, R√©sultat: ${result}`);
            
            // Commit pour sauvegarder cette interaction
            commitSCORM();
        }
        
        // Gestion du temps de session
        function startTimeTracking() {
            sessionStartTime = Date.now();
            lastTimeUpdate = sessionStartTime;
            
            // Mettre √† jour le temps toutes les 30 secondes
            timeInterval = setInterval(() => {
                updateSessionTime();
            }, 30000); // 30 secondes
        }
        
        function updateSessionTime() {
            const currentTime = Date.now();
            const elapsedTime = currentTime - lastTimeUpdate;
            
            totalTime += elapsedTime;
            lastTimeUpdate = currentTime;
            
            // Formater le temps selon SCORM 2004
            const formattedTime = formatScormTime(totalTime);
            
            // Sauvegarder dans SCORM
            setValue("cmi.session_time", formattedTime);
            
            // Commit pour sauvegarder le temps
            commitSCORM();
        }
        
        function formatScormTime(milliseconds) {
            const totalSeconds = Math.floor(milliseconds / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            // Format SCORM 2004: PTxHyMzS
            return `PT${hours}H${minutes}M${seconds}S`;
        }
        
        function stopTimeTracking() {
            if (timeInterval) {
                clearInterval(timeInterval);
                updateSessionTime(); // Enregistrer le temps final
            }
        }
        
        // Gestion du d√©bogage SCORM
        function enableSCORMDebugging() {
            const debugContainer = document.getElementById('scorm-debug');
            debugContainer.style.display = 'block';
            
            // Bouton pour masquer/afficher
            const toggleBtn = document.getElementById('toggleDebugBtn');
            toggleBtn.addEventListener('click', () => {
                const log = document.getElementById('scorm-log');
                if (log.style.display === 'none') {
                    log.style.display = 'block';
                    toggleBtn.textContent = 'Masquer';
                } else {
                    log.style.display = 'none';
                    toggleBtn.textContent = 'Afficher';
                }
            });
            
            // Bouton pour tester SCORM
            document.getElementById('testSCORMBtn').addEventListener('click', testSCORMConnection);
        }
        
        // Fonction pour tester la connexion SCORM
        function testSCORMConnection() {
            console.log("SCORM: Test de connexion");
            
            const tests = [
                { name: "API Initialis√©e", value: initialized },
                { name: "API Termin√©e", value: terminated },
                { name: "Version SCORM", value: scormVersion },
                { name: "Derni√®re erreur", value: lastError || "Aucune" },
                { name: "Status d'entr√©e", value: getValue("cmi.entry") || "Non d√©fini" },
                { name: "Score brut", value: getValue("cmi.score.raw") || "Non d√©fini" },
                { name: "Score √©chelle", value: getValue("cmi.score.scaled") || "Non d√©fini" },
                { name: "Status de r√©ussite", value: getValue("cmi.success_status") || "Non d√©fini" },
                { name: "Status de compl√©tion", value: getValue("cmi.completion_status") || "Non d√©fini" },
                { name: "Temps de session", value: getValue("cmi.session_time") || "Non d√©fini" },
                { name: "Donn√©es suspendues", value: getValue("cmi.suspend_data")?.substring(0, 50) + "..." || "Non d√©fini" },
                { name: "Nombre d'interactions", value: getValue("cmi.interactions._count") || "0" }
            ];
            
            const logElement = document.getElementById('scorm-log');
            logElement.innerHTML = '<h4>R√©sultats du test:</h4>';
            
            tests.forEach(test => {
                const entry = document.createElement('div');
                entry.innerHTML = `<strong>${test.name}:</strong> ${test.value}`;
                logElement.appendChild(entry);
            });
            
            console.log("SCORM: Test termin√©");
        }
        
        // Gestion du plein √©cran
        document.getElementById('fullscreenBtn').addEventListener('click', toggleFullScreen);
        
        function toggleFullScreen() {
            if (!document.fullscreenElement && 
                !document.mozFullScreenElement && 
                !document.webkitFullscreenElement && 
                !document.msFullscreenElement) {
                // Passer en mode plein √©cran
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                } else if (document.documentElement.msRequestFullscreen) {
                    document.documentElement.msRequestFullscreen();
                } else if (document.documentElement.mozRequestFullScreen) {
                    document.documentElement.mozRequestFullScreen();
                } else if (document.documentElement.webkitRequestFullscreen) {
                    document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
                }
                updateFullscreenButton(true);
                document.body.classList.add('fullscreen-container');
            } else {
                // Quitter le mode plein √©cran
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                }
                updateFullscreenButton(false);
                document.body.classList.remove('fullscreen-container');
            }
        }
        
        function updateFullscreenButton(isFullscreen) {
            const btn = document.getElementById('fullscreenBtn');
            if (isFullscreen) {
                btn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M5.5 0a.5.5 0 0 1 .5.5v4A1.5 1.5 0 0 1 4.5 6h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5zm5 0a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 10 4.5v-4a.5.5 0 0 1 .5-.5zM0 10.5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 6 11.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5zm10 1a1.5 1.5 0 0 1 1.5-1.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4z"/>
                </svg>`;
                btn.title = "Quitter le plein √©cran";
            } else {
                btn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1h-4zM10 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 16 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5zM.5 10a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 0 14.5v-4a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v4a1.5 1.5 0 0 1-1.5 1.5h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5z"/>
                </svg>`;
                btn.title = "Mode plein √©cran";
            }
        }
        
        // D√©tection des changements de plein √©cran
        document.addEventListener('fullscreenchange', () => {
            updateFullscreenButton(!!document.fullscreenElement);
            document.body.classList.toggle('fullscreen-container', !!document.fullscreenElement);
        });
        document.addEventListener('webkitfullscreenchange', () => {
            updateFullscreenButton(!!document.webkitFullscreenElement);
            document.body.classList.toggle('fullscreen-container', !!document.webkitFullscreenElement);
        });
        document.addEventListener('mozfullscreenchange', () => {
            updateFullscreenButton(!!document.mozFullScreenElement);
            document.body.classList.toggle('fullscreen-container', !!document.mozFullScreenElement);
        });
        document.addEventListener('MSFullscreenChange', () => {
            updateFullscreenButton(!!document.msFullscreenElement);
            document.body.classList.toggle('fullscreen-container', !!document.msFullscreenElement);
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser Skulpt
            initSkulpt();
            
            // Initialiser les √©diteurs CodeMirror
            for (let i = 1; i <= totalChallenges; i++) {
                const editorElement = document.getElementById(`editor${i}`);
                const editor = CodeMirror.fromTextArea(editorElement, {
                    mode: "python",
                    lineNumbers: true,
                    theme: "default",
                    indentUnit: 4,
                    tabSize: 4,
                    indentWithTabs: false,
                    autofocus: false
                });
                
                // Stocker l'√©diteur dans le tableau
                editors.push(editor);
            }
            
            // Ajouter les exemples de d√©part
            const startingExamples = {
                1: "# Exemple :\n# print(\"Hello, Python!\")",
                2: "# Exemple :\n# x = 42\n# print(x)",
                3: "# Exemple :\n# nom = input(\"Entrez votre nom: \")\n# print(\"Bonjour, \" + nom + \"!\")",
                4: "# Exemple :\n# nombre = 10\n# if nombre > 0:\n#     print(\"Positif\")",
                5: "# Exemple :\n# for i in range(1, 4):\n#     print(i)",
                6: "# Exemple :\n# fruits = [\"pomme\", \"orange\", \"banane\"]\n# for fruit in fruits:\n#     print(fruit)"
            };
            
            // D√©finir les exemples dans les √©diteurs
            for (let i = 1; i <= totalChallenges; i++) {
                if (editors[i-1]) {
                    editors[i-1].setValue(startingExamples[i]);
                }
            }
            
            // Ajouter les √©couteurs d'√©v√©nements pour les boutons "Ex√©cuter"
            document.querySelectorAll('.run-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const challengeId = parseInt(this.getAttribute('data-challenge'), 10);
                    runPython(challengeId);
                });
            });
            
            // Ajouter les √©couteurs d'√©v√©nements pour les boutons "Effacer"
            document.querySelectorAll('.clear-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const challengeId = parseInt(this.getAttribute('data-challenge'), 10);
                    clearCode(challengeId);
                });
            });
            
            // Ajouter les √©couteurs d'√©v√©nements pour les boutons "Indice"
            document.querySelectorAll('.hint-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const challengeId = parseInt(this.getAttribute('data-challenge'), 10);
                    toggleHint(challengeId);
                });
            });
            
            // Ajouter l'√©couteur d'√©v√©nement pour le bouton de fin
            document.getElementById('finishBtn').addEventListener('click', showFinalResults);
            
            // G√©rer la fermeture de la fen√™tre modale
            document.querySelector('.close-modal').addEventListener('click', function() {
                document.getElementById('resultsModal').style.display = "none";
            });
            
            // Fermer la fen√™tre modale en cliquant √† l'ext√©rieur
            window.addEventListener('click', function(event) {
                if (event.target === document.getElementById('resultsModal')) {
                    document.getElementById('resultsModal').style.display = "none";
                }
            });
            
            // Initialiser SCORM
            initSCORM();
            startTimeTracking();
            
            // Activer le d√©bogage en mode d√©veloppement
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                enableSCORMDebugging();
            }
        });
        
        // Sauvegarde avant d√©chargement
        window.addEventListener('beforeunload', () => {
            if (!testCompleted) {
                // Sauvegarder l'√©tat actuel
                saveState();
                setValue("cmi.exit", "suspend");
            }
            
            terminateSCORM();
        });
        
        // √âv√©nement pour la mise en veille
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'hidden') {
                // L'utilisateur quitte la page ou la met en arri√®re-plan
                saveState();
                setValue("cmi.exit", "suspend");
                commitSCORM();
            }
        });
    </script>
</body>
</html>