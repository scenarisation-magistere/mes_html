<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activité SCORM Interactive - Calcul de Masses Molaires des Alcools</title>
    <style>
        /* Styles généraux - Thème sombre */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        :root {
            --primary-color: #667eea;
            --primary-dark: #5a67d8;
            --secondary-color: #764ba2;
            --background-color: #121212;
            --surface-color: #1e1e1e;
            --text-color: #f0f0f0;
            --text-secondary: #aaaaaa;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--surface-color);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        /* Styles du header */
        h1 {
            text-align: center;
            color: var(--text-color);
            margin-bottom: 20px;
            font-size: 2.5em;
        }
        
        .typescorm {
            position: fixed;
            top: 60px;
            left: 60px;
            background-color: var(--primary-color);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            transform: translateY(-50%);
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            z-index: 100;
        }        
        
        .score-board {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--surface-color);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            font-weight: bold;
            color: var(--text-color);
            z-index: 100;
            border: 1px solid var(--primary-color);
        }
        
        .score {
            color: var(--primary-color);
            font-size: 1.2em;
        }
        
        .formula-box {
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            color: var(--text-color);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .formula {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--text-color);
        }
        
        .formula-explanation {
            font-size: 0.9em;
            color: var(--text-secondary);
        }
        
        /* Style pour les badges */
        .badges-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .badge {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--surface-color);
            border: 2px solid #444;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            color: #444;
            position: relative;
            transition: all 0.3s ease;
            cursor: default;
        }
        
        .badge.unlocked {
            border-color: var(--primary-color);
            color: var(--primary-color);
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.5);
            animation: badgeUnlock 0.5s ease-out;
        }
        
        .badge span {
            position: absolute;
            bottom: -25px;
            font-size: 0.4em;
            width: 100px;
            text-align: center;
            color: var(--text-secondary);
        }
        
        @keyframes badgeUnlock {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        /* Styles pour les exercices */
        .exercises-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 30px;
        }
        
        .exercise-card {
            background: var(--surface-color);
            border: 1px solid #333;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .exercise-card h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 1px solid #333;
            padding-bottom: 8px;
        }
        
        /* Styles pour les modèles 3D */
        .molecule-model {
            width: 100%;
            height: 250px;
            background: #0c0e1a;
            border-radius: 10px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle ease infinite;
        }
        
        @keyframes twinkle {
            0% { opacity: 0.3; }
            50% { opacity: 1; }
            100% { opacity: 0.3; }
        }
        
        .model-controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            z-index: 10;
            display: flex;
            gap: 5px;
        }
        
        .zoom-controls {
            position: absolute;
            bottom: 10px;
            right: 10px;
            z-index: 10;
            display: flex;
            gap: 5px;
        }
        
        .control-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Styles pour les données moléculaires */
        .molecule-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
        }
        
        .molecule-info-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .molecule-info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            color: var(--text-secondary);
        }
        
        .info-value {
            font-weight: bold;
            color: var(--text-color);
        }
        
        .atom-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 8px;
        }
        
        .atom-item {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.9em;
            margin-right: 5px;
        }
        
        .atom-H {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .atom-C {
            background: rgba(68, 68, 68, 0.3);
            color: #aaa;
        }
        
        .atom-O {
            background: rgba(255, 0, 0, 0.2);
            color: #ff8080;
        }
        
        /* Styles pour le formulaire de réponse */
        .answer-form {
            margin-top: 15px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-weight: bold;
        }
        
        .input-field {
            width: 100%;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 1em;
            transition: all 0.3s;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.3);
        }
        
        .check-btn {
            width: 100%;
            padding: 10px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .check-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .check-btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .result.show {
            opacity: 1;
        }
        
        .result.correct {
            background: rgba(40, 167, 69, 0.2);
            color: #2ecc71;
            border: 1px solid rgba(40, 167, 69, 0.3);
        }
        
        .result.incorrect {
            background: rgba(220, 53, 69, 0.2);
            color: #e74c3c;
            border: 1px solid rgba(220, 53, 69, 0.3);
        }
        
        .hint {
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.2);
            color: #ffc107;
            border-radius: 8px;
            font-size: 0.9em;
            display: none;
        }
        
        /* Animation pour les exercices résolus */
        .exercise-card.solved {
            border-color: var(--success-color);
            background-color: rgba(40, 167, 69, 0.05);
        }
        
        /* Style pour les exercices incorrects */
        .exercise-card.incorrect {
            background-color: rgba(220, 53, 69, 0.05);
            border: 1px solid rgba(220, 53, 69, 0.2);
            box-shadow: 0 4px 10px rgba(220, 53, 69, 0.1);
        }
        
        /* CSS pour le bouton "Plein écran" */
        .fullscreen-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: var(--surface-color);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            border: 1px solid var(--primary-color);
        }
        
        .fullscreen-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0,0,0,0.4);
        }
        
        .fullscreen-icon {
            font-size: 1.5em;
            color: var(--primary-color);
        }
        
        /* Style pour le mode plein écran */
        .fullscreen-container {
            width: 100%;
            height: 100vh;
            overflow-y: auto;
            background: var(--background-color);
            padding: 20px;
        }
        
        /* Bouton de fin d'activité */
        .finish-btn {
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 30px auto 0;
            padding: 15px;
            background: var(--success-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .finish-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .finish-btn:disabled {
            background: #2c5a37;
            opacity: 0.7;
            cursor: default;
            transform: none;
        }
        
        /* Styles pour le modal de fin d'activité */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal-content {
            background: var(--surface-color);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
            position: relative;
            animation: slideIn 0.4s ease-out;
            border: 1px solid var(--primary-color);
        }
        
        .modal-header {
            margin-bottom: 20px;
        }
        
        .modal-header h2 {
            color: var(--primary-color);
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .modal-body {
            margin-bottom: 25px;
        }
        
        .score-result {
            font-size: 3em;
            font-weight: bold;
            color: var(--primary-color);
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .score-text {
            font-size: 1.2em;
            margin-bottom: 15px;
        }
        
        .exercise-summary {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: left;
        }
        
        .exercise-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .exercise-item:last-child {
            border-bottom: none;
        }
        
        .exercise-status {
            font-weight: bold;
        }
        
        .status-completed {
            color: var(--success-color);
        }
        
        .status-incomplete {
            color: var(--danger-color);
        }
        
        .modal-footer {
            margin-top: 20px;
        }
        
        .close-modal-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .close-modal-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(90, 103, 216, 0.3);
        }
        
        .modal-badge {
            position: absolute;
            top: -15px;
            right: -15px;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--success-color);
            color: white;
            font-weight: bold;
            font-size: 1.2em;
            border-radius: 50%;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            border: 4px solid var(--surface-color);
        }
        
        .modal-badge.failed {
            background: var(--danger-color);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Message de validation */
        #validation-message {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 1000;
            display: none;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            max-width: 90%;
        }
        
        /* Media queries pour la responsivité */
        @media (max-width: 768px) {
            .exercises-grid {
                grid-template-columns: 1fr;
            }
            
            .score-board {
                position: static;
                margin-bottom: 20px;
                text-align: center;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }
            
            .modal-header h2 {
                font-size: 1.5em;
            }
            
            .score-result {
                font-size: 2.5em;
            }
            
            .modal-badge {
                width: 60px;
                height: 60px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <!-- Tableau de score -->
    <div class="score-board">
        Score: <span class="score" id="score">0</span> / <span id="total">6</span>
    </div>
    
    <!-- Bouton plein écran -->
    <div class="fullscreen-btn" id="fullscreenBtn">
        <span class="fullscreen-icon">⛶</span>
    </div>
    
    <!-- Message de validation -->
    <div id="validation-message"></div>
    
    <div class="container">
        <h1>🧪 Calcul de Masses Molaires des Alcools 🧪</h1>
        
        <div class="typescorm">SCORM App</div>
        
        <div class="formula-box">
            <div class="formula">
                Calcul des masses molaires des alcools (composés avec groupe -OH)
            </div>
            <div class="formula-explanation">
                Calculez les masses molaires des alcools en utilisant les masses atomiques des éléments. Les alcools sont caractérisés par la présence d'un groupe hydroxyle (-OH) lié à un atome de carbone.
            </div>
        </div>
        
        <!-- Badges de gamification -->
        <div class="badges-container">
            <div class="badge" id="badge1">
                🧪
                <span>Débutant</span>
            </div>
            <div class="badge" id="badge2">
                ⚗️
                <span>Apprenti</span>
            </div>
            <div class="badge" id="badge3">
                🔬
                <span>Expert</span>
            </div>
            <div class="badge" id="badge4">
                🏆
                <span>Maître</span>
            </div>
        </div>
        
        <!-- Exercices -->
        <div class="exercises-grid">
            <!-- Exercice 1: Méthanol (CH₃OH) -->
            <div class="exercise-card" id="exercise1">
                <h3>Exercice 1: Méthanol (CH₃OH)</h3>
                <div class="molecule-model" id="methanol-model">
                    <div class="stars" id="methanol-stars"></div>
                    <div class="model-controls">
                        <button class="control-btn" onclick="rotateModel('methanol', 'reset')">R</button>
                        <button class="control-btn" onclick="rotateModel('methanol', 'pause')">⏸️</button>
                        <button class="control-btn" onclick="rotateModel('methanol', 'play')">▶️</button>
                    </div>
                    <div class="zoom-controls">
                        <button class="control-btn" onclick="zoomModel('methanol', 'in')">+</button>
                        <button class="control-btn" onclick="zoomModel('methanol', 'out')">-</button>
                    </div>
                </div>
                
                <div class="molecule-info">
                    <div class="molecule-info-row">
                        <span class="info-label">Formule:</span>
                        <span class="info-value">CH₃OH</span>
                    </div>
                    <div class="molecule-info-row">
                        <span class="info-label">Atomes:</span>
                        <div class="atom-list">
                            <span class="atom-item atom-C">C: 12,01 g/mol</span>
                            <span class="atom-item atom-H">H: 1,008 g/mol</span>
                            <span class="atom-item atom-O">O: 16,00 g/mol</span>
                        </div>
                    </div>
                    <div class="molecule-info-row">
                        <span class="info-label">Code couleur:</span>
                        <div class="atom-list">
                            <span class="atom-item atom-C">C: Gris</span>
                            <span class="atom-item atom-H">H: Blanc</span>
                            <span class="atom-item atom-O">O: Rouge</span>
                        </div>
                    </div>
                </div>
                
                <div class="answer-form">
                    <div class="input-group">
                        <label class="input-label">Calculez la masse molaire de CH₃OH (g/mol):</label>
                        <input type="number" step="0.001" class="input-field" id="answer1" placeholder="Entrez votre réponse">
                    </div>
                    <button class="check-btn" id="check1">Vérifier</button>
                    <div class="result" id="result1"></div>
                    <div class="hint" id="hint1">💡 Calculez: (1 × masse molaire C) + (4 × masse molaire H) + (1 × masse molaire O)</div>
                </div>
            </div>
            
            <!-- Exercice 2: Éthanol (C₂H₅OH) -->
            <div class="exercise-card" id="exercise2">
                <h3>Exercice 2: Éthanol (C₂H₅OH)</h3>
                <div class="molecule-model" id="ethanol-model">
                    <div class="stars" id="ethanol-stars"></div>
                    <div class="model-controls">
                        <button class="control-btn" onclick="rotateModel('ethanol', 'reset')">R</button>
                        <button class="control-btn" onclick="rotateModel('ethanol', 'pause')">⏸️</button>
                        <button class="control-btn" onclick="rotateModel('ethanol', 'play')">▶️</button>
                    </div>
                    <div class="zoom-controls">
                        <button class="control-btn" onclick="zoomModel('ethanol', 'in')">+</button>
                        <button class="control-btn" onclick="zoomModel('ethanol', 'out')">-</button>
                    </div>
                </div>
                
                <div class="molecule-info">
                    <div class="molecule-info-row">
                        <span class="info-label">Formule:</span>
                        <span class="info-value">C₂H₅OH</span>
                    </div>
                    <div class="molecule-info-row">
                        <span class="info-label">Atomes:</span>
                        <div class="atom-list">
                            <span class="atom-item atom-C">C: 12,01 g/mol</span>
                            <span class="atom-item atom-H">H: 1,008 g/mol</span>
                            <span class="atom-item atom-O">O: 16,00 g/mol</span>
                        </div>
                    </div>
                    <div class="molecule-info-row">
                        <span class="info-label">Code couleur:</span>
                        <div class="atom-list">
                            <span class="atom-item atom-C">C: Gris</span>
                            <span class="atom-item atom-H">H: Blanc</span>
                            <span class="atom-item atom-O">O: Rouge</span>
                        </div>
                    </div>
                </div>
                
                <div class="answer-form">
                    <div class="input-group">
                        <label class="input-label">Calculez la masse molaire de C₂H₅OH (g/mol):</label>
                        <input type="number" step="0.001" class="input-field" id="answer2" placeholder="Entrez votre réponse">
                    </div>
                    <button class="check-btn" id="check2">Vérifier</button>
                    <div class="result" id="result2"></div>
                    <div class="hint" id="hint2">💡 Calculez: (2 × masse molaire C) + (6 × masse molaire H) + (1 × masse molaire O)</div>
                </div>
            </div>
            
            <!-- Exercice 3: Propan-1-ol (C₃H₇OH) -->
            <div class="exercise-card" id="exercise3">
                <h3>Exercice 3: Propan-1-ol (C₃H₇OH)</h3>
                <div class="molecule-model" id="propanol-model">
                    <div class="stars" id="propanol-stars"></div>
                    <div class="model-controls">
                        <button class="control-btn" onclick="rotateModel('propanol', 'reset')">R</button>
                        <button class="control-btn" onclick="rotateModel('propanol', 'pause')">⏸️</button>
                        <button class="control-btn" onclick="rotateModel('propanol', 'play')">▶️</button>
                    </div>
                    <div class="zoom-controls">
                        <button class="control-btn" onclick="zoomModel('propanol', 'in')">+</button>
                        <button class="control-btn" onclick="zoomModel('propanol', 'out')">-</button>
                    </div>
                </div>
                
                <div class="molecule-info">
                    <div class="molecule-info-row">
                        <span class="info-label">Formule:</span>
                        <span class="info-value">C₃H₇OH</span>
                    </div>
                    <div class="molecule-info-row">
                        <span class="info-label">Atomes:</span>
                        <div class="atom-list">
                            <span class="atom-item atom-C">C: 12,01 g/mol</span>
                            <span class="atom-item atom-H">H: 1,008 g/mol</span>
                            <span class="atom-item atom-O">O: 16,00 g/mol</span>
                        </div>
                    </div>
                    <div class="molecule-info-row">
                        <span class="info-label">Code couleur:</span>
                        <div class="atom-list">
                            <span class="atom-item atom-C">C: Gris</span>
                            <span class="atom-item atom-H">H: Blanc</span>
                            <span class="atom-item atom-O">O: Rouge</span>
                        </div>
                    </div>
                </div>
                
                <div class="answer-form">
                    <div class="input-group">
                        <label class="input-label">Calculez la masse molaire de C₃H₇OH (g/mol):</label>
                        <input type="number" step="0.001" class="input-field" id="answer3" placeholder="Entrez votre réponse">
                    </div>
                    <button class="check-btn" id="check3">Vérifier</button>
                    <div class="result" id="result3"></div>
                    <div class="hint" id="hint3">💡 Calculez: (3 × masse molaire C) + (8 × masse molaire H) + (1 × masse molaire O)</div>
                </div>
            </div>
            
            <!-- Exercice 4: Isopropanol (C₃H₇OH) -->
            <div class="exercise-card" id="exercise4">
                <h3>Exercice 4: Isopropanol (C₃H₇OH)</h3>
                <div class="molecule-model" id="isopropanol-model">
                    <div class="stars" id="isopropanol-stars"></div>
                    <div class="model-controls">
                        <button class="control-btn" onclick="rotateModel('isopropanol', 'reset')">R</button>
                        <button class="control-btn" onclick="rotateModel('isopropanol', 'pause')">⏸️</button>
                        <button class="control-btn" onclick="rotateModel('isopropanol', 'play')">▶️</button>
                    </div>
                    <div class="zoom-controls">
                        <button class="control-btn" onclick="zoomModel('isopropanol', 'in')">+</button>
                        <button class="control-btn" onclick="zoomModel('isopropanol', 'out')">-</button>
                    </div>
                </div>
                
                <div class="molecule-info">
                    <div class="molecule-info-row">
                        <span class="info-label">Formule:</span>
                        <span class="info-value">C₃H₇OH</span>
                    </div>
                    <div class="molecule-info-row">
                        <span class="info-label">Atomes:</span>
                        <div class="atom-list">
                            <span class="atom-item atom-C">C: 12,01 g/mol</span>
                            <span class="atom-item atom-H">H: 1,008 g/mol</span>
                            <span class="atom-item atom-O">O: 16,00 g/mol</span>
                        </div>
                    </div>
                    <div class="molecule-info-row">
                        <span class="info-label">Code couleur:</span>
                        <div class="atom-list">
                            <span class="atom-item atom-C">C: Gris</span>
                            <span class="atom-item atom-H">H: Blanc</span>
                            <span class="atom-item atom-O">O: Rouge</span>
                        </div>
                    </div>
                </div>
                
                <div class="answer-form">
                    <div class="input-group">
                        <label class="input-label">Calculez la masse molaire de C₃H₇OH (g/mol):</label>
                        <input type="number" step="0.001" class="input-field" id="answer4" placeholder="Entrez votre réponse">
                    </div>
                    <button class="check-btn" id="check4">Vérifier</button>
                    <div class="result" id="result4"></div>
                    <div class="hint" id="hint4">💡 Calculez: (3 × masse molaire C) + (8 × masse molaire H) + (1 × masse molaire O)</div>
                </div>
            </div>
            
            <!-- Exercice 5: Butan-1-ol (C₄H₉OH) -->
            <div class="exercise-card" id="exercise5">
                <h3>Exercice 5: Butan-1-ol (C₄H₉OH)</h3>
                <div class="molecule-model" id="butanol-model">
                    <div class="stars" id="butanol-stars"></div>
                    <div class="model-controls">
                        <button class="control-btn" onclick="rotateModel('butanol', 'reset')">R</button>
                        <button class="control-btn" onclick="rotateModel('butanol', 'pause')">⏸️</button>
                        <button class="control-btn" onclick="rotateModel('butanol', 'play')">▶️</button>
                    </div>
                    <div class="zoom-controls">
                        <button class="control-btn" onclick="zoomModel('butanol', 'in')">+</button>
                        <button class="control-btn" onclick="zoomModel('butanol', 'out')">-</button>
                    </div>
                </div>
                
                <div class="molecule-info">
                    <div class="molecule-info-row">
                        <span class="info-label">Formule:</span>
                        <span class="info-value">C₄H₉OH</span>
                    </div>
                    <div class="molecule-info-row">
                        <span class="info-label">Atomes:</span>
                        <div class="atom-list">
                            <span class="atom-item atom-C">C: 12,01 g/mol</span>
                            <span class="atom-item atom-H">H: 1,008 g/mol</span>
                            <span class="atom-item atom-O">O: 16,00 g/mol</span>
                        </div>
                    </div>
                    <div class="molecule-info-row">
                        <span class="info-label">Code couleur:</span>
                        <div class="atom-list">
                            <span class="atom-item atom-C">C: Gris</span>
                            <span class="atom-item atom-H">H: Blanc</span>
                            <span class="atom-item atom-O">O: Rouge</span>
                        </div>
                    </div>
                </div>
                
                <div class="answer-form">
                    <div class="input-group">
                        <label class="input-label">Calculez la masse molaire de C₄H₉OH (g/mol):</label>
                        <input type="number" step="0.001" class="input-field" id="answer5" placeholder="Entrez votre réponse">
                    </div>
                    <button class="check-btn" id="check5">Vérifier</button>
                    <div class="result" id="result5"></div>
                    <div class="hint" id="hint5">💡 Calculez: (4 × masse molaire C) + (10 × masse molaire H) + (1 × masse molaire O)</div>
                </div>
            </div>
            
            <!-- Exercice 6: Pentan-1-ol (C₅H₁₁OH) -->
            <div class="exercise-card" id="exercise6">
                <h3>Exercice 6: Pentan-1-ol (C₅H₁₁OH)</h3>
                <div class="molecule-model" id="pentanol-model">
                    <div class="stars" id="pentanol-stars"></div>
                    <div class="model-controls">
                        <button class="control-btn" onclick="rotateModel('pentanol', 'reset')">R</button>
                        <button class="control-btn" onclick="rotateModel('pentanol', 'pause')">⏸️</button>
                        <button class="control-btn" onclick="rotateModel('pentanol', 'play')">▶️</button>
                    </div>
                    <div class="zoom-controls">
                        <button class="control-btn" onclick="zoomModel('pentanol', 'in')">+</button>
                        <button class="control-btn" onclick="zoomModel('pentanol', 'out')">-</button>
                    </div>
                </div>
                
                <div class="molecule-info">
                    <div class="molecule-info-row">
                        <span class="info-label">Formule:</span>
                        <span class="info-value">C₅H₁₁OH</span>
                    </div>
                    <div class="molecule-info-row">
                        <span class="info-label">Atomes:</span>
                        <div class="atom-list">
                            <span class="atom-item atom-C">C: 12,01 g/mol</span>
                            <span class="atom-item atom-H">H: 1,008 g/mol</span>
                            <span class="atom-item atom-O">O: 16,00 g/mol</span>
                        </div>
                    </div>
                    <div class="molecule-info-row">
                        <span class="info-label">Code couleur:</span>
                        <div class="atom-list">
                            <span class="atom-item atom-C">C: Gris</span>
                            <span class="atom-item atom-H">H: Blanc</span>
                            <span class="atom-item atom-O">O: Rouge</span>
                        </div>
                    </div>
                </div>
                
                <div class="answer-form">
                    <div class="input-group">
                        <label class="input-label">Calculez la masse molaire de C₅H₁₁OH (g/mol):</label>
                        <input type="number" step="0.001" class="input-field" id="answer6" placeholder="Entrez votre réponse">
                    </div>
                    <button class="check-btn" id="check6">Vérifier</button>
                    <div class="result" id="result6"></div>
                    <div class="hint" id="hint6">💡 Calculez: (5 × masse molaire C) + (12 × masse molaire H) + (1 × masse molaire O)</div>
                </div>
            </div>
        </div>
        
        <!-- Bouton de fin d'activité -->
        <button id="finishBtn" class="finish-btn" disabled>Terminer l'activité</button>
    </div>
    
    <!-- Modal de fin d'activité -->
    <div id="completion-modal" class="modal-overlay">
        <div class="modal-content">
            <div id="modal-badge" class="modal-badge">70%</div>
            <div class="modal-header">
                <h2>Activité terminée !</h2>
                <p>Vous avez complété les exercices de calcul de masses molaires des alcools.</p>
            </div>
            <div class="modal-body">
                <div class="score-result">
                    <span id="modal-score">0</span>/<span id="modal-total">6</span>
                </div>
                <p class="score-text" id="modal-score-text">Vous avez réussi l'activité.</p>
                
                <div class="exercise-summary" id="exercise-summary">
                    <!-- Les éléments seront générés dynamiquement -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="close-modal-btn" class="close-modal-btn">Fermer</button>
            </div>
        </div>
    </div>
    
    <script>
        // =====================================================================
        // INITIALISATION DE L'APPLICATION
        // =====================================================================
        
        // Variables globales SCORM
        let API = null;
        let API_1484_11 = null;
        const scormVersion = "2004";
        let initialized = false;
        let terminated = false;
        let lastError = "";
        let suspendData = "";
        let entryStatus = "ab-initio";
        let sessionStartTime = Date.now();
        let totalTime = 0;
        let lastTimeUpdate = sessionStartTime;
        let timeInterval = null;
        
        // Variables globales de l'application
        const totalExercises = 6;
        let score = 0;
        let answered = new Set();
        let solved = new Set();
        let attempted = new Set();
        let testCompleted = false;
        let badgesUnlocked = 0;
        
        // Réponses correctes (masses molaires en g/mol)
        const correctAnswers = {
            1: 32.042, // CH₃OH (Méthanol)
            2: 46.068, // C₂H₅OH (Éthanol)
            3: 60.094, // C₃H₇OH (Propan-1-ol)
            4: 60.094, // C₃H₇OH (Isopropanol)
            5: 74.12,  // C₄H₉OH (Butan-1-ol)
            6: 88.146  // C₅H₁₁OH (Pentan-1-ol)
        };
        
        // Nombre de tentatives par exercice
        const maxAttempts = 3;
        const attempts = {
            1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0
        };
        
        // Initialisation de l'application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser SCORM
            initSCORM();
            
            // Ajouter les écouteurs d'événements pour les boutons
            setupEventListeners();
            
            // Initialiser les modèles 3D
            loadThreeJS();
            
            // Démarrer le suivi du temps
            startTimeTracking();
            
            // Mettre à jour l'affichage initial
            updateDisplay();
        });
        
        // Configuration des écouteurs d'événements
        function setupEventListeners() {
            // Boutons de vérification des réponses
            for (let i = 1; i <= totalExercises; i++) {
                const checkBtn = document.getElementById(`check${i}`);
                if (checkBtn) {
                    checkBtn.addEventListener('click', () => checkAnswer(i));
                }
                
                const answerInput = document.getElementById(`answer${i}`);
                if (answerInput) {
                    answerInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            checkAnswer(i);
                        }
                    });
                }
            }
            
            // Bouton plein écran
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', toggleFullscreen);
            }
            
            // Bouton de fin d'activité
            const finishBtn = document.getElementById('finishBtn');
            if (finishBtn) {
                finishBtn.addEventListener('click', finishActivity);
            }
            
            // Bouton de fermeture du modal
            const closeModalBtn = document.getElementById('close-modal-btn');
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', () => {
                    document.getElementById('completion-modal').style.display = 'none';
                });
            }
            
            // Événements de détection de plein écran
            document.addEventListener('fullscreenchange', handleFullscreenChange);
            document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
            document.addEventListener('mozfullscreenchange', handleFullscreenChange);
            document.addEventListener('MSFullscreenChange', handleFullscreenChange);
        }
        
        // Vérifier une réponse
        function checkAnswer(exerciseNum) {
            // Récupérer la réponse de l'utilisateur
            const answerInput = document.getElementById(`answer${exerciseNum}`);
            const resultDiv = document.getElementById(`result${exerciseNum}`);
            const hintDiv = document.getElementById(`hint${exerciseNum}`);
            const exerciseCard = document.getElementById(`exercise${exerciseNum}`);
            
            if (!answerInput || !resultDiv || !exerciseCard) return;
            
            // Incrémenter le compteur de tentatives
            attempts[exerciseNum]++;
            
            // Ajouter à l'ensemble des exercices tentés
            attempted.add(exerciseNum);
            
            // Récupérer la valeur de la réponse
            const userAnswer = parseFloat(answerInput.value.replace(',', '.'));
            
            // Vérifier si la réponse est valide
            if (isNaN(userAnswer)) {
                resultDiv.textContent = "⚠️ Veuillez entrer un nombre valide";
                resultDiv.className = "result incorrect show";
                return;
            }
            
            // Comparer avec la réponse correcte (avec une tolérance de 1%)
            const correctAnswer = correctAnswers[exerciseNum];
            const tolerance = Math.abs(correctAnswer) * 0.01;
            const isCorrect = Math.abs(userAnswer - correctAnswer) <= tolerance;
            
            // Afficher le résultat
            if (isCorrect) {
                resultDiv.textContent = "✅ Correct ! Bravo !";
                resultDiv.className = "result correct show";
                hintDiv.style.display = "none";
                
                // Marquer comme résolu si ce n'est pas déjà fait
                if (!solved.has(exerciseNum)) {
                    solved.add(exerciseNum);
                    score++;
                    
                    // Enregistrer l'interaction SCORM
                    recordInteraction(exerciseNum, userAnswer, isCorrect);
                    
                    // Mettre à jour le score
                    updateScore();
                    
                    // Débloquer des badges si nécessaire
                    unlockBadges();
                }
                
                // Appliquer le style résolu
                exerciseCard.classList.add("solved");
                exerciseCard.classList.remove("incorrect");
                
                // Désactiver l'input et le bouton
                answerInput.disabled = true;
                document.getElementById(`check${exerciseNum}`).disabled = true;
            } else {
                resultDiv.textContent = "❌ Incorrect. " + 
                    (attempts[exerciseNum] >= maxAttempts 
                        ? "Nombre maximum de tentatives atteint." 
                        : `Tentatives restantes: ${maxAttempts - attempts[exerciseNum]}`);
                resultDiv.className = "result incorrect show";
                hintDiv.style.display = "block";
                
                // Appliquer le style incorrect
                exerciseCard.classList.add("incorrect");
                
                // Si le nombre maximum de tentatives est atteint
                if (attempts[exerciseNum] >= maxAttempts) {
                    // Désactiver l'input et le bouton
                    answerInput.disabled = true;
                    document.getElementById(`check${exerciseNum}`).disabled = true;
                    
                    // Marquer comme répondu
                    answered.add(exerciseNum);
                    
                    // Enregistrer l'interaction SCORM
                    recordInteraction(exerciseNum, userAnswer, isCorrect);
                }
            }
            
            // Marquer comme répondu si correct
            if (isCorrect) {
                answered.add(exerciseNum);
            }
            
            // Mettre à jour l'état du bouton de fin
            updateFinishButton();
            
            // Sauvegarder l'état
            saveState();
        }
        
        // Débloquer les badges en fonction du score
        function unlockBadges() {
            const badgeThresholds = [1, 3, 5, 6];
            
            // Déterminer combien de badges devraient être débloqués
            let newBadgesCount = 0;
            for (let i = 0; i < badgeThresholds.length; i++) {
                if (score >= badgeThresholds[i]) {
                    newBadgesCount = i + 1;
                }
            }
            
            // Débloquer les nouveaux badges
            for (let i = badgesUnlocked + 1; i <= newBadgesCount; i++) {
                const badge = document.getElementById(`badge${i}`);
                if (badge && !badge.classList.contains('unlocked')) {
                    badge.classList.add('unlocked');
                    
                    // Animation pour attirer l'attention
                    setTimeout(() => {
                        badge.style.animation = 'none';
                        badge.offsetHeight; // Forcer le redessinage
                        badge.style.animation = 'badgeUnlock 0.5s ease-out';
                    }, 100 * (i - badgesUnlocked));
                }
            }
            
            badgesUnlocked = newBadgesCount;
        }
        
        // Mettre à jour le score affiché
        function updateScore() {
            const scoreElement = document.getElementById('score');
            if (scoreElement) {
                scoreElement.textContent = score;
            }
            
            // Mettre à jour le score SCORM
            setValue("cmi.score.raw", score);
            setValue("cmi.score.min", 0);
            setValue("cmi.score.max", totalExercises);
            setValue("cmi.score.scaled", score / totalExercises);
            
            // Sauvegarder l'état
            commitSCORM();
        }
        
        // Mettre à jour l'état du bouton de fin
        function updateFinishButton() {
            const finishBtn = document.getElementById('finishBtn');
            if (finishBtn) {
                finishBtn.disabled = answered.size === 0;
            }
        }
        
        // Mettre à jour l'affichage initial
        function updateDisplay() {
            // Mettre à jour le score
            updateScore();
            
            // Débloquer les badges
            unlockBadges();
            
            // Mettre à jour l'état du bouton de fin
            updateFinishButton();
            
            // Restaurer l'état des exercices
            for (const exerciseNum of solved) {
                const exerciseCard = document.getElementById(`exercise${exerciseNum}`);
                const answerInput = document.getElementById(`answer${exerciseNum}`);
                const checkBtn = document.getElementById(`check${exerciseNum}`);
                const resultDiv = document.getElementById(`result${exerciseNum}`);
                
                if (exerciseCard && answerInput && checkBtn && resultDiv) {
                    exerciseCard.classList.add("solved");
                    answerInput.disabled = true;
                    checkBtn.disabled = true;
                    resultDiv.textContent = "✅ Correct ! Bravo !";
                    resultDiv.className = "result correct show";
                }
            }
            
            // Si le test est déjà complété, désactiver tous les inputs et boutons
            if (testCompleted) {
                document.querySelectorAll('input, .check-btn').forEach(el => {
                    el.disabled = true;
                });
                
                // Désactiver le bouton de fin
                const finishBtn = document.getElementById('finishBtn');
                if (finishBtn) {
                    finishBtn.disabled = true;
                }
            }
        }
        
        // Terminer l'activité
        function finishActivity() {
            // Vérifier si au moins une question est répondue
            if (answered.size === 0) {
                // Afficher un message d'erreur
                const validationMessage = document.getElementById('validation-message');
                validationMessage.style.display = 'block';
                validationMessage.style.backgroundColor = 'rgba(220, 53, 69, 0.2)';
                validationMessage.style.border = '1px solid rgba(220, 53, 69, 0.3)';
                validationMessage.style.color = '#e74c3c';
                validationMessage.textContent = "Vous devez répondre à au moins une question avant de terminer l'activité.";
                
                // Masquer le message après 5 secondes
                setTimeout(() => {
                    validationMessage.style.display = 'none';
                }, 5000);
                return;
            }
            
            // Marquer le test comme terminé
            testCompleted = true;
            
            // SCORM: Marquer comme terminé
            setValue("cmi.completion_status", "completed");
            setValue("cmi.success_status", (score / totalExercises >= 0.7) ? "passed" : "failed");
            setValue("cmi.exit", "normal");
            
            // SCORM: Mettre à jour le temps de session
            updateSessionTime();
            
            // SCORM: Sauvegarder l'état final
            saveState();
            
            // SCORM: Effectuer un commit final
            commitSCORM();
            
            // Désactiver tous les inputs et boutons
            document.querySelectorAll('input, .check-btn, .finish-btn').forEach(el => {
                el.disabled = true;
            });
            
            // Afficher le modal de fin d'activité
            showCompletionModal();
        }
        
        // Afficher le modal de fin d'activité
        function showCompletionModal() {
            // Mettre à jour les données du modal
            document.getElementById('modal-score').textContent = score;
            document.getElementById('modal-total').textContent = totalExercises;
            
            // Calculer le pourcentage
            const percentage = Math.round((score / totalExercises) * 100);
            document.getElementById('modal-badge').textContent = percentage + '%';
            
            // Définir si l'étudiant a réussi ou échoué (seuil à 70%)
            const isPassed = percentage >= 70;
            if (!isPassed) {
                document.getElementById('modal-badge').classList.add('failed');
            }
            
            // Mettre à jour le texte du score
            const scoreText = document.getElementById('modal-score-text');
            if (isPassed) {
                scoreText.textContent = "Félicitations ! Vous avez réussi l'activité.";
            } else {
                scoreText.textContent = "Vous n'avez pas atteint le score minimum requis de 70%.";
            }
            
            // Générer le résumé des exercices
            const summaryContainer = document.getElementById('exercise-summary');
            summaryContainer.innerHTML = '';
            
            for (let i = 1; i <= totalExercises; i++) {
                const exerciseItem = document.createElement('div');
                exerciseItem.className = 'exercise-item';
                
                const exerciseTitle = document.createElement('div');
                exerciseTitle.textContent = `Exercice ${i}`;
                
                const exerciseStatus = document.createElement('div');
                exerciseStatus.className = 'exercise-status';
                
                if (solved.has(i)) {
                    exerciseStatus.textContent = "Réussi";
                    exerciseStatus.classList.add('status-completed');
                } else if (answered.has(i)) {
                    exerciseStatus.textContent = "Échoué";
                    exerciseStatus.classList.add('status-incomplete');
                } else {
                    exerciseStatus.textContent = "Non tenté";
                    exerciseStatus.classList.add('status-incomplete');
                }
                
                exerciseItem.appendChild(exerciseTitle);
                exerciseItem.appendChild(exerciseStatus);
                summaryContainer.appendChild(exerciseItem);
            }
            
            // Afficher le modal
            const modal = document.getElementById('completion-modal');
            modal.style.display = 'flex';
        }
        
        // =====================================================================
        // GESTION DU PLEIN ÉCRAN
        // =====================================================================
        
        // Basculer le mode plein écran
        function toggleFullscreen() {
            if (!document.fullscreenElement && 
                !document.mozFullScreenElement && 
                !document.webkitFullscreenElement && 
                !document.msFullscreenElement) {
                // Passer en mode plein écran
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                } else if (document.documentElement.msRequestFullscreen) {
                    document.documentElement.msRequestFullscreen();
                } else if (document.documentElement.mozRequestFullScreen) {
                    document.documentElement.mozRequestFullScreen();
                } else if (document.documentElement.webkitRequestFullscreen) {
                    document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
                }
                document.body.classList.add('fullscreen-container');
            } else {
                // Quitter le mode plein écran
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                }
                document.body.classList.remove('fullscreen-container');
            }
        }
        
        // Gérer les changements de mode plein écran
        function handleFullscreenChange() {
            const iconElement = document.querySelector('.fullscreen-icon');
            if (document.fullscreenElement || 
                document.webkitFullscreenElement || 
                document.mozFullScreenElement || 
                document.msFullscreenElement) {
                // En mode plein écran
                if (iconElement) iconElement.textContent = '⛝';
                document.body.classList.add('fullscreen-container');
            } else {
                // Hors mode plein écran
                if (iconElement) iconElement.textContent = '⛶';
                document.body.classList.remove('fullscreen-container');
            }
        }
        
        // =====================================================================
        // GESTION DES MODÈLES 3D
        // =====================================================================
        
        // Variables globales pour THREE.js
        let scenes = {};       // Stocke les scènes pour chaque modèle
        let cameras = {};      // Stocke les caméras
        let renderers = {};    // Stocke les renderers
        let models = {};       // Stocke les objets 3D
        let animations = {};   // Stocke les animations
        let animationStatus = {}; // État des animations (pause/play)
        let zoomLevels = {};   // Niveaux de zoom actuels
        
        // Fonction pour charger Three.js
        function loadThreeJS() {
            if (typeof THREE === 'undefined') {
                // Créer l'élément de script pour Three.js
                const threeScript = document.createElement('script');
                threeScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js';
                
                // Ajouter le script au document
                document.head.appendChild(threeScript);
                
                // Vérifier périodiquement si Three.js est chargé
                const checkThreeLoaded = setInterval(function() {
                    if (typeof THREE !== 'undefined') {
                        clearInterval(checkThreeLoaded);
                        console.log('Three.js chargé avec succès');
                        initModels3D();
                    }
                }, 200);
            } else {
                // Three.js est déjà chargé
                initModels3D();
            }
        }
        
        // Initialiser tous les modèles 3D
        function initModels3D() {
            // Initialiser les modèles d'alcools
            initMethanolModel();
            initEthanolModel();
            initPropanolModel();
            initIsopropanolModel();
            initButanolModel();
            initPentanolModel();
            
            // Générer les étoiles pour l'arrière-plan
            generateStars();
            
            // Démarrer les animations
            animateAllModels();
            
            // Gestion du redimensionnement de la fenêtre
            window.addEventListener('resize', resizeModelViewers);
        }
        
        // Modèle du méthanol (CH₃OH)
        function initMethanolModel() {
            const id = 'methanol';
            const container = document.getElementById(id + '-model');
            if (!container) return;
            
            const { scene, camera, renderer } = initBaseScene(id + '-model');
            
            // Créer un groupe pour la molécule
            const molecule = new THREE.Group();
            
            // Créer le carbone central
            const carbon = createAtom(0x444444, 0.4); // Carbone en gris
            molecule.add(carbon);
            
            // Positions des hydrogènes méthyle
            const methylHPositions = [
                new THREE.Vector3(0.5, 0.7, 0.3),
                new THREE.Vector3(-0.5, 0.7, 0.3),
                new THREE.Vector3(0, 0.7, -0.6)
            ];
            
            // Créer les hydrogènes méthyle
            methylHPositions.forEach(position => {
                const hydrogen = createAtom(0xffffff, 0.25); // Hydrogène en blanc
                hydrogen.position.copy(position);
                molecule.add(hydrogen);
                
                const bond = createBond(carbon.position, hydrogen.position, 0xaaaaaa);
                molecule.add(bond);
            });
            
            // Créer l'oxygène
            const oxygen = createAtom(0xff0000, 0.35); // Oxygène en rouge
            oxygen.position.set(0, -0.8, 0);
            molecule.add(oxygen);
            
            // Liaison C-O
            const coBond = createBond(carbon.position, oxygen.position, 0xaaaaaa);
            molecule.add(coBond);
            
            // Créer l'hydrogène hydroxyle
            const hydroxylH = createAtom(0xffffff, 0.25); // Hydrogène en blanc
            hydroxylH.position.set(0.6, -1.3, 0);
            molecule.add(hydroxylH);
            
            // Liaison O-H
            const ohBond = createBond(oxygen.position, hydroxylH.position, 0xaaaaaa);
            molecule.add(ohBond);
            
            // Ajuster la position de la caméra
            camera.position.z = 5;
            
            // Ajouter la molécule à la scène
            scene.add(molecule);
            
            // Stocker les références
            scenes[id] = scene;
            cameras[id] = camera;
            renderers[id] = renderer;
            models[id] = molecule;
            animationStatus[id] = 'playing';
            
            // Rendu initial
            renderer.render(scene, camera);
        }
        
        // Modèle de l'éthanol (C₂H₅OH)
        function initEthanolModel() {
            const id = 'ethanol';
            const container = document.getElementById(id + '-model');
            if (!container) return;
            
            const { scene, camera, renderer } = initBaseScene(id + '-model');
            
            // Créer un groupe pour la molécule
            const molecule = new THREE.Group();
            
            // Créer les carbones
            const carbon1 = createAtom(0x444444, 0.4); // Carbone en gris
            carbon1.position.set(-0.8, 0, 0);
            molecule.add(carbon1);
            
            const carbon2 = createAtom(0x444444, 0.4); // Carbone en gris
            carbon2.position.set(0.8, 0, 0);
            molecule.add(carbon2);
            
            // Liaison C-C
            const ccBond = createBond(carbon1.position, carbon2.position, 0xaaaaaa);
            molecule.add(ccBond);
            
            // Hydrogènes pour C1
            const h1Positions = [
                new THREE.Vector3(-1.3, 0.8, 0.3),
                new THREE.Vector3(-1.3, -0.4, 0.7),
                new THREE.Vector3(-1.3, -0.4, -0.7)
            ];
            
            h1Positions.forEach(position => {
                const hydrogen = createAtom(0xffffff, 0.25); // Hydrogène en blanc
                hydrogen.position.copy(position);
                molecule.add(hydrogen);
                
                const bond = createBond(carbon1.position, hydrogen.position, 0xaaaaaa);
                molecule.add(bond);
            });
            
            // Hydrogènes pour C2
            const h2Positions = [
                new THREE.Vector3(1.3, 0.8, 0.3),
                new THREE.Vector3(1.3, -0.4, -0.7)
            ];
            
            h2Positions.forEach(position => {
                const hydrogen = createAtom(0xffffff, 0.25); // Hydrogène en blanc
                hydrogen.position.copy(position);
                molecule.add(hydrogen);
                
                const bond = createBond(carbon2.position, hydrogen.position, 0xaaaaaa);
                molecule.add(bond);
            });
            
            // Créer l'oxygène
            const oxygen = createAtom(0xff0000, 0.35); // Oxygène en rouge
            oxygen.position.set(1.3, -0.4, 0.7);
            molecule.add(oxygen);
            
            // Liaison C-O
            const coBond = createBond(carbon2.position, oxygen.position, 0xaaaaaa);
            molecule.add(coBond);
            
            // Créer l'hydrogène hydroxyle
            const hydroxylH = createAtom(0xffffff, 0.25); // Hydrogène en blanc
            hydroxylH.position.set(2.0, -0.8, 0.7);
            molecule.add(hydroxylH);
            
            // Liaison O-H
            const ohBond = createBond(oxygen.position, hydroxylH.position, 0xaaaaaa);
            molecule.add(ohBond);
            
            // Ajuster la position de la caméra
            camera.position.z = 5;
            
            // Ajouter la molécule à la scène
            scene.add(molecule);
            
            // Stocker les références
            scenes[id] = scene;
            cameras[id] = camera;
            renderers[id] = renderer;
            models[id] = molecule;
            animationStatus[id] = 'playing';
            
            // Rendu initial
            renderer.render(scene, camera);
        }
        
        // Modèle du propan-1-ol (C₃H₇OH)
        function initPropanolModel() {
            const id = 'propanol';
            const container = document.getElementById(id + '-model');
            if (!container) return;
            
            const { scene, camera, renderer } = initBaseScene(id + '-model');
            
            // Créer un groupe pour la molécule
            const molecule = new THREE.Group();
            
            // Créer les carbones avec un léger zigzag
            const carbon1 = createAtom(0x444444, 0.4); // Carbone en gris
            carbon1.position.set(-1.6, 0, 0);
            molecule.add(carbon1);
            
            const carbon2 = createAtom(0x444444, 0.4); // Carbone en gris
            carbon2.position.set(0, 0.1, 0);
            molecule.add(carbon2);
            
            const carbon3 = createAtom(0x444444, 0.4); // Carbone en gris
            carbon3.position.set(1.6, -0.1, 0);
            molecule.add(carbon3);
            
            // Liaisons C-C
            const cc1Bond = createBond(carbon1.position, carbon2.position, 0xaaaaaa);
            molecule.add(cc1Bond);
            
            const cc2Bond = createBond(carbon2.position, carbon3.position, 0xaaaaaa);
            molecule.add(cc2Bond);
            
            // Hydrogènes pour C1 (extrémité)
            const h1Positions = [
                new THREE.Vector3(-2.1, 0.8, 0.3),
                new THREE.Vector3(-2.1, -0.4, 0.7),
                new THREE.Vector3(-2.1, -0.4, -0.7)
            ];
            
            h1Positions.forEach(position => {
                const hydrogen = createAtom(0xffffff, 0.25); // Hydrogène en blanc
                hydrogen.position.copy(position);
                molecule.add(hydrogen);
                
                const bond = createBond(carbon1.position, hydrogen.position, 0xaaaaaa);
                molecule.add(bond);
            });
            
            // Hydrogènes pour C2 (milieu)
            const h2Positions = [
                new THREE.Vector3(0, 0.9, 0.5),
                new THREE.Vector3(0, 0.1, -0.9)
            ];
            
            h2Positions.forEach(position => {
                const hydrogen = createAtom(0xffffff, 0.25); // Hydrogène en blanc
                hydrogen.position.copy(position);
                molecule.add(hydrogen);
                
                const bond = createBond(carbon2.position, hydrogen.position, 0xaaaaaa);
                molecule.add(bond);
            });
            
            // Hydrogènes pour C3 (dernier carbone)
            const h3Positions = [
                new THREE.Vector3(2.1, 0.7, 0.3),
                new THREE.Vector3(2.1, -0.1, -0.8)
            ];
            
            h3Positions.forEach(position => {
                const hydrogen = createAtom(0xffffff, 0.25); // Hydrogène en blanc
                hydrogen.position.copy(position);
                molecule.add(hydrogen);
                
                const bond = createBond(carbon3.position, hydrogen.position, 0xaaaaaa);
                molecule.add(bond);
            });
            
            // Créer l'oxygène
            const oxygen = createAtom(0xff0000, 0.35); // Oxygène en rouge
            oxygen.position.set(1.6, -1.1, 0.7);
            molecule.add(oxygen);
            
            // Liaison C-O
            const coBond = createBond(carbon3.position, oxygen.position, 0xaaaaaa);
            molecule.add(coBond);
            
            // Créer l'hydrogène hydroxyle
            const hydroxylH = createAtom(0xffffff, 0.25); // Hydrogène en blanc
            hydroxylH.position.set(2.3, -1.5, 0.7);
            molecule.add(hydroxylH);
            
            // Liaison O-H
            const ohBond = createBond(oxygen.position, hydroxylH.position, 0xaaaaaa);
            molecule.add(ohBond);
            
            // Ajuster la position de la caméra
            camera.position.z = 6;
            
            // Ajouter la molécule à la scène
            scene.add(molecule);
            
            // Stocker les références
            scenes[id] = scene;
            cameras[id] = camera;
            renderers[id] = renderer;
            models[id] = molecule;
            animationStatus[id] = 'playing';
            
            // Rendu initial
            renderer.render(scene, camera);
        }
        
        // Modèle de l'isopropanol (C₃H₇OH)
        function initIsopropanolModel() {
            const id = 'isopropanol';
            const container = document.getElementById(id + '-model');
            if (!container) return;
            
            const { scene, camera, renderer } = initBaseScene(id + '-model');
            
            // Créer un groupe pour la molécule
            const molecule = new THREE.Group();
            
            // Créer les carbones (structure en Y)
            const carbon1 = createAtom(0x444444, 0.4); // Carbone en gris (extrémité gauche)
            carbon1.position.set(-1.2, -0.8, 0);
            molecule.add(carbon1);
            
            const carbon2 = createAtom(0x444444, 0.4); // Carbone en gris (central)
            carbon2.position.set(0, 0, 0);
            molecule.add(carbon2);
            
            const carbon3 = createAtom(0x444444, 0.4); // Carbone en gris (extrémité droite)
            carbon3.position.set(1.2, -0.8, 0);
            molecule.add(carbon3);
            
            // Liaisons C-C
            const cc1Bond = createBond(carbon1.position, carbon2.position, 0xaaaaaa);
            molecule.add(cc1Bond);
            
            const cc2Bond = createBond(carbon2.position, carbon3.position, 0xaaaaaa);
            molecule.add(cc2Bond);
            
            // Hydrogènes pour C1 (extrémité gauche)
            const h1Positions = [
                new THREE.Vector3(-1.7, -0.8, 0.9),
                new THREE.Vector3(-1.7, -0.8, -0.9),
                new THREE.Vector3(-1.7, -1.6, 0)
            ];
            
            h1Positions.forEach(position => {
                const hydrogen = createAtom(0xffffff, 0.25); // Hydrogène en blanc
                hydrogen.position.copy(position);
                molecule.add(hydrogen);
                
                const bond = createBond(carbon1.position, hydrogen.position, 0xaaaaaa);
                molecule.add(bond);
            });
            
            // Hydrogènes pour C3 (extrémité droite)
            const h3Positions = [
                new THREE.Vector3(1.7, -0.8, 0.9),
                new THREE.Vector3(1.7, -0.8, -0.9),
                new THREE.Vector3(1.7, -1.6, 0)
            ];
            
            h3Positions.forEach(position => {
                const hydrogen = createAtom(0xffffff, 0.25); // Hydrogène en blanc
                hydrogen.position.copy(position);
                molecule.add(hydrogen);
                
                const bond = createBond(carbon3.position, hydrogen.position, 0xaaaaaa);
                molecule.add(bond);
            });
            
            // Hydrogène pour C2 (carbone central)
            const h2 = createAtom(0xffffff, 0.25); // Hydrogène en blanc
            h2.position.set(0, -0.6, -0.9);
            molecule.add(h2);
            
            const c2h2Bond = createBond(carbon2.position, h2.position, 0xaaaaaa);
            molecule.add(c2h2Bond);
            
            // Créer l'oxygène (attaché au carbone central)
            const oxygen = createAtom(0xff0000, 0.35); // Oxygène en rouge
            oxygen.position.set(0, 1.1, 0);
            molecule.add(oxygen);
            
            // Liaison C-O
            const coBond = createBond(carbon2.position, oxygen.position, 0xaaaaaa);
            molecule.add(coBond);
            
            // Créer l'hydrogène hydroxyle
            const hydroxylH = createAtom(0xffffff, 0.25); // Hydrogène en blanc
            hydroxylH.position.set(0.8, 1.6, 0);
            molecule.add(hydroxylH);
            
            // Liaison O-H
            const ohBond = createBond(oxygen.position, hydroxylH.position, 0xaaaaaa);
            molecule.add(ohBond);
            
            // Ajuster la position de la caméra
            camera.position.z = 6;
            
            // Ajouter la molécule à la scène
            scene.add(molecule);
            
            // Stocker les références
            scenes[id] = scene;
            cameras[id] = camera;
            renderers[id] = renderer;
            models[id] = molecule;
            animationStatus[id] = 'playing';
            
            // Rendu initial
            renderer.render(scene, camera);
        }
        
        // Modèle du butan-1-ol (C₄H₉OH)
        function initButanolModel() {
            const id = 'butanol';
            const container = document.getElementById(id + '-model');
            if (!container) return;
            
            const { scene, camera, renderer } = initBaseScene(id + '-model');
            
            // Créer un groupe pour la molécule
            const molecule = new THREE.Group();
            
            // Créer les carbones avec un léger zigzag
            const carbon1 = createAtom(0x444444, 0.4); // Carbone en gris
            carbon1.position.set(-2.4, 0, 0);
            molecule.add(carbon1);
            
            const carbon2 = createAtom(0x444444, 0.4); // Carbone en gris
            carbon2.position.set(-0.8, 0.1, 0);
            molecule.add(carbon2);
            
            const carbon3 = createAtom(0x444444, 0.4); // Carbone en gris
            carbon3.position.set(0.8, -0.1, 0);
            molecule.add(carbon3);
            
            const carbon4 = createAtom(0x444444, 0.4); // Carbone en gris
            carbon4.position.set(2.4, 0, 0);
            molecule.add(carbon4);
            
            // Liaisons C-C
            const cc1Bond = createBond(carbon1.position, carbon2.position, 0xaaaaaa);
            molecule.add(cc1Bond);
            
            const cc2Bond = createBond(carbon2.position, carbon3.position, 0xaaaaaa);
            molecule.add(cc2Bond);
            
            const cc3Bond = createBond(carbon3.position, carbon4.position, 0xaaaaaa);
            molecule.add(cc3Bond);
            
            // Hydrogènes pour C1 (extrémité)
            const h1Positions = [
                new THREE.Vector3(-2.9, 0.8, 0.3),
                new THREE.Vector3(-2.9, -0.4, 0.7),
                new THREE.Vector3(-2.9, -0.4, -0.7)
            ];
            
            h1Positions.forEach(position => {
                const hydrogen = createAtom(0xffffff, 0.25); // Hydrogène en blanc
                hydrogen.position.copy(position);
                molecule.add(hydrogen);
                
                const bond = createBond(carbon1.position, hydrogen.position, 0xaaaaaa);
                molecule.add(bond);
            });
            
            // Hydrogènes pour C2
            const h2Positions = [
                new THREE.Vector3(-0.8, 0.9, 0.5),
                new THREE.Vector3(-0.8, 0.1, -0.9)
            ];
            
            h2Positions.forEach(position => {
                const hydrogen = createAtom(0xffffff, 0.25); // Hydrogène en blanc
                hydrogen.position.copy(position);
                molecule.add(hydrogen);
                
                const bond = createBond(carbon2.position, hydrogen.position, 0xaaaaaa);
                molecule.add(bond);
            });
            
            // Hydrogènes pour C3
            const h3Positions = [
                new THREE.Vector3(0.8, 0.7, 0.5),
                new THREE.Vector3(0.8, -0.9, -0.5)
            ];
            
            h3Positions.forEach(position => {
                const hydrogen = createAtom(0xffffff, 0.25); // Hydrogène en blanc
                hydrogen.position.copy(position);
                molecule.add(hydrogen);
                
                const bond = createBond(carbon3.position, hydrogen.position, 0xaaaaaa);
                molecule.add(bond);
            });
            
            // Hydrogènes pour C4 (dernier carbone)
            const h4Positions = [
                new THREE.Vector3(2.9, 0.8, 0.3),
                new THREE.Vector3(2.9, 0, -0.8)
            ];
            
            h4Positions.forEach(position => {
                const hydrogen = createAtom(0xffffff, 0.25); // Hydrogène en blanc
                hydrogen.position.copy(position);
                molecule.add(hydrogen);
                
                const bond = createBond(carbon4.position, hydrogen.position, 0xaaaaaa);
                molecule.add(bond);
            });
            
            // Créer l'oxygène
            const oxygen = createAtom(0xff0000, 0.35); // Oxygène en rouge
            oxygen.position.set(2.4, -0.8, 0.7);
            molecule.add(oxygen);
            
            // Liaison C-O
            const coBond = createBond(carbon4.position, oxygen.position, 0xaaaaaa);
            molecule.add(coBond);
            
            // Créer l'hydrogène hydroxyle
            const hydroxylH = createAtom(0xffffff, 0.25); // Hydrogène en blanc
            hydroxylH.position.set(3.1, -1.2, 0.7);
            molecule.add(hydroxylH);
            
            // Liaison O-H
            const ohBond = createBond(oxygen.position, hydroxylH.position, 0xaaaaaa);
            molecule.add(ohBond);
            
            // Ajuster la position de la caméra
            camera.position.z = 7;
            
            // Ajouter la molécule à la scène
            scene.add(molecule);
            
            // Stocker les références
            scenes[id] = scene;
            cameras[id] = camera;
            renderers[id] = renderer;
            models[id] = molecule;
            animationStatus[id] = 'playing';
            
            // Rendu initial
            renderer.render(scene, camera);
        }
        
        // Modèle du pentan-1-ol (C₅H₁₁OH)
        function initPentanolModel() {
            const id = 'pentanol';
            const container = document.getElementById(id + '-model');
            if (!container) return;
            
            const { scene, camera, renderer } = initBaseScene(id + '-model');
            
            // Créer un groupe pour la molécule
            const molecule = new THREE.Group();
            
            // Créer les carbones avec un zigzag
            const carbon1 = createAtom(0x444444, 0.4); // Carbone en gris
            carbon1.position.set(-3.2, 0, 0);
            molecule.add(carbon1);
            
            const carbon2 = createAtom(0x444444, 0.4); // Carbone en gris
            carbon2.position.set(-1.6, 0.1, 0);
            molecule.add(carbon2);
            
            const carbon3 = createAtom(0x444444, 0.4); // Carbone en gris
            carbon3.position.set(0, -0.1, 0);
            molecule.add(carbon3);
            
            const carbon4 = createAtom(0x444444, 0.4); // Carbone en gris
            carbon4.position.set(1.6, 0.1, 0);
            molecule.add(carbon4);
            
            const carbon5 = createAtom(0x444444, 0.4); // Carbone en gris
            carbon5.position.set(3.2, -0.1, 0);
            molecule.add(carbon5);
            
            // Liaisons C-C
            const cc1Bond = createBond(carbon1.position, carbon2.position, 0xaaaaaa);
            molecule.add(cc1Bond);
            
            const cc2Bond = createBond(carbon2.position, carbon3.position, 0xaaaaaa);
            molecule.add(cc2Bond);
            
            const cc3Bond = createBond(carbon3.position, carbon4.position, 0xaaaaaa);
            molecule.add(cc3Bond);
            
            const cc4Bond = createBond(carbon4.position, carbon5.position, 0xaaaaaa);
            molecule.add(cc4Bond);
            
            // Hydrogènes pour C1 (extrémité)
            const h1Positions = [
                new THREE.Vector3(-3.7, 0.8, 0.3),
                new THREE.Vector3(-3.7, -0.4, 0.7),
                new THREE.Vector3(-3.7, -0.4, -0.7)
            ];
            
            h1Positions.forEach(position => {
                const hydrogen = createAtom(0xffffff, 0.25); // Hydrogène en blanc
                hydrogen.position.copy(position);
                molecule.add(hydrogen);
                
                const bond = createBond(carbon1.position, hydrogen.position, 0xaaaaaa);
                molecule.add(bond);
            });
            
            // Hydrogènes pour les carbones intermédiaires
            const middlesCarbons = [carbon2, carbon3, carbon4];
            const hPositionSets = [
                [new THREE.Vector3(-1.6, 0.9, 0.5), new THREE.Vector3(-1.6, 0.1, -0.9)],
                [new THREE.Vector3(0, 0.7, 0.5), new THREE.Vector3(0, -0.9, -0.5)],
                [new THREE.Vector3(1.6, 0.9, 0.5), new THREE.Vector3(1.6, 0.1, -0.9)]
            ];
            
            for (let i = 0; i < middlesCarbons.length; i++) {
                hPositionSets[i].forEach(position => {
                    const hydrogen = createAtom(0xffffff, 0.25); // Hydrogène en blanc
                    hydrogen.position.copy(position);
                    molecule.add(hydrogen);
                    
                    const bond = createBond(middlesCarbons[i].position, hydrogen.position, 0xaaaaaa);
                    molecule.add(bond);
                });
            }
            
            // Hydrogènes pour C5 (dernier carbone)
            const h5Positions = [
                new THREE.Vector3(3.7, 0.7, 0.3),
                new THREE.Vector3(3.7, -0.1, -0.8)
            ];
            
            h5Positions.forEach(position => {
                const hydrogen = createAtom(0xffffff, 0.25); // Hydrogène en blanc
                hydrogen.position.copy(position);
                molecule.add(hydrogen);
                
                const bond = createBond(carbon5.position, hydrogen.position, 0xaaaaaa);
                molecule.add(bond);
            });
            
            // Créer l'oxygène
            const oxygen = createAtom(0xff0000, 0.35); // Oxygène en rouge
            oxygen.position.set(3.2, -0.9, 0.7);
            molecule.add(oxygen);
            
            // Liaison C-O
            const coBond = createBond(carbon5.position, oxygen.position, 0xaaaaaa);
            molecule.add(coBond);
            
            // Créer l'hydrogène hydroxyle
            const hydroxylH = createAtom(0xffffff, 0.25); // Hydrogène en blanc
            hydroxylH.position.set(3.9, -1.3, 0.7);
            molecule.add(hydroxylH);
            
            // Liaison O-H
            const ohBond = createBond(oxygen.position, hydroxylH.position, 0xaaaaaa);
            molecule.add(ohBond);
            
            // Ajuster la position de la caméra
            camera.position.z = 8;
            
            // Ajouter la molécule à la scène
            scene.add(molecule);
            
            // Stocker les références
            scenes[id] = scene;
            cameras[id] = camera;
            renderers[id] = renderer;
            models[id] = molecule;
            animationStatus[id] = 'playing';
            
            // Rendu initial
            renderer.render(scene, camera);
        }
        
        // Fonction pour créer un atome (sphère)
        function createAtom(color, radius, detail = 16) {
            const geometry = new THREE.SphereGeometry(radius, detail, detail);
            const material = new THREE.MeshPhongMaterial({ 
                color: color, 
                shininess: 80,
                specular: 0x222222
            });
            return new THREE.Mesh(geometry, material);
        }
        
        // Fonction pour créer une liaison (cylindre)
        function createBond(startPosition, endPosition, color, radius = 0.1) {
            const direction = new THREE.Vector3().subVectors(endPosition, startPosition);
            const midpoint = new THREE.Vector3().addVectors(startPosition, endPosition).multiplyScalar(0.5);
            const length = direction.length();
            
            const geometry = new THREE.CylinderGeometry(radius, radius, length, 12, 1);
            const material = new THREE.MeshPhongMaterial({ color: color });
            
            const cylinder = new THREE.Mesh(geometry, material);
            
            // Positionner et orienter le cylindre
            cylinder.position.copy(midpoint);
            cylinder.lookAt(endPosition);
            cylinder.rotateX(Math.PI / 2);
            
            return cylinder;
        }
        
        // Initialiser une scène 3D de base
        function initBaseScene(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return null;
            
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            // Créer la scène
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0c0e1a);
            
            // Créer la caméra
            const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
            camera.position.z = 5;
            
            // Créer le renderer
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(width, height);
            renderer.setPixelRatio(window.devicePixelRatio);
            
            // Vider le container et ajouter le renderer
            // Ne pas supprimer les étoiles ou les contrôles
            const stars = container.querySelector('.stars');
            const controls = container.querySelector('.model-controls');
            const zoomControls = container.querySelector('.zoom-controls');
            
            container.innerHTML = '';
            container.appendChild(renderer.domElement);
            
            // Remettre les éléments existants
            if (stars) container.appendChild(stars);
            if (controls) container.appendChild(controls);
            if (zoomControls) container.appendChild(zoomControls);
            
            // Ajouter l'éclairage
            const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
            scene.add(ambientLight);
            
            const light1 = new THREE.DirectionalLight(0xffffff, 1);
            light1.position.set(5, 3, 5);
            scene.add(light1);
            
            const light2 = new THREE.DirectionalLight(0xccccff, 0.2);
            light2.position.set(-5, -3, -5);
            scene.add(light2);
            
            return { scene, camera, renderer };
        }
        
        // Animer tous les modèles
        function animateAllModels() {
            requestAnimationFrame(animateAllModels);
            
            Object.keys(models).forEach(key => {
                if (animationStatus[key] !== 'paused' && models[key] && scenes[key] && cameras[key] && renderers[key]) {
                    models[key].rotation.y += 0.005;
                    renderers[key].render(scenes[key], cameras[key]);
                }
            });
        }
        
        // Contrôler la rotation d'un modèle spécifique
        function rotateModel(modelId, action) {
            if (!models[modelId]) return;
            
            if (action === 'reset') {
                // Réinitialiser la position
                models[modelId].rotation.x = 0;
                models[modelId].rotation.y = 0;
                models[modelId].rotation.z = 0;
                
                renderers[modelId].render(scenes[modelId], cameras[modelId]);
            } else if (action === 'pause') {
                // Mettre en pause l'animation
                animationStatus[modelId] = 'paused';
            } else if (action === 'play') {
                // Reprendre l'animation
                animationStatus[modelId] = 'playing';
            }
        }
        
        // Zoomer sur un modèle spécifique
        function zoomModel(modelId, action) {
            if (!cameras[modelId]) return;
            
            // Initialiser le niveau de zoom si non défini
            if (zoomLevels[modelId] === undefined) {
                zoomLevels[modelId] = 1;
            }
            
            if (action === 'in') {
                // Zoom in (se rapprocher)
                zoomLevels[modelId] = Math.min(zoomLevels[modelId] + 0.2, 2);
                cameras[modelId].position.z = calculateBaseZoom(modelId) / zoomLevels[modelId];
            } else if (action === 'out') {
                // Zoom out (s'éloigner)
                zoomLevels[modelId] = Math.max(zoomLevels[modelId] - 0.2, 0.5);
                cameras[modelId].position.z = calculateBaseZoom(modelId) / zoomLevels[modelId];
            }
            
            cameras[modelId].updateProjectionMatrix();
            renderers[modelId].render(scenes[modelId], cameras[modelId]);
        }
        
        // Calcule le zoom de base en fonction de la taille de la molécule
        function calculateBaseZoom(modelId) {
            switch(modelId) {
                case 'methanol': return 5;
                case 'ethanol': return 5;
                case 'propanol': 
                case 'isopropanol': return 6;
                case 'butanol': return 7;
                case 'pentanol': return 8;
                default: return 5;
            }
        }
        
        // Redimensionner tous les renderers lors du redimensionnement de la fenêtre
        function resizeModelViewers() {
            Object.keys(renderers).forEach(key => {
                const container = document.getElementById(key + '-model');
                if (container && renderers[key]) {
                    const width = container.clientWidth;
                    const height = container.clientHeight;
                    
                    renderers[key].setSize(width, height);
                    cameras[key].aspect = width / height;
                    cameras[key].updateProjectionMatrix();
                    
                    renderers[key].render(scenes[key], cameras[key]);
                }
            });
        }
        
        // Générer des étoiles aléatoires pour l'arrière-plan
        function generateStars() {
            const starContainers = document.querySelectorAll('.stars');
            
            starContainers.forEach(container => {
                // Générer entre 50 et 100 étoiles
                const starCount = Math.floor(Math.random() * 50) + 50;
                
                for (let i = 0; i < starCount; i++) {
                    const star = document.createElement('div');
                    star.classList.add('star');
                    
                    // Taille aléatoire entre 1 et 3 pixels
                    const size = Math.random() * 2 + 1;
                    star.style.width = size + 'px';
                    star.style.height = size + 'px';
                    
                    // Position aléatoire
                    const posX = Math.random() * 100;
                    const posY = Math.random() * 100;
                    star.style.left = posX + '%';
                    star.style.top = posY + '%';
                    
                    // Animation aléatoire
                    star.style.animationDelay = Math.random() * 3 + 's';
                    star.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    
                    container.appendChild(star);
                }
            });
        }
        
        // =====================================================================
        // GESTION SCORM
        // =====================================================================
        
        // Initialisation SCORM
        function initSCORM() {
            if (initialized) return true;
            
            // Trouver l'API SCORM 2004
            API_1484_11 = findAPI(window);
            
            if (!API_1484_11) {
                console.log("SCORM API non trouvée, exécution en mode autonome");
                return false;
            }
            
            // Initialiser la communication
            let result = API_1484_11.Initialize("");
            
            if (result === "true" || result === true) {
                console.log("SCORM API initialisée avec succès");
                initialized = true;
                
                // Récupérer l'état précédent si disponible
                entryStatus = getValue("cmi.entry");
                suspendData = getValue("cmi.suspend_data");
                
                // Récupérer les données sauvegardées si elles existent
                if (suspendData) {
                    try {
                        restoreState(suspendData);
                    } catch (e) {
                        console.error("Erreur lors de la restauration des données:", e);
                    }
                }
                
                return true;
            } else {
                console.log("Échec de l'initialisation SCORM, exécution en mode autonome");
                getLastError();
                return false;
            }
        }
        
        // Trouver l'API SCORM
        function findAPI(win) {
            if (win.API_1484_11) return win.API_1484_11;
            
            let findAPITries = 0;
            while (win.parent && win.parent != win && findAPITries < 10) {
                findAPITries++;
                win = win.parent;
                if (win.API_1484_11) return win.API_1484_11;
            }
            
            let frames = win.frames;
            for (let i = 0; i < frames.length; i++) {
                let api = findAPI(frames[i]);
                if (api) return api;
            }
            
            return null;
        }
        
        // Sauvegarder l'état de l'application
        function saveState() {
            if (!initialized) return;
            
            // Créer un objet avec toutes les données à sauvegarder
            const stateData = {
                score: score,
                solved: Array.from(solved),
                answered: Array.from(answered),
                attempted: Array.from(attempted),
                attempts: attempts,
                badgesUnlocked: badgesUnlocked,
                testCompleted: testCompleted
            };
            
            // Convertir en JSON
            suspendData = JSON.stringify(stateData);
            
            // Sauvegarder dans SCORM
            setValue("cmi.suspend_data", suspendData);
            
            // Sauvegarder le score actuel
            saveScore();
            
            // Sauvegarder l'état de progression
            saveProgress();
            
            // Commit pour assurer la persistance des données
            commitSCORM();
        }
        
        // Restaurer l'état de l'application
        function restoreState(data) {
            try {
                const stateData = JSON.parse(data);
                
                // Restaurer le score
                score = stateData.score || 0;
                
                // Restaurer les ensembles
                solved = new Set(stateData.solved || []);
                answered = new Set(stateData.answered || []);
                attempted = new Set(stateData.attempted || []);
                
                // Restaurer les tentatives
                if (stateData.attempts) {
                    Object.keys(stateData.attempts).forEach(key => {
                        attempts[key] = stateData.attempts[key];
                    });
                }
                
                // Restaurer les badges débloqués
                badgesUnlocked = stateData.badgesUnlocked || 0;
                
                // Restaurer l'état de complétion
                testCompleted = stateData.testCompleted || false;
                
                console.log("État restauré avec succès");
            } catch (e) {
                console.error("Erreur lors de la restauration de l'état:", e);
            }
        }
        
        // Sauvegarder le score
        function saveScore() {
            if (!initialized) return;
            
            setValue("cmi.score.raw", score);
            setValue("cmi.score.min", 0);
            setValue("cmi.score.max", totalExercises);
            setValue("cmi.score.scaled", score / totalExercises);
        }
        
        // Sauvegarder l'état de progression
        function saveProgress() {
            if (!initialized) return;
            
            // Déterminer l'état de progression
            if (testCompleted) {
                setValue("cmi.completion_status", "completed");
                setValue("cmi.success_status", (score / totalExercises >= 0.7) ? "passed" : "failed");
            } else if (answered.size > 0) {
                setValue("cmi.completion_status", "incomplete");
                setValue("cmi.success_status", "unknown");
            } else {
                setValue("cmi.completion_status", "not attempted");
                setValue("cmi.success_status", "unknown");
            }
        }
        
        // Enregistrer une interaction
        function recordInteraction(exerciseNum, answer, result) {
            if (!initialized) return;
            
            const interactionId = `interaction_${exerciseNum}`;
            const interactionIndex = getValue(`cmi.interactions._count`);
            
            setValue(`cmi.interactions.${interactionIndex}.id`, interactionId);
            setValue(`cmi.interactions.${interactionIndex}.type`, "numeric");
            setValue(`cmi.interactions.${interactionIndex}.learner_response`, answer.toString());
            setValue(`cmi.interactions.${interactionIndex}.result`, result ? "correct" : "incorrect");
            setValue(`cmi.interactions.${interactionIndex}.description`, `Exercice ${exerciseNum}: Calculer la masse molaire`);
            setValue(`cmi.interactions.${interactionIndex}.timestamp`, new Date().toISOString());
            
            // Sauvegarder la réponse correcte
            setValue(`cmi.interactions.${interactionIndex}.correct_responses.0.pattern`, correctAnswers[exerciseNum].toString());
        }
        
        // Démarrer le suivi du temps
        function startTimeTracking() {
            if (timeInterval) clearInterval(timeInterval);
            
            // Mettre à jour le temps toutes les 10 secondes
            timeInterval = setInterval(updateSessionTime, 10000);
        }
        
        // Mettre à jour le temps de session
        function updateSessionTime() {
            if (!initialized) return;
            
            const now = Date.now();
            const sessionTime = now - lastTimeUpdate;
            lastTimeUpdate = now;
            
            totalTime += sessionTime;
            
            // Convertir en format CMITimespan (PTxHyMzS)
            const totalSeconds = Math.floor(totalTime / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            const timeString = `PT${hours}H${minutes}M${seconds}S`;
            setValue("cmi.session_time", timeString);
            
            // Enregistrer les modifications
            commitSCORM();
        }
        
        // Terminer la session SCORM
        function terminateSCORM() {
            if (!initialized || terminated) return;
            
            // Mettre à jour le temps de session
            updateSessionTime();
            
            // Sauvegarder l'état final
            saveState();
            
            // Terminer la communication
            API_1484_11.Terminate("");
            terminated = true;
            
            console.log("Session SCORM terminée avec succès");
        }
        
        // Effectuer un commit SCORM
        function commitSCORM() {
            if (!initialized) return;
            
            API_1484_11.Commit("");
        }
        
        // Obtenir une valeur SCORM
        function getValue(parameter) {
            if (!initialized) return "";
            
            return API_1484_11.GetValue(parameter);
        }
        
        // Définir une valeur SCORM
        function setValue(parameter, value) {
            if (!initialized) return;
            
            API_1484_11.SetValue(parameter, value);
        }
        
        // Obtenir la dernière erreur
        function getLastError() {
            if (!initialized) return;
            
            const errorCode = API_1484_11.GetLastError();
            const errorString = API_1484_11.GetErrorString(errorCode);
            const errorDiagnostic = API_1484_11.GetDiagnostic(errorCode);
            
            console.error(`Erreur SCORM: ${errorCode} - ${errorString} - ${errorDiagnostic}`);
            
            lastError = {
                code: errorCode,
                message: errorString,
                diagnostic: errorDiagnostic
            };
            
            return lastError;
        }
        
        // Gérer la fermeture de la page
        window.addEventListener('beforeunload', function(e) {
            terminateSCORM();
        });
    </script>
</body>
</html>
