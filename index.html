<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mes fichiers HTML</title>
  <style>
    :root{--c:#0a58ca}
    body{font-family:system-ui,Segoe UI,Arial;padding:24px;max-width:980px;margin:0 auto;line-height:1.6}
    h1{margin:0 0 6px} h2{margin:22px 0 8px;font-size:1.1rem}
    ul{margin:0 0 12px;padding-left:18px} li{margin:4px 0}
    a{text-decoration:none;color:var(--c)} a:hover{text-decoration:underline}
    .muted{color:#666;font-size:.9rem}
  </style>
</head>
<body>
  <h1>Mes fichiers HTML</h1>
  <p class="muted" id="build"></p>
  <div id="content">Chargement…</div>

  <script>
    // Détecte owner/repo automatiquement quand c’est servi via GitHub Pages:
    // https://OWNER.github.io/REPO/
    (function () {
      const build = new Date().toISOString().replace('T',' ').slice(0,16);
      document.getElementById('build').textContent = 'Index auto – build: ' + build;

      const host = window.location.host;
      const path = window.location.pathname.replace(/^\/+|\/+$/g,''); // strip leading/trailing /
      let owner = host.split('.')[0];        // OWNER
      let repo  = path.split('/')[0] || '';  // REPO

      // Si c’est un site "user/orga" (sans repo dans l’URL), tu peux forcer ici :
      // const owner = 'TON_OWNER'; const repo = 'TON_REPO';

      const branch = 'main'; // adapte si ta branche par défaut n’est pas main

      if(!owner || !repo){
        document.getElementById('content').innerHTML =
          '<p>Impossible d’inférer owner/repo depuis l’URL. Renseigne-les en dur dans le script.</p>';
        return;
      }

      const api = `https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`;

      fetch(api).then(r=>r.json()).then(data=>{
        if(!data.tree){ throw new Error('Réponse API inattendue'); }
        // Récupère tous les .html (sauf index.html) visibles
        const files = data.tree
          .filter(n => n.type === 'blob' && /\.html?$/i.test(n.path) && !/^index\.html?$/i.test(n.path))
          .map(n => n.path)
          .sort((a,b)=>a.localeCompare(b, 'fr', {sensitivity:'base'}));

        // Regroupe par dossier top-level ('' = racine)
        const groups = {};
        for(const p of files){
          const parts = p.split('/');
          const top = parts.length > 1 ? parts[0] : '';
          if(!groups[top]) groups[top] = [];
          groups[top].push(p);
        }

        // Ordre suggéré des sections
        const order = ['', 'outils_scorm', 'Exemples', 'Templates'];

        // Rendu
        const container = document.getElementById('content');
        container.innerHTML = '';

        for(const section of [...order, ...Object.keys(groups).filter(g=>!order.includes(g))]){
          if(!groups[section]) continue;
          const h2 = document.createElement('h2');
          h2.textContent = section === '' ? 'Racine' : section;
          container.appendChild(h2);

          const ul = document.createElement('ul');
          groups[section].forEach(path=>{
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = encodeURI(path);
            a.target = '_blank';
            a.rel = 'noopener';
            // Libellé lisible : nom de fichier sans extension
            const name = path.split('/').pop().replace(/\.html?$/i,'')
              .replace(/[-_]/g,' ').replace(/\s+/g,' ').trim();
            a.textContent = name;
            li.appendChild(a);
            ul.appendChild(li);
          });
          container.appendChild(ul);
        }
      }).catch(err=>{
        document.getElementById('content').innerHTML =
          '<p>Erreur lors du chargement de la liste via l’API GitHub.</p><pre style="white-space:pre-wrap">'+
          (err && err.message ? err.message : String(err)) + '</pre>';
      });
    })();
  </script>
</body>
</html>
